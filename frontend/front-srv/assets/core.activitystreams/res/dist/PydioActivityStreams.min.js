!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PydioActivityStreams=e()}(function(){return function o(i,r,n){function l(a,e){if(!r[a]){if(!i[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(s)return s(a,!0);t=new Error("Cannot find module '"+a+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[a]={exports:{}};i[a][0].call(t.exports,function(e){var t=i[a][1][e];return l(t||e)},t,t.exports,o,i,r,n)}return r[a].exports}for(var s="function"==typeof require&&require,e=0;e<n.length;e++)l(n[e]);return l}({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,o=arguments[t];for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=n(e("pydio")),y=n(e("react")),s=n(e("prop-types")),h=n(e("react-markdown")),m=e("material-ui"),d=e("material-ui/styles"),v=n(e("pydio/util/path")),g=e("./DocLink"),p=n(g),b=l.default.requireLib("components").UserAvatar,e=l.default.requireLib("boot").PydioContextConsumer,w=l.default.requireLib("workspaces").FilePreview,O=l.default.requireLib("boot").moment,_=(u(x,y["default"].Component),o(x,[{key:"render",value:function(){return y.default.createElement("span",null,this.props.children)}}]),x);function x(){c(this,x),r(Object.getPrototypeOf(x.prototype),"constructor",this).apply(this,arguments)}function E(n,l,e){var s=arguments.length<=2||void 0===e?void 0:e;return u(t,y["default"].Component),o(t,[{key:"render",value:function(){var e,t=this.props,a=t.href,o=t.children,i=f({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},s),r=null;if(a.startsWith("doc://"))return"Delete"===l.type?y.default.createElement("a",{style:{textDecoration:"line-through"}},o):y.default.createElement(p.default,{pydio:n,activity:l,linkStyle:i},o);if(a.startsWith("user://")){t=a.replace("user://","");return y.default.createElement(b,{userId:t,displayAvatar:!1,richOnClick:!0,style:f({},i,{display:"inline-block"}),pydio:n})}return a.startsWith("workspaces://")&&(e=a.replace("workspaces://",""),n.user&&n.user.getRepositoriesList().get(e)&&(r=function(){n.triggerRepositoryChange(e)})),y.default.createElement("a",{title:"",style:i,onClick:r},o)}}]),t;function t(){c(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}}u(C,y["default"].Component),o(C,[{key:"computeIcon",value:function(e){var t="",a=void 0;switch(e.type){case"Create":t="Document"===e.object.type?"file-plus":"folder-plus",a="Created";break;case"Delete":t="delete",a="Deleted";break;case"Edit":case"Update":t="pencil",a="Modified";break;case"UpdateMeta":t="tag-multiple",a="Modified";break;case"UpdateComment":t="message-outline",a="Commented";break;case"Read":t="eye",a="Accessed";break;case"Move":t="file-send",a="Moved";break;case"Share":t="share-variant","Cell"===e.object.type?t="icomoon-cells":"Workspace"===e.object.type&&(t="folder"),a="Shared"}return{title:a,className:t=-1===t.indexOf("icomoon-")?"mdi mdi-"+t:t}}},{key:"render",value:function(){var e=this.props,t=e.pydio,a=e.activity,o=e.listContext,i=e.displayContext,r=e.oneLiner,n=e.muiTheme,l=a.type+(a.actor?" - "+a.actor.name:"");a.summary&&(l=y.default.createElement(h.default,{source:a.summary,renderers:{paragraph:_,link:E(t,a,{color:"inherit"})}}));var s=void 0,c=void 0,u=void 0,d={margin:"0px 10px 6px"},c="popover"===i?{fontSize:13,color:"rgba(0,0,0,0.53)",margin:"6px 0",padding:6}:{padding:"6px 22px 12px",marginTop:6,borderRadius:2,borderLeft:"2px solid #e0e0e0",marginLeft:13,color:"rgba(0,0,0,0.33)",overflow:"hidden"},p=this.computeIcon(a),e=p.title,p=p.className;return"NODE-LEAF"===o?(d={margin:"16px 10px"},u=y.default.createElement(m.FontIcon,{className:p,title:e,style:{fontSize:17,color:"rgba(0,0,0,0.17)"}})):s="popover"===i?(d={margin:0},e=(i=(e=o=void 0,g.nodesFromObject)(a.object,t)).length?(o=y.default.createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},y.default.createElement(w,f({pydio:t,node:i[0],loadThumbnail:!0},{style:{height:36,width:36,borderRadius:"50%"},mimeFontStyle:{fontSize:20,lineHeight:"36px",textAlign:"center"}})),y.default.createElement("span",{className:p,style:{position:"absolute",bottom:8,right:12,fontSize:18,color:n.palette.accent2Color}})),i[0].getLabel()||v.default.getBasename(i[0].getPath())):(o=y.default.createElement("div",{style:{margin:"12px 20px 12px 20px",backgroundColor:"rgb(237, 240, 242)",alignItems:"initial",height:36,width:36,borderRadius:"50%",textAlign:"center"}},y.default.createElement(m.FontIcon,{className:p,style:{lineHeight:"36px",color:n.palette.accent2Color}})),(a.object||a).name),y.default.createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},o,y.default.createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},y.default.createElement("div",{style:{marginTop:12,marginBottom:2,fontSize:15,color:"rgba(0,0,0,.87)",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e),y.default.createElement("div",{style:{color:"rgba(0,0,0,.33)"}},l)))):y.default.createElement("div",{style:c},l),y.default.createElement("div",{style:d},!r&&y.default.createElement("div",{style:{display:"flex",alignItems:"center"}},a.actor&&y.default.createElement(b,{useDefaultAvatar:!0,userId:a.actor.id,userLabel:a.actor.name,displayLocalLabel:!0,userType:"user",pydio:t,style:{display:"flex",alignItems:"center",maxWidth:"60%"},labelStyle:{fontSize:14,paddingLeft:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},avatarStyle:{flexShrink:0},avatarSize:28,richOnHover:!0}),y.default.createElement("span",{style:{fontSize:13,display:"inline-block",flex:1,height:18,color:"rgba(0,0,0,0.23)",fontWeight:500,paddingLeft:8,whiteSpace:"nowrap"}},O(a.updated).fromNow()),u),s)}}]),l=C;function C(){c(this,C),r(Object.getPrototypeOf(C.prototype),"constructor",this).apply(this,arguments)}l.PropTypes={activity:s.default.object,listContext:s.default.string,displayContext:s.default.oneOf(["infoPanel","popover"])},a.default=l=(0,d.muiThemeable)()(l),a.default=l=e(l),a.default=l,t.exports=a.default},{"./DocLink":5,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","prop-types":"prop-types",pydio:"pydio","pydio/util/path":"pydio/util/path",react:"react","react-markdown":"react-markdown"}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,o=arguments[t];for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}function l(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var y=n(e("react")),s=n(e("prop-types")),h=e("material-ui"),c=n(e("pydio")),u=n(e("./Client")),m=n(e("./Activity")),d=c.default.requireLib("boot"),e=d.PydioContextConsumer,v=d.moment,g=c.default.requireLib("components").EmptyStateView,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,y["default"].Component),o(p,[{key:"mergeMoreFeed",value:function(e,t){var a=e.items.map(function(e){return e.id}),o=t.items.filter(function(e){return-1===a.indexOf(e.id)});if(!o.length)return this.setState({loadMore:!1}),e;t=e;return t.items=[].concat(l(e.items),l(o)),t.totalItems=t.items.length,t}},{key:"loadForProps",value:function(e){var t=this,a=e.context,o=e.pointOfView,i=e.contextData,r=e.limit,e=this.state,n=e.offset,l=e.data;void 0===r&&(r=-1),0<n&&(r=100),this.setState({loading:!0,error:null}),u.default.loadActivityStreams(a,i,"outbox",o,n,r).then(function(e){0<n&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})}).catch(function(e){t.setState({loading:!1,error:e})})}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,e=e.contextData;t||e&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},function(){t.loadForProps(e)})}},{key:"render",value:function(){var e=this,o=[],t=this.state,a=t.data,i=t.loadMore,r=t.loading,n=t.error,l=this.props,s=l.listContext,c=l.groupByDate,u=l.displayContext,d=l.pydio,p=void 0,t="mdi mdi-pulse",l=r?d.MessageHash["notification_center.17"]:d.MessageHash["notification_center.18"];if(n&&(l=n.Detail||n.msg||n,t="mdi mdi-alert-circle-outline"),null!==a&&a.items&&(a.items.forEach(function(e,t){var a=v(e.updated).fromNow();c&&a!==p&&(o.length?(o.pop(),o.push(y.default.createElement("div",{style:{padding:"20px 16px 0",fontSize:13,color:"rgba(147, 168, 178, 0.67)",fontWeight:500}},a))):o.push(y.default.createElement("div",{style:{padding:"0 16px",fontSize:13,color:"rgba(147, 168, 178, 0.67)",fontWeight:500}},a))),o.push(y.default.createElement(m.default,{key:e.id,activity:e,listContext:s,oneLiner:c,displayContext:u})),c&&(p=a,o.push(y.default.createElement("div",{style:{borderTop:"1px solid rgba(0,0,0,.03)",width:"100%"}})))}),c&&o.pop()),o.length&&i&&o.push(y.default.createElement("div",{style:{paddingLeft:16}},y.default.createElement(h.FlatButton,{primary:!0,label:r?d.MessageHash["notification_center.20"]:d.MessageHash["notification_center.19"],disabled:r,onClick:function(){e.setState({offset:a.items.length+1},function(){e.loadForProps(e.props)})}}))),o.length)return y.default.createElement(h.List,{style:this.props.style},o);i={backgroundColor:"transparent"},d=void 0,r=void 0;return"popover"===u?i=f({},i,{minHeight:250}):"infoPanel"===u&&(i=f({},i,{paddingBottom:20}),d={fontSize:40},r={fontSize:13,fontWeight:400}),y.default.createElement(g,{pydio:this.props.pydio,iconClassName:t,primaryTextId:l,style:i,iconStyle:d,legendStyle:r})}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e),e.items?this.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:this.state={data:[],offset:0,loadMore:!0,loading:!1}}o.PropTypes={context:s.default.string,contextData:s.default.string,boxName:s.default.string,pointOfView:s.default.oneOf(["GENERIC","ACTOR","SUBJECT"]),displayContext:s.default.oneOf(["mainList","infoPanel","popover"])},a.default=o=e(o),a.default=o,t.exports=a.default},{"./Activity":1,"./Client":4,"material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio",react:"react"}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,n=e("pydio/http/api"),l=(r=n)&&r.__esModule?r:{default:r},s=e("cells-sdk"),o=(o(c,null,[{key:"toggleWatch",value:function(e,r){r&&function(){var a=pydio.getUserSelection().getUniqueNode(),e=a.getMetadata().get("uuid"),t=pydio.user.id,o=new s.ActivitySubscription,i=new s.ActivityOwnerType;o.UserId=t,o.ObjectId=e,o.ObjectType=i.NODE;i=[];"watch_change"!==r&&"watch_both"!==r||i.push("change"),"watch_read"!==r&&"watch_both"!==r||i.push("read"),o.Events=i,new s.ActivityServiceApi(l.default.getRestClient()).subscribe(o).then(function(e){var t=a.getMetadata().get("overlay_class")||"";"watch_stop"===r?(a.getMetadata().delete("meta_watched"),a.getMetadata().set("overlay_class",t.replace("mdi mdi-bell",""))):(a.getMetadata().set("meta_watched","META_"+r.toUpperCase()),(t=t.replace("mdi mdi-bell","").split(",")).push("mdi mdi-bell"),a.getMetadata().set("overlay_class",t.join(","))),a.notify("node_replaced")})}()}}]),c);function c(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c)}a.default=o,t.exports=a.default},{"cells-sdk":"cells-sdk","pydio/http/api":"pydio/http/api"}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e){return e&&e.__esModule?e:{default:e}}var s=r(e("pydio")),c=r(e("pydio/http/api")),u=e("cells-sdk"),o=(o(n,null,[{key:"loadActivityStreams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"USER_ID":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],a=arguments.length<=2||void 0===arguments[2]?"outbox":arguments[2],o=arguments.length<=3||void 0===arguments[3]?"":arguments[3],i=arguments.length<=4||void 0===arguments[4]?-1:arguments[4],r=arguments.length<=5||void 0===arguments[5]?-1:arguments[5];if(!t)return Promise.resolve([]);var n=new u.ActivityServiceApi(c.default.getRestClient()),l=new u.ActivityStreamActivitiesRequest;return l.Context=e,l.ContextData=t,l.BoxName=a,-1<i&&(l.Offset=i),-1<r&&(l.Limit=r),l.Language=s.default.getInstance().user.getPreference("lang")||"",o&&(l.PointOfView=o),n.stream(l)}},{key:"UnreadInbox",value:function(e){var t=new u.ActivityServiceApi(c.default.getRestClient()),a=new u.ActivityStreamActivitiesRequest;return a.Context="USER_ID",a.ContextData=e,a.BoxName="inbox",a.UnreadCountOnly=!0,t.stream(a).then(function(e){return e.totalItems||0})}}]),n);function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n)}a.default=o,t.exports=a.default},{"cells-sdk":"cells-sdk",pydio:"pydio","pydio/http/api":"pydio/http/api"}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,o=arguments[t];for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=n(e("react")),c=n(e("prop-types")),u=e("material-ui"),d=u.Popover,p=u.Paper,h=u.IconButton,m=u.FlatButton,v=u.Divider,u=e("pydio"),g=e("lodash.debounce"),b=e("pydio/model/meta-node-provider"),e=u.requireLib("boot").PydioContextConsumer,w=u.requireLib("workspaces").FilePreview;function O(e,t){var a=[],o=t.user.getActiveRepository();if(!(e&&e.partOf&&e.partOf.items&&e.partOf.items.length))return a;for(var i=0;i<e.partOf.items.length;i++){var r=e.partOf.items[i],n=r.rel.split("/");n.shift();var l=n.join("/");0!==l.indexOf("/")&&(l="/"+l);n=new AjxpNode(l,"Document"===e.type);if(n.getMetadata().set("repository_id",r.id),n.getMetadata().set("repository_label",r.name),n.getMetadata().set("filename",l),r.id===o)return[n];a.push(n)}return a}var _=(s(x,y["default"].Component),o(x,[{key:"render",value:function(){var t,a,o=this,i=this.props.pydio,e=this.state,r=e.previewLoaded,n=e.nodes,l=e.previewFailed,s=n.length?n[0]:null,e={height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:70};s&&s.isLeaf()&&(r&&!l?y.default.createElement(w,{style:e,node:s,pydio:i,loadThumbnail:!0,richPreview:!0,processing:!r}):r&&l?y.default.createElement("div",{style:f({},e,{flexDirection:"column"}),className:"mimefont-container"},y.default.createElement("div",{className:"mimefont mdi mdi-delete"}),y.default.createElement("span",{style:{fontSize:13}},"File deleted")):(t=s.getMetadata().get("repository_id"),a=s.getMetadata().get("repository_label"),r=new b,s.observeOnce("error",function(){o.setState({previewLoaded:!0,previewFailed:!0})}),r.loadLeafNodeSync(s,function(e){e.getMetadata().set("repository_id",t),e.getMetadata().set("repository_label",a),n[0]=e,o.setState({previewLoaded:!0,nodes:n})},!0,{tmp_repository_id:t}),y.default.createElement(w,{style:e,node:s,pydio:i,loadThumbnail:!1,richPreview:!1,processing:!0})));for(var c=[],u=void 0,d=i.user.getActiveRepository(),p=0;p<n.length;p++)if("break"===function(e){var t=n[e],a=y.default.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},y.default.createElement("div",{style:{flex:1,fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.33)"}},i.MessageHash["notification_center.16"]," ",t.getMetadata().get("repository_label")),y.default.createElement(h,{iconClassName:"mdi mdi-open-in-new",tooltip:i.MessageHash["notification_center.6"],tooltipPosition:"top-center",onClick:function(){i.goTo(t)}}));if(t.getMetadata().get("repository_id")===d)return u=y.default.createElement("div",{style:{display:"flex",alignItems:"center"}},y.default.createElement("span",{style:{flex:1}})," ",y.default.createElement(m,{label:i.MessageHash["notification_center.6"],iconClassName:"mdi mdi-open-in-new",tooltip:"Open",tooltipPosition:"top-right",onClick:function(){i.goTo(t)}})),"break";c.push(a),e<n.length-1&&c.push(y.default.createElement(v,null))}(p))break;return u&&(c=[u]),y.default.createElement("div",null,!l&&y.default.createElement("div",{style:{padding:6}},c))}}]),x);function x(e){l(this,x),r(Object.getPrototypeOf(x.prototype),"constructor",this).call(this,e);e=O(e.activity.object,e.pydio);e.length&&!e[0].isLeaf()?this.state={previewLoaded:!0,previewFailed:!1,nodes:e}:this.state={previewLoaded:!1,previewFailed:!1,nodes:e}}s(E,y["default"].Component),o(E,[{key:"render",value:function(){var t=this,e=this.props,a=e.pydio,o=e.activity,i=e.children,r=e.linkStyle;o.object.name||(o.object.name="");var n=O(o.object,a),l=void 0,s=void 0,c=void 0,u=void 0,e=o.object.name.replace("doc://","").split("/");e.shift();e="/"+e.join("/");return 1<n.length?(l=function(){a.goTo(n[0])},c=g(function(){t.setState({showPopover:!1})},350),s=function(e){t.setState({showPopover:!0,popoverAnchor:e.currentTarget}),c.cancel()},u=y.default.createElement(d,{open:this.state.showPopover,anchorEl:this.state.popoverAnchor,onRequestClose:function(e){"clickAway"!==e&&t.setState({showPopover:!1})},anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},useLayerForClickAway:!1},y.default.createElement(p,{zDepth:2,style:{width:200,height:"auto",overflowY:"auto"},onMouseOver:function(e){t.setState({showPopover:!0}),c.cancel()},onMouseOut:c},y.default.createElement(_,{pydio:a,activity:o})))):1===n.length&&(l=function(){a.goTo(n[0])}),y.default.createElement("span",null,y.default.createElement("a",{title:e,style:f({cursor:"pointer",color:"rgb(66, 140, 179)"},r),onMouseOver:s,onMouseOut:c,onClick:l},i),u)}}]),o=E;function E(e){l(this,E),r(Object.getPrototypeOf(E.prototype),"constructor",this).call(this,e),this.state={showPopover:!1,popoverAnchor:null}}o.PropTypes={activity:c.default.object,pydio:c.default.instanceOf(u)},a.default=o=e(o),a.default=o,a.nodesFromObject=O},{"lodash.debounce":"lodash.debounce","material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio","pydio/model/meta-node-provider":"pydio/model/meta-node-provider",react:"react"}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}var l=n(e("react")),s=(e("material-ui"),n(e("./ActivityList"))),e=Pydio.requireLib("boot").PydioContextConsumer,c=Pydio.requireLib("workspaces").InfoPanelCard,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l["default"].Component),o(u,[{key:"render",value:function(){var e=this.props,t=e.node,a=e.pydio;if(!1===a.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES"))return null;var o=t.isLeaf()?"activity.leaf":"activity.folder",e=!t.isLeaf(),a=t.isLeaf()?a.MessageHash["notification_center.11"]:a.MessageHash["notification_center.10"];return l.default.createElement(c,{key:o,identifier:o,defaultOpen:e,title:a},l.default.createElement(s.default,{context:"NODE_ID",contextData:t.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380},listContext:"NODE-"+(t.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),r(Object.getPrototypeOf(u.prototype),"constructor",this).apply(this,arguments)}a.default=o=e(o),a.default=o,t.exports=a.default},{"./ActivityList":2,"material-ui":"material-ui",react:"react"}],7:[function(e,a,i){!function(r){"use strict";function o(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(i,"__esModule",{value:!0});var e=(function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}(t,null,[{key:"dynamicBuilder",value:function(e){var t=r.pydio,a=t.MessageHash,o=t.getUserSelection().getUniqueNode();if(!o)return[];var i=[],t=void 0;return o.getMetadata().get("meta_watched")&&(t=o.getMetadata().get("meta_watched")),i.push({name:a["meta.watch.11"],alt:a["meta.watch."+(o.isLeaf()?"12":"12b")],icon_class:t&&"META_WATCH_CHANGE"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),i.push({name:a["meta.watch.9"],alt:a["meta.watch."+(o.isLeaf()?"10":"10b")],icon_class:t&&"META_WATCH_READ"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),i.push({name:a["meta.watch.13"],alt:a["meta.watch."+(o.isLeaf()?"14":"14b")],icon_class:t&&"META_WATCH_BOTH"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),t&&(i.push({separator:!0}),i.push({name:a["meta.watch.3"],alt:a["meta.watch."+(o.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),i}}]),t);function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}i.default=e,a.exports=i.default}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,o=arguments[t];for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}var s=n(e("react")),c=e("material-ui"),u=e("material-ui/styles"),d=n(e("./Client")),p=n(e("./ActivityList")),f=n(e("lodash.debounce")),y=n(e("color")),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,s["default"].Component),o(h,[{key:"reloadData",value:function(){var t=this;d.default.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then(function(e){t.setState({data:e})}).catch(function(e){t.setState({error:e})})}},{key:"reloadUnread",value:function(){var t=this;d.default.UnreadInbox(this.props.pydio.user.id).then(function(e){t.setState({unreadStatus:e})}).catch(function(e){})}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var t=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",function(e){t.state.open?t.reloadData():t.reloadUnread()})}},{key:"render",value:function(){var e=this.props,t=e.pydio,a=e.iconStyle,o=e.muiTheme,i=this.state,r=i.open,n=i.anchorEl,e=i.unreadStatus,i={borderRadius:"50%"};return r&&a&&a.color&&(i=l({},i,{backgroundColor:(0,y.default)(a.color).fade(.9).toString()})),s.default.createElement("span",null,s.default.createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},s.default.createElement(c.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(e?e+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:a,style:i}),0<e&&s.default.createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:o.palette.accent1Color}})),s.default.createElement(c.Popover,{open:r,anchorEl:n,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3},s.default.createElement("div",{style:{display:"flex",alignItems:"center",borderRadius:"2px 2px 0 0",width:"100%",backgroundColor:"#f8fafc",borderBottom:"1px solid #ECEFF1",color:o.palette.primary1Color}},s.default.createElement("span",{className:"mdi mdi-bell",style:{fontSize:18,margin:"12px 8px 14px 16px"}}),s.default.createElement("span",{style:{fontSize:15,fontWeight:500}},t.MessageHash["notification_center.1"])),this.state.data&&s.default.createElement(p.default,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),r(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,e),this.state={unreadStatus:0,open:!1,data:[]},this.reloadData=(0,f.default)(this.reloadData.bind(this),500),this.reloadUnread=(0,f.default)(this.reloadUnread.bind(this),500)}a.default=o=(0,u.muiThemeable)()(o),a.default=o,t.exports=a.default},{"./ActivityList":2,"./Client":4,color:"color","lodash.debounce":"lodash.debounce","material-ui":"material-ui","material-ui/styles":"material-ui/styles",react:"react"}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,a){for(var o=!0;o;){var i=e,r=t,n=a,o=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(n)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=r,a=n,o=!0,l=void 0}};function n(e){return e&&e.__esModule?e:{default:e}}var l=n(e("react")),s=n(e("pydio")),c=e("material-ui"),u=n(e("pydio/http/api")),d=e("cells-sdk"),p=s.default.requireLib("hoc").ModernSelectField,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,l["default"].Component),o(f,[{key:"valueFromNodes",value:function(){var t=!1,a=void 0;return(arguments.length<=0||void 0===arguments[0]?[]:arguments[0]).forEach(function(e){e=e.getMetadata().get("meta_watched")||"";void 0!==a&&e!==a&&(t=!0),a=e}),{value:a,mixed:t}}},{key:"onSelectorChange",value:function(r){var n,e,t=this;"mixed"!==r&&(e=this.props,n=e.pydio,e=e.nodes,this.setState({saving:!0}),e=e.map(function(a){var e=a.getMetadata().get("uuid"),t=n.user.id,o=new d.ActivitySubscription,i=new d.ActivityOwnerType;o.UserId=t,o.ObjectId=e,o.ObjectType=i.NODE;i=[];return"META_WATCH_CHANGE"!==r&&"META_WATCH_BOTH"!==r||i.push("change"),"META_WATCH_READ"!==r&&"META_WATCH_BOTH"!==r||i.push("read"),o.Events=i,new d.ActivityServiceApi(u.default.getRestClient()).subscribe(o).then(function(e){var t=a.getMetadata().get("overlay_class")||"";""===r?(a.getMetadata().delete("meta_watched"),a.getMetadata().set("overlay_class",t.replace("mdi mdi-bell",""))):(a.getMetadata().set("meta_watched",r),(t=t.replace("mdi mdi-bell","").split(",")).push("mdi mdi-bell"),a.getMetadata().set("overlay_class",t.join(","))),a.notify("node_replaced")})}),Promise.all(e).then(function(){t.setState({value:r,mixed:!1}),window.setTimeout(function(){t.setState({saving:!1})},250)}).catch(function(){t.setState({saving:!1})}))}},{key:"render",value:function(){var o=this,e=this.state,t=e.value,a=e.mixed,i=e.saving,e=s.default.getInstance().MessageHash;return i?l.default.createElement(p,{value:"saving",onChange:function(e,t,a){},disabled:!0},l.default.createElement(c.MenuItem,{value:"saving",primaryText:e["meta.watch.selector.saving"]+"..."})):l.default.createElement(p,{value:a?"mixed":t,onChange:function(e,t,a){o.onSelectorChange(a)}},a&&l.default.createElement(c.MenuItem,{value:"mixed",primaryText:e["meta.watch.selector.mixed"]+"..."}),l.default.createElement(c.MenuItem,{value:"",primaryText:e["meta.watch.selector.ignore"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_READ",primaryText:e["meta.watch.selector.read"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_CHANGE",primaryText:e["meta.watch.selector.change"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_BOTH",primaryText:e["meta.watch.selector.both"]}))}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),r(Object.getPrototypeOf(f.prototype),"constructor",this).call(this,e);e=this.props.nodes;this.state=this.valueFromNodes(e)}a.default=o,t.exports=a.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api",react:"react"}],10:[function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e.default:e}Object.defineProperty(a,"__esModule",{value:!0});var i=e("./InfoPanel");a.InfoPanel=o(i);i=e("./UserPanel");a.UserPanel=o(i);i=e("./Client");a.ASClient=o(i);i=e("./Activity");a.Activity=o(i);i=e("./ActivityList");a.ActivityList=o(i);i=e("./Listener");a.Listener=o(i);i=e("./Callbacks");a.Callbacks=o(i);e=e("./WatchSelector");a.WatchSelector=o(e)},{"./Activity":1,"./ActivityList":2,"./Callbacks":3,"./Client":4,"./InfoPanel":6,"./Listener":7,"./UserPanel":8,"./WatchSelector":9}]},{},[10])(10)});