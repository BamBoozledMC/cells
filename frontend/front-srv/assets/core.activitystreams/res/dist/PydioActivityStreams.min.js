!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PydioActivityStreams=e()}(function(){return function a(i,n,r){function l(o,e){if(!n[o]){if(!i[o]){var t="function"==typeof require&&require;if(!e&&t)return t(o,!0);if(s)return s(o,!0);t=new Error("Cannot find module '"+o+"'");throw t.code="MODULE_NOT_FOUND",t}t=n[o]={exports:{}};i[o][0].call(t.exports,function(e){var t=i[o][1][e];return l(t||e)},t,t.exports,a,i,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,e=0;e<r.length;e++)l(r[e]);return l}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,a=arguments[t];for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=r(e("pydio")),y=r(e("react")),s=r(e("prop-types")),h=r(e("react-markdown")),m=e("material-ui"),d=e("material-ui/styles"),v=r(e("pydio/util/path")),g=e("./DocLink"),p=r(g),b=l.default.requireLib("components").UserAvatar,e=l.default.requireLib("boot").PydioContextConsumer,w=l.default.requireLib("workspaces").FilePreview,O=l.default.requireLib("boot").moment,_=(u(x,y["default"].Component),a(x,[{key:"render",value:function(){return y.default.createElement("span",null,this.props.children)}}]),x);function x(){c(this,x),n(Object.getPrototypeOf(x.prototype),"constructor",this).apply(this,arguments)}function E(r,l,e){var s=arguments.length<=2||void 0===e?void 0:e;return u(t,y["default"].Component),a(t,[{key:"render",value:function(){var e,t=this.props,o=t.href,a=t.children,i=f({cursor:"pointer",color:"rgb(66, 140, 179)",fontWeight:500},s),n=null;if(o.startsWith("doc://"))return"Delete"===l.type?y.default.createElement("a",{style:{textDecoration:"line-through"}},a):y.default.createElement(p.default,{pydio:r,activity:l,linkStyle:i},a);if(o.startsWith("user://")){t=o.replace("user://","");return y.default.createElement(b,{userId:t,displayAvatar:!1,richOnClick:!0,style:f({},i,{display:"inline-block"}),pydio:r})}return o.startsWith("workspaces://")&&(e=o.replace("workspaces://",""),r.user&&r.user.getRepositoriesList().get(e)&&(n=function(){r.triggerRepositoryChange(e)})),y.default.createElement("a",{title:"",style:i,onClick:n},a)}}]),t;function t(){c(this,t),n(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}}u(C,y["default"].Component),a(C,[{key:"computeIcon",value:function(e){var t="",o=void 0;switch(e.type){case"Create":t="Document"===e.object.type?"file-plus":"folder-plus",o="Created";break;case"Delete":t="delete",o="Deleted";break;case"Edit":case"Update":t="pencil",o="Modified";break;case"UpdateMeta":t="tag-multiple",o="Modified";break;case"UpdateComment":t="message-outline",o="Commented";break;case"Read":t="eye",o="Accessed";break;case"Move":t="file-send",o="Moved";break;case"Share":t="share-variant","Cell"===e.object.type?t="icomoon-cells":"Workspace"===e.object.type&&(t="folder"),o="Shared"}return{title:o,className:t=-1===t.indexOf("icomoon-")?"mdi mdi-"+t:t}}},{key:"render",value:function(){var e=this.props,t=e.pydio,o=e.activity,a=e.listContext,i=e.displayContext,n=e.oneLiner,r=e.muiTheme,l=o.type+" - "+o.actor.name;o.summary&&(l=y.default.createElement(h.default,{source:o.summary,renderers:{paragraph:_,link:E(t,o,{color:"inherit"})}}));var s=void 0,c=void 0,u=void 0,d={margin:"0px 10px 6px"},c="popover"===i?{fontSize:13,color:"rgba(0,0,0,0.53)",margin:"6px 0",padding:6}:{padding:"6px 22px 12px",marginTop:6,borderRadius:2,borderLeft:"2px solid #e0e0e0",marginLeft:13,color:"rgba(0,0,0,0.33)",overflow:"hidden"},p=this.computeIcon(o),e=p.title,p=p.className;return"NODE-LEAF"===a?(d={margin:"16px 10px"},u=y.default.createElement(m.FontIcon,{className:p,title:e,style:{fontSize:17,color:"rgba(0,0,0,0.17)"}})):s="popover"===i?(d={margin:0},e=(i=(e=a=void 0,g.nodesFromObject)(o.object,t)).length?(a=y.default.createElement("div",{style:{padding:"12px 20px 12px 20px",position:"relative"}},y.default.createElement(w,f({pydio:t,node:i[0],loadThumbnail:!0},{style:{height:36,width:36,borderRadius:"50%"},mimeFontStyle:{fontSize:20,lineHeight:"36px",textAlign:"center"}})),y.default.createElement("span",{className:p,style:{position:"absolute",bottom:8,right:12,fontSize:18,color:r.palette.accent2Color}})),i[0].getLabel()||v.default.getBasename(i[0].getPath())):(a=y.default.createElement("div",{style:{margin:"12px 20px 12px 20px",backgroundColor:"rgb(237, 240, 242)",alignItems:"initial",height:36,width:36,borderRadius:"50%",textAlign:"center"}},y.default.createElement(m.FontIcon,{className:p,style:{lineHeight:"36px",color:r.palette.accent2Color}})),o.object.name),y.default.createElement("div",{style:{display:"flex",alignItems:"flex-start",overflow:"hidden",paddingBottom:8}},a,y.default.createElement("div",{style:{flex:1,overflow:"hidden",paddingRight:16}},y.default.createElement("div",{style:{marginTop:12,marginBottom:2,fontSize:15,color:"rgba(0,0,0,.87)",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e),y.default.createElement("div",{style:{color:"rgba(0,0,0,.33)"}},l)))):y.default.createElement("div",{style:c},l),y.default.createElement("div",{style:d},!n&&y.default.createElement("div",{style:{display:"flex",alignItems:"center"}},y.default.createElement(b,{useDefaultAvatar:!0,userId:o.actor.id,userLabel:o.actor.name,displayLocalLabel:!0,userType:"user",pydio:t,style:{display:"flex",alignItems:"center",maxWidth:"60%"},labelStyle:{fontSize:14,paddingLeft:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},avatarStyle:{flexShrink:0},avatarSize:28,richOnHover:!0}),y.default.createElement("span",{style:{fontSize:13,display:"inline-block",flex:1,height:18,color:"rgba(0,0,0,0.23)",fontWeight:500,paddingLeft:8,whiteSpace:"nowrap"}},O(o.updated).fromNow()),u),s)}}]),l=C;function C(){c(this,C),n(Object.getPrototypeOf(C.prototype),"constructor",this).apply(this,arguments)}l.PropTypes={activity:s.default.object,listContext:s.default.string,displayContext:s.default.oneOf(["infoPanel","popover"])},o.default=l=(0,d.muiThemeable)()(l),o.default=l=e(l),o.default=l,t.exports=o.default},{"./DocLink":5,"material-ui":"material-ui","material-ui/styles":"material-ui/styles","prop-types":"prop-types",pydio:"pydio","pydio/util/path":"pydio/util/path",react:"react","react-markdown":"react-markdown"}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,a=arguments[t];for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}function l(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}var y=r(e("react")),s=r(e("prop-types")),h=e("material-ui"),c=r(e("pydio")),u=r(e("./Client")),m=r(e("./Activity")),d=c.default.requireLib("boot"),e=d.PydioContextConsumer,v=d.moment,g=c.default.requireLib("components").EmptyStateView,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,y["default"].Component),a(p,[{key:"mergeMoreFeed",value:function(e,t){var o=e.items.map(function(e){return e.id}),a=t.items.filter(function(e){return-1===o.indexOf(e.id)});if(!a.length)return this.setState({loadMore:!1}),e;t=e;return t.items=[].concat(l(e.items),l(a)),t.totalItems=t.items.length,t}},{key:"loadForProps",value:function(e){var t=this,o=e.context,a=e.pointOfView,i=e.contextData,n=e.limit,e=this.state,r=e.offset,l=e.data;void 0===n&&(n=-1),0<r&&(n=100),this.setState({loading:!0,error:null}),u.default.loadActivityStreams(o,i,"outbox",a,r,n).then(function(e){0<r&&l&&l.items?e&&e.items&&t.setState({data:t.mergeMoreFeed(l,e)}):t.setState({data:e}),e&&e.items&&e.items.length||t.setState({loadMore:!1}),t.setState({loading:!1})}).catch(function(e){t.setState({loading:!1,error:e})})}},{key:"componentWillMount",value:function(){var e=this.props,t=e.items,e=e.contextData;t||e&&this.loadForProps(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.items?this.setState({data:{items:e.items},offset:0,loadMore:!1}):e.contextData===this.props.contextData&&e.context===this.props.context||this.setState({offset:0,loadMore:!0},function(){t.loadForProps(e)})}},{key:"render",value:function(){var e=this,a=[],t=this.state,o=t.data,i=t.loadMore,n=t.loading,r=t.error,l=this.props,s=l.listContext,c=l.groupByDate,u=l.displayContext,d=l.pydio,p=void 0,t="mdi mdi-pulse",l=n?d.MessageHash["notification_center.17"]:d.MessageHash["notification_center.18"];if(r&&(l=r.Detail||r.msg||r,t="mdi mdi-alert-circle-outline"),null!==o&&o.items&&(o.items.forEach(function(e,t){var o=v(e.updated).fromNow();c&&o!==p&&(a.length?(a.pop(),a.push(y.default.createElement("div",{style:{padding:"20px 16px 0",fontSize:13,color:"rgba(147, 168, 178, 0.67)",fontWeight:500}},o))):a.push(y.default.createElement("div",{style:{padding:"0 16px",fontSize:13,color:"rgba(147, 168, 178, 0.67)",fontWeight:500}},o))),a.push(y.default.createElement(m.default,{key:e.id,activity:e,listContext:s,oneLiner:c,displayContext:u})),c&&(p=o,a.push(y.default.createElement("div",{style:{borderTop:"1px solid rgba(0,0,0,.03)",width:"100%"}})))}),c&&a.pop()),a.length&&i&&a.push(y.default.createElement("div",{style:{paddingLeft:16}},y.default.createElement(h.FlatButton,{primary:!0,label:n?d.MessageHash["notification_center.20"]:d.MessageHash["notification_center.19"],disabled:n,onClick:function(){e.setState({offset:o.items.length+1},function(){e.loadForProps(e.props)})}}))),a.length)return y.default.createElement(h.List,{style:this.props.style},a);i={backgroundColor:"transparent"},d=void 0,n=void 0;return"popover"===u?i=f({},i,{minHeight:250}):"infoPanel"===u&&(i=f({},i,{paddingBottom:20}),d={fontSize:40},n={fontSize:13,fontWeight:400}),y.default.createElement(g,{pydio:this.props.pydio,iconClassName:t,primaryTextId:l,style:i,iconStyle:d,legendStyle:n})}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),n(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e),e.items?this.state={data:{items:e.items},offset:0,loadMore:!1,loading:!1}:this.state={data:[],offset:0,loadMore:!0,loading:!1}}a.PropTypes={context:s.default.string,contextData:s.default.string,boxName:s.default.string,pointOfView:s.default.oneOf(["GENERIC","ACTOR","SUBJECT"]),displayContext:s.default.oneOf(["mainList","infoPanel","popover"])},o.default=a=e(a),o.default=a,t.exports=o.default},{"./Activity":1,"./Client":4,"material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio",react:"react"}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n,r=e("pydio/http/api"),l=(n=r)&&n.__esModule?n:{default:n},s=e("cells-sdk"),a=(a(c,null,[{key:"toggleWatch",value:function(e,n){n&&function(){var o=pydio.getUserSelection().getUniqueNode(),e=o.getMetadata().get("uuid"),t=pydio.user.id,a=new s.ActivitySubscription,i=new s.ActivityOwnerType;a.UserId=t,a.ObjectId=e,a.ObjectType=i.NODE;i=[];"watch_change"!==n&&"watch_both"!==n||i.push("change"),"watch_read"!==n&&"watch_both"!==n||i.push("read"),a.Events=i,new s.ActivityServiceApi(l.default.getRestClient()).subscribe(a).then(function(e){var t=o.getMetadata().get("overlay_class")||"";"watch_stop"===n?(o.getMetadata().delete("meta_watched"),o.getMetadata().set("overlay_class",t.replace("mdi mdi-bell",""))):(o.getMetadata().set("meta_watched","META_"+n.toUpperCase()),(t=t.replace("mdi mdi-bell","").split(",")).push("mdi mdi-bell"),o.getMetadata().set("overlay_class",t.join(","))),o.notify("node_replaced")})}()}}]),c);function c(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c)}o.default=a,t.exports=o.default},{"cells-sdk":"cells-sdk","pydio/http/api":"pydio/http/api"}],4:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e){return e&&e.__esModule?e:{default:e}}var s=n(e("pydio")),c=n(e("pydio/http/api")),u=e("cells-sdk"),a=(a(r,null,[{key:"loadActivityStreams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"USER_ID":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"outbox":arguments[2],a=arguments.length<=3||void 0===arguments[3]?"":arguments[3],i=arguments.length<=4||void 0===arguments[4]?-1:arguments[4],n=arguments.length<=5||void 0===arguments[5]?-1:arguments[5];if(!t)return Promise.resolve([]);var r=new u.ActivityServiceApi(c.default.getRestClient()),l=new u.ActivityStreamActivitiesRequest;return l.Context=e,l.ContextData=t,l.BoxName=o,-1<i&&(l.Offset=i),-1<n&&(l.Limit=n),l.Language=s.default.getInstance().user.getPreference("lang")||"",a&&(l.PointOfView=a),r.stream(l)}},{key:"UnreadInbox",value:function(e){var t=new u.ActivityServiceApi(c.default.getRestClient()),o=new u.ActivityStreamActivitiesRequest;return o.Context="USER_ID",o.ContextData=e,o.BoxName="inbox",o.UnreadCountOnly=!0,t.stream(o).then(function(e){return e.totalItems||0})}}]),r);function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}o.default=a,t.exports=o.default},{"cells-sdk":"cells-sdk",pydio:"pydio","pydio/http/api":"pydio/http/api"}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,a=arguments[t];for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=r(e("react")),c=r(e("prop-types")),u=e("material-ui"),d=u.Popover,p=u.Paper,h=u.IconButton,m=u.FlatButton,v=u.Divider,u=e("pydio"),g=e("lodash.debounce"),b=e("pydio/model/meta-node-provider"),e=u.requireLib("boot").PydioContextConsumer,w=u.requireLib("workspaces").FilePreview;function O(e,t){var o=[],a=t.user.getActiveRepository();if(!e.partOf||!e.partOf.items||!e.partOf.items.length)return o;for(var i=0;i<e.partOf.items.length;i++){var n=e.partOf.items[i],r=n.rel.split("/");r.shift();var l=r.join("/");0!==l.indexOf("/")&&(l="/"+l);r=new AjxpNode(l,"Document"===e.type);if(r.getMetadata().set("repository_id",n.id),r.getMetadata().set("repository_label",n.name),r.getMetadata().set("filename",l),n.id===a)return[r];o.push(r)}return o}var _=(s(x,y["default"].Component),a(x,[{key:"render",value:function(){var t,o,a=this,i=this.props.pydio,e=this.state,n=e.previewLoaded,r=e.nodes,l=e.previewFailed,s=r.length?r[0]:null,e={height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:70};s&&s.isLeaf()&&(n&&!l?y.default.createElement(w,{style:e,node:s,pydio:i,loadThumbnail:!0,richPreview:!0,processing:!n}):n&&l?y.default.createElement("div",{style:f({},e,{flexDirection:"column"}),className:"mimefont-container"},y.default.createElement("div",{className:"mimefont mdi mdi-delete"}),y.default.createElement("span",{style:{fontSize:13}},"File deleted")):(t=s.getMetadata().get("repository_id"),o=s.getMetadata().get("repository_label"),n=new b,s.observeOnce("error",function(){a.setState({previewLoaded:!0,previewFailed:!0})}),n.loadLeafNodeSync(s,function(e){e.getMetadata().set("repository_id",t),e.getMetadata().set("repository_label",o),r[0]=e,a.setState({previewLoaded:!0,nodes:r})},!0,{tmp_repository_id:t}),y.default.createElement(w,{style:e,node:s,pydio:i,loadThumbnail:!1,richPreview:!1,processing:!0})));for(var c=[],u=void 0,d=i.user.getActiveRepository(),p=0;p<r.length;p++)if("break"===function(e){var t=r[e],o=y.default.createElement("div",{style:{display:"flex",alignItems:"center",paddingLeft:10}},y.default.createElement("div",{style:{flex:1,fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.33)"}},i.MessageHash["notification_center.16"]," ",t.getMetadata().get("repository_label")),y.default.createElement(h,{iconClassName:"mdi mdi-open-in-new",tooltip:i.MessageHash["notification_center.6"],tooltipPosition:"top-center",onClick:function(){i.goTo(t)}}));if(t.getMetadata().get("repository_id")===d)return u=y.default.createElement("div",{style:{display:"flex",alignItems:"center"}},y.default.createElement("span",{style:{flex:1}})," ",y.default.createElement(m,{label:i.MessageHash["notification_center.6"],iconClassName:"mdi mdi-open-in-new",tooltip:"Open",tooltipPosition:"top-right",onClick:function(){i.goTo(t)}})),"break";c.push(o),e<r.length-1&&c.push(y.default.createElement(v,null))}(p))break;return u&&(c=[u]),y.default.createElement("div",null,!l&&y.default.createElement("div",{style:{padding:6}},c))}}]),x);function x(e){l(this,x),n(Object.getPrototypeOf(x.prototype),"constructor",this).call(this,e);e=O(e.activity.object,e.pydio);e.length&&!e[0].isLeaf()?this.state={previewLoaded:!0,previewFailed:!1,nodes:e}:this.state={previewLoaded:!1,previewFailed:!1,nodes:e}}s(E,y["default"].Component),a(E,[{key:"render",value:function(){var t=this,e=this.props,o=e.pydio,a=e.activity,i=e.children,n=e.linkStyle;a.object.name||(a.object.name="");var r=O(a.object,o),l=void 0,s=void 0,c=void 0,u=void 0,e=a.object.name.replace("doc://","").split("/");e.shift();e="/"+e.join("/");return 1<r.length?(l=function(){o.goTo(r[0])},c=g(function(){t.setState({showPopover:!1})},350),s=function(e){t.setState({showPopover:!0,popoverAnchor:e.currentTarget}),c.cancel()},u=y.default.createElement(d,{open:this.state.showPopover,anchorEl:this.state.popoverAnchor,onRequestClose:function(e){"clickAway"!==e&&t.setState({showPopover:!1})},anchorOrigin:{horizontal:"left",vertical:"bottom"},targetOrigin:{horizontal:"left",vertical:"top"},useLayerForClickAway:!1},y.default.createElement(p,{zDepth:2,style:{width:200,height:"auto",overflowY:"auto"},onMouseOver:function(e){t.setState({showPopover:!0}),c.cancel()},onMouseOut:c},y.default.createElement(_,{pydio:o,activity:a})))):1===r.length&&(l=function(){o.goTo(r[0])}),y.default.createElement("span",null,y.default.createElement("a",{title:e,style:f({cursor:"pointer",color:"rgb(66, 140, 179)"},n),onMouseOver:s,onMouseOut:c,onClick:l},i),u)}}]),a=E;function E(e){l(this,E),n(Object.getPrototypeOf(E.prototype),"constructor",this).call(this,e),this.state={showPopover:!1,popoverAnchor:null}}a.PropTypes={activity:c.default.object,pydio:c.default.instanceOf(u)},o.default=a=e(a),o.default=a,o.nodesFromObject=O},{"lodash.debounce":"lodash.debounce","material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio","pydio/model/meta-node-provider":"pydio/model/meta-node-provider",react:"react"}],6:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}var l=r(e("react")),s=(e("material-ui"),r(e("./ActivityList"))),e=Pydio.requireLib("boot").PydioContextConsumer,c=Pydio.requireLib("workspaces").InfoPanelCard,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,l["default"].Component),a(u,[{key:"render",value:function(){var e=this.props,t=e.node,e=e.pydio;return!1===e.getPluginConfigs("core.activitystreams").get("ACTIVITY_SHOW_ACTIVITIES")?null:l.default.createElement(c,{identifier:"activity",title:t.isLeaf()?e.MessageHash["notification_center.11"]:e.MessageHash["notification_center.10"]},l.default.createElement(s.default,{context:"NODE_ID",contextData:t.getMetadata().get("uuid"),boxName:"outbox",style:{overflowY:"scroll",maxHeight:380},listContext:"NODE-"+(t.isLeaf()?"LEAF":"COLLECTION"),pointOfView:"ACTOR",displayContext:"infoPanel"}))}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),n(Object.getPrototypeOf(u.prototype),"constructor",this).apply(this,arguments)}o.default=a=e(a),o.default=a,t.exports=o.default},{"./ActivityList":2,"material-ui":"material-ui",react:"react"}],7:[function(e,o,i){!function(n){"use strict";function a(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(i,"__esModule",{value:!0});var e=(function(e,t,o){return t&&a(e.prototype,t),o&&a(e,o),e}(t,null,[{key:"dynamicBuilder",value:function(e){var t=n.pydio,o=t.MessageHash,a=t.getUserSelection().getUniqueNode();if(!a)return[];var i=[],t=void 0;return a.getMetadata().get("meta_watched")&&(t=a.getMetadata().get("meta_watched")),i.push({name:o["meta.watch.11"],alt:o["meta.watch."+(a.isLeaf()?"12":"12b")],icon_class:t&&"META_WATCH_CHANGE"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_change")}.bind(this)}),i.push({name:o["meta.watch.9"],alt:o["meta.watch."+(a.isLeaf()?"10":"10b")],icon_class:t&&"META_WATCH_READ"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_read")}.bind(this)}),i.push({name:o["meta.watch.13"],alt:o["meta.watch."+(a.isLeaf()?"14":"14b")],icon_class:t&&"META_WATCH_BOTH"===t?"mdi mdi-checkbox-marked-circle-outline":"mdi mdi-checkbox-blank-circle-outline",callback:function(e){this.apply("watch_both")}.bind(this)}),t&&(i.push({separator:!0}),i.push({name:o["meta.watch.3"],alt:o["meta.watch."+(a.isLeaf()?"8":"4")],icon_class:"mdi mdi-close-circle-outline",callback:function(e){this.apply("watch_stop")}.bind(this)})),i}}]),t);function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}i.default=e,o.exports=i.default}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,a=arguments[t];for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}var s=r(e("react")),c=e("material-ui"),u=e("material-ui/styles"),d=r(e("./Client")),p=r(e("./ActivityList")),f=r(e("lodash.debounce")),y=r(e("color")),a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,s["default"].Component),a(h,[{key:"reloadData",value:function(){var t=this;d.default.loadActivityStreams("USER_ID",this.props.pydio.user.id,"inbox").then(function(e){t.setState({data:e})}).catch(function(e){t.setState({error:e})})}},{key:"reloadUnread",value:function(){var t=this;d.default.UnreadInbox(this.props.pydio.user.id).then(function(e){t.setState({unreadStatus:e})}).catch(function(e){})}},{key:"onStatusChange",value:function(){this.props.onUnreadStatusChange&&this.props.onUnreadStatusChange(this.state.unreadStatus)}},{key:"handleTouchTap",value:function(e){e.preventDefault(),this.reloadData(),this.setState({open:!0,anchorEl:e.currentTarget,unreadStatus:0},this.onStatusChange.bind(this))}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"componentWillMount",value:function(){var t=this;this.reloadUnread(),this.props.pydio.observe("websocket_event:activity",function(e){t.state.open?t.reloadData():t.reloadUnread()})}},{key:"render",value:function(){var e=this.props,t=e.pydio,o=e.iconStyle,a=e.muiTheme,i=this.state,n=i.open,r=i.anchorEl,e=i.unreadStatus,i={borderRadius:"50%"};return n&&o&&o.color&&(i=l({},i,{backgroundColor:(0,y.default)(o.color).fade(.9).toString()})),s.default.createElement("span",null,s.default.createElement("div",{style:{position:"relative",display:"inline-block"},badgeContent:this.state.unreadStatus,secondary:!0,badgeStyle:this.state.unreadStatus?null:{display:"none"}},s.default.createElement(c.IconButton,{onClick:this.handleTouchTap.bind(this),iconClassName:this.props.iconClassName||"mdi mdi-bell",tooltip:(e?e+" ":"")+this.props.pydio.MessageHash["notification_center.4"],className:"userActionButton alertsButton",iconStyle:o,style:i}),0<e&&s.default.createElement("div",{style:{width:6,height:6,borderRadius:"50%",top:9,right:6,position:"absolute",backgroundColor:a.palette.accent1Color}})),s.default.createElement(c.Popover,{open:n,anchorEl:r,anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},onRequestClose:this.handleRequestClose.bind(this),style:{width:320},zDepth:3},s.default.createElement("div",{style:{display:"flex",alignItems:"center",borderRadius:"2px 2px 0 0",width:"100%",backgroundColor:"#f8fafc",borderBottom:"1px solid #ECEFF1",color:a.palette.primary1Color}},s.default.createElement("span",{className:"mdi mdi-bell",style:{fontSize:18,margin:"12px 8px 14px 16px"}}),s.default.createElement("span",{style:{fontSize:15,fontWeight:500}},t.MessageHash["notification_center.1"])),this.state.data&&s.default.createElement(p.default,{items:this.state.data.items,style:{overflowY:"scroll",maxHeight:420,paddingTop:20},groupByDate:!0,displayContext:"popover"})))}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),n(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,e),this.state={unreadStatus:0,open:!1,data:[]},this.reloadData=(0,f.default)(this.reloadData.bind(this),500),this.reloadUnread=(0,f.default)(this.reloadUnread.bind(this),500)}o.default=a=(0,u.muiThemeable)()(a),o.default=a,t.exports=o.default},{"./ActivityList":2,"./Client":4,color:"color","lodash.debounce":"lodash.debounce","material-ui":"material-ui","material-ui/styles":"material-ui/styles",react:"react"}],9:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n=function(e,t,o){for(var a=!0;a;){var i=e,n=t,r=o,a=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(r)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,o=r,a=!0,l=void 0}};function r(e){return e&&e.__esModule?e:{default:e}}var l=r(e("react")),s=r(e("pydio")),c=e("material-ui"),u=r(e("pydio/http/api")),d=e("cells-sdk"),p=s.default.requireLib("hoc").ModernSelectField,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,l["default"].Component),a(f,[{key:"valueFromNodes",value:function(){var t=!1,o=void 0;return(arguments.length<=0||void 0===arguments[0]?[]:arguments[0]).forEach(function(e){e=e.getMetadata().get("meta_watched")||"";void 0!==o&&e!==o&&(t=!0),o=e}),{value:o,mixed:t}}},{key:"onSelectorChange",value:function(n){var r,e,t=this;"mixed"!==n&&(e=this.props,r=e.pydio,e=e.nodes,this.setState({saving:!0}),e=e.map(function(o){var e=o.getMetadata().get("uuid"),t=r.user.id,a=new d.ActivitySubscription,i=new d.ActivityOwnerType;a.UserId=t,a.ObjectId=e,a.ObjectType=i.NODE;i=[];return"META_WATCH_CHANGE"!==n&&"META_WATCH_BOTH"!==n||i.push("change"),"META_WATCH_READ"!==n&&"META_WATCH_BOTH"!==n||i.push("read"),a.Events=i,new d.ActivityServiceApi(u.default.getRestClient()).subscribe(a).then(function(e){var t=o.getMetadata().get("overlay_class")||"";""===n?(o.getMetadata().delete("meta_watched"),o.getMetadata().set("overlay_class",t.replace("mdi mdi-bell",""))):(o.getMetadata().set("meta_watched",n),(t=t.replace("mdi mdi-bell","").split(",")).push("mdi mdi-bell"),o.getMetadata().set("overlay_class",t.join(","))),o.notify("node_replaced")})}),Promise.all(e).then(function(){t.setState({value:n,mixed:!1}),window.setTimeout(function(){t.setState({saving:!1})},250)}).catch(function(){t.setState({saving:!1})}))}},{key:"render",value:function(){var a=this,e=this.state,t=e.value,o=e.mixed,i=e.saving,e=s.default.getInstance().MessageHash;return i?l.default.createElement(p,{value:"saving",onChange:function(e,t,o){},disabled:!0},l.default.createElement(c.MenuItem,{value:"saving",primaryText:e["meta.watch.selector.saving"]+"..."})):l.default.createElement(p,{value:o?"mixed":t,onChange:function(e,t,o){a.onSelectorChange(o)}},o&&l.default.createElement(c.MenuItem,{value:"mixed",primaryText:e["meta.watch.selector.mixed"]+"..."}),l.default.createElement(c.MenuItem,{value:"",primaryText:e["meta.watch.selector.ignore"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_READ",primaryText:e["meta.watch.selector.read"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_CHANGE",primaryText:e["meta.watch.selector.change"]}),l.default.createElement(c.MenuItem,{value:"META_WATCH_BOTH",primaryText:e["meta.watch.selector.both"]}))}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),n(Object.getPrototypeOf(f.prototype),"constructor",this).call(this,e);e=this.props.nodes;this.state=this.valueFromNodes(e)}o.default=a,t.exports=o.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api",react:"react"}],10:[function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e.default:e}Object.defineProperty(o,"__esModule",{value:!0});var i=e("./InfoPanel");o.InfoPanel=a(i);i=e("./UserPanel");o.UserPanel=a(i);i=e("./Client");o.ASClient=a(i);i=e("./Activity");o.Activity=a(i);i=e("./ActivityList");o.ActivityList=a(i);i=e("./Listener");o.Listener=a(i);i=e("./Callbacks");o.Callbacks=a(i);e=e("./WatchSelector");o.WatchSelector=a(e)},{"./Activity":1,"./ActivityList":2,"./Callbacks":3,"./Client":4,"./InfoPanel":6,"./Listener":7,"./UserPanel":8,"./WatchSelector":9}]},{},[10])(10)});