"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,o=arguments[t];for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},_createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),_get=function(e,t,i){for(var o=!0;o;){var r=e,a=t,n=i,o=!1;null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,a);if(void 0!==s){if("value"in s)return s.value;var l=s.get;return void 0===l?void 0:l.call(n)}r=Object.getPrototypeOf(r);if(null===r)return;e=r,t=a,i=n,o=!0,s=void 0}};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_createReactClass=require("create-react-class"),_createReactClass2=_interopRequireDefault(_createReactClass),_pydio=require("pydio"),_pydio2=_interopRequireDefault(_pydio),_materialUiStyles=require("material-ui/styles"),_reactRedux=require("react-redux"),_redux=require("redux"),_pydioUtilPath=require("pydio/util/path"),_pydioUtilPath2=_interopRequireDefault(_pydioUtilPath),_pydioUtilDom=require("pydio/util/dom"),_pydioUtilDom2=_interopRequireDefault(_pydioUtilDom),_require=require("react-textfit"),Textfit=_require.Textfit,Color=require("color"),_Pydio$requireLib=_pydio2.default.requireLib("workspaces"),Breadcrumb=_Pydio$requireLib.Breadcrumb,SearchForm=_Pydio$requireLib.SearchForm,MainFilesList=_Pydio$requireLib.MainFilesList,Editor=_Pydio$requireLib.Editor,EditionPanel=_Pydio$requireLib.EditionPanel,_Pydio$requireLib2=_pydio2.default.requireLib("components"),ContextMenu=_Pydio$requireLib2.ContextMenu,IconButtonMenu=_Pydio$requireLib2.IconButtonMenu,Toolbar=_Pydio$requireLib2.Toolbar,ListPaginator=_Pydio$requireLib2.ListPaginator,ClipboardTextField=_Pydio$requireLib2.ClipboardTextField,_Pydio$requireLib3=_pydio2.default.requireLib("boot"),withProgressiveBg=_Pydio$requireLib3.withProgressiveBg,_Pydio$requireLib4=_pydio2.default.requireLib("hoc"),EditorActions=_Pydio$requireLib4.EditorActions,dropProvider=_Pydio$requireLib4.dropProvider,withUniqueNode=function(o){return function(e){return _inherits(t,React.PureComponent),_createClass(t,[{key:"componentDidMount",value:function(){this.detectFirstNode()}},{key:"detectFirstNode",value:function(){var e,t=this,i=this.props.pydio.getContextHolder();i.getSelectedNodes().length?this.state&&this.state.node||this.setState({node:i.getSelectedNodes()[0]}):(e=i.getRootNode().getFirstChildIfExists())?(i.setSelectedNodes([e],"dataModel"),this.setState({node:e})):setTimeout(function(){return t.detectFirstNode()},1e3),o&&i.observe("selection_changed",function(){var e=i.getSelectedNodes();e.length?this.setState({node:e[0]}):this.setState({node:null})}.bind(this))}},{key:"render",value:function(){return React.createElement(e,_extends({},this.props,this.state))}}]),t;function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}}},withRepositoriesListener=function(){return function(e){return _inherits(t,React.PureComponent),_createClass(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.pydio;this._obs=function(){return e.setState({emptyUser:!t.user})},t.observe("repository_list_refreshed",this._obs)}},{key:"componentWillUnmount",value:function(){this.props.pydio.stopObserving("repository_list_refreshed",this._obs)}},{key:"render",value:function(){return React.createElement(e,_extends({},this.props,this.state))}}]),t;function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);e=e.pydio;this.state={emptyUser:!e.user}}}},ConfigLogo=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var e=this.props.pydio,t=e.Registry.getPluginConfigs("action.advanced_settings").get("CUSTOM_MINISITE_LOGO"),i=void 0;return(t=t||e.Parameters.get("ajxpResourcesFolder")+"/themes/common/images/PydioLogoSquare.png")&&(i=0===t.indexOf("plug/")?t:e.Parameters.get("ENDPOINT_REST_API")+"/frontend/binaries/GLOBAL/"+t),React.createElement("img",{src:i,style:this.props.style})}}]),e}(),Copyright=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var e=this.props,t=e.mode,i=e.style;if("false"===e.aboutString)return null;e=void 0;return"insert"===t?e={textAlign:"right",padding:"6px 16px",backgroundColor:"#f7f7f7",color:"black"}:"overlay"===t?e={position:"absolute",bottom:0,right:0,color:"rgba(255,255,255,0.8)",padding:"6px 16px"}:"block"===t&&(e={textAlign:"center",padding:"6px 16px",color:"rgba(255,255,255)"}),React.createElement("div",{style:_extends({},e,i)},React.createElement("a",{href:"https://pydio.com",style:{fontWeight:500,color:e.color}},"Pydio Cells")," - secure file sharing")}}]),e}(),StandardLayout=(0,_createReactClass2.default)({childContextTypes:{messages:_propTypes2.default.object,getMessage:_propTypes2.default.func,showSearchForm:_propTypes2.default.bool},getChildContext:function(){var e=this.props.pydio.MessageHash;return{messages:e,getMessage:function(t){try{return e[t]||t}catch(e){return t}}}},getDefaultProps:function(){return{minisiteMode:"embed",uniqueNode:!0}},render:function(){var e={appBarStyle:{zIndex:1,backgroundColor:this.props.muiTheme.palette.primary1Color,display:"flex",alignItems:"center"},buttonsStyle:{color:Color(this.props.muiTheme.appBar.textColor).alpha(.8).toString()}},t=this.props,i=t.showSearchForm,o=t.uniqueNode,r=t.skipDisplayToolbar,a=t.bgStyle;if(t.emptyUser)return React.createElement("div",{className:"vertical_fit vertical_layout",style:a});t=[];return o?t.push("minisite_toolbar"):(t.push("info_panel"),r||t.push("display_toolbar")),React.createElement("div",{className:"vertical_fit vertical_layout",style:a},React.createElement(MaterialUI.Paper,{zDepth:1,rounded:!1,style:e.appBarStyle},React.createElement(ConfigLogo,{pydio:this.props.pydio,style:{height:50}}),React.createElement("div",{id:"workspace_toolbar",style:{display:"flex",flex:1,overflow:"hidden"}},React.createElement(Breadcrumb,_extends({},this.props,{rootStyle:{padding:"0 14px",height:36,lineHeight:"36px",maxWidth:null}})),i&&React.createElement(SearchForm,_extends({},this.props,{uniqueSearchScope:"ws",style:{marginTop:5}}))),React.createElement("div",{style:{position:"relative"}},React.createElement("div",{id:"main_toolbar",style:{display:"flex",padding:"0 8px"}},!o&&React.createElement(IconButtonMenu,_extends({},this.props,{id:"create-button-menu",toolbars:["upload","create"],buttonTitle:this.props.pydio.MessageHash[198],buttonClassName:"mdi mdi-folder-plus",buttonStyle:{color:"white"},controller:this.props.pydio.Controller})),React.createElement("div",{style:{flex:1}}),React.createElement(ListPaginator,{id:"paginator-toolbar",dataModel:this.props.pydio.getContextHolder(),toolbarDisplay:!0}),React.createElement(Toolbar,_extends({},this.props,{id:"main-toolbar",toolbars:t,groupOtherList:o?[]:["change_main","more","change","remote"],renderingType:"icon-font",buttonStyle:e.buttonsStyle}))))),this.props.children,React.createElement("span",{className:"context-menu"},React.createElement(ContextMenu,{pydio:this.props.pydio})))}}),StandardLayout=withProgressiveBg(StandardLayout);StandardLayout=dropProvider(StandardLayout);var DLTemplate=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"triggerDL",value:function(){this.setState({downloadStarted:!0}),setTimeout(function(){this.props.pydio.Controller.fireAction("download"),setTimeout(function(){this.setState({downloadStarted:!1})}.bind(this),1500)}.bind(this),100)}},{key:"componentDidMount",value:function(){var e=this.props.pydio;e.user&&e.user.activeRepository?this.setState({repoObject:e.user.repositories.get(e.user.activeRepository)}):e.observe("repository_list_refreshed",function(e){var t=e.list,e=e.active;t&&t.has(e)&&(e=t.get(e),this.setState({repoObject:e}))}.bind(this))}},{key:"render",value:function(){var t=this,e=this.props,i=e.bgStyle,o=e.node,r=e.emptyUser,a={main:_extends({},i,{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%"}),block:{cursor:"pointer",width:300,margin:"0 auto",textAlign:"center",background:"rgba(255, 255, 255, 0.91)",padding:20,borderRadius:4,boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)"},logo:{width:230,margin:"-50px auto 0"},filename:{fontSize:22,lineHeight:"22px",wordBreak:"break-all"},fileIcon:{fontSize:180,color:this.props.muiTheme.palette.primary1Color},dlIcon:{position:"absolute",top:90,left:80,fontSize:60,color:"#f4f4f4",transition:_pydioUtilDom2.default.getBeziersTransition()}};if(r)return React.createElement("div",{className:"vertical_fit",style:_extends({},a.main,{width:"100%"})});e=void 0;this.state&&this.state.repoObject&&(e=this.state.repoObject.getLabel());i=null,r=React.createElement("div",{style:{fontSize:13,lineHeight:"18px"}},this.props.pydio.MessageHash[466]);o&&(i=this.triggerDL.bind(this),n=o.getMetadata().get("bytesize"),r=React.createElement("div",{style:{fontSize:13,lineHeight:"18px",color:"rgba(0,0,0,.43)"}},React.createElement("div",{style:{display:"flex"}},React.createElement("div",{style:{flex:1,textAlign:"right",paddingRight:6,fontWeight:500}},this.props.pydio.MessageHash[503]),React.createElement("div",{style:{flex:1,textAlign:"left",color:"rgba(0,0,0,.73)"}},_pydioUtilPath2.default.roundFileSize(n))),React.createElement("div",{style:{fontSize:12,marginTop:10}},this.props.pydio.MessageHash["share_center.231"]))),this.state&&this.state.downloadStarted&&(a.dlIcon.opacity=.3);var o=this.props.pydio.Controller.getActionByName("share_current_page"),n=void 0;return o&&!o.deny&&(n=React.createElement("a",{style:{display:"block",textAlign:"center",padding:12,cursor:"pointer"},onClick:function(){t.setState({displayShareLink:!0})}},o.options.text)),React.createElement("div",{style:a.main},React.createElement(ConfigLogo,{pydio:this.props.pydio,style:a.logo}),React.createElement("div",{className:["download-block"].join(" "),onClick:i,style:a.block},React.createElement("span",{style:a.filename},React.createElement(Textfit,{min:12,max:25,perfectFit:!1,mode:"single"},e)),React.createElement("div",{style:{width:220,margin:"0 auto",position:"relative"}},React.createElement("span",{style:a.fileIcon,className:"mdi mdi-file"}),React.createElement("span",{style:a.dlIcon,className:"mdi mdi-download"})),r),this.state&&this.state.displayShareLink&&React.createElement("div",{style:{width:267,margin:"10px auto",backgroundColor:"rgba(255, 255, 255, 0.85)",padding:"0px 10px",borderRadius:2}},React.createElement(ClipboardTextField,{floatingLabelText:o.options.text,inputValue:document.location.href,getMessage:function(e){return t.props.pydio.MessageHash[e]},buttonStyle:{right:-8,bottom:9}})),React.createElement(Copyright,_extends({mode:"block"},this.props)),!(this.state&&this.state.displayShareLink)&&n)}}]),e}(),FolderMinisite=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return React.createElement(StandardLayout,_extends({},this.props,{uniqueNode:!1,showSearchForm:this.props.pydio.getPluginConfigs("action.share").get("SHARED_FOLDER_SHOW_SEARCH")}),React.createElement("div",{style:{backgroundColor:"white"},className:"layout-fill vertical-layout"},React.createElement(MainFilesList,_extends({ref:"list"},this.props,{dataModel:this.props.pydio.getContextHolder()})),React.createElement(Copyright,_extends({mode:"insert"},this.props))),React.createElement(EditionPanel,this.props))}}]),e}(),FileMinisite=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"componentWillReceiveProps",value:function(e){var t,i=this,o=e.pydio,r=e.node,a=e.dispatch;r&&(o.UI.registerEditorOpener(this),e=_pydioUtilPath2.default.getAjxpMimeType(r),(e=o.Registry.findEditorsForMime(e,!1)).length&&e[0].openable&&(t=e[0],o.Registry.loadEditorResources(t.resourcesManager,function(){var e=null;(e=FuncUtils.getFunctionByName(t.editorClass,window))?(e=a(EditorActions.tabCreate({id:r.getLabel(),title:r.getLabel(),url:r.getPath(),icon:PydioWorkspaces.FilePreview,Editor:e.Editor,Controls:e.Controls,metadata:r.getMetadata(),readonly:"true"===r.getMetadata().get("node_readonly"),pydio:o,node:r,editorData:t,registry:o.Registry})).id,a(EditorActions.editorSetActiveTab(e))):i.setState({error:"Cannot find editor component ("+t.editorClass+")!"})})))}},{key:"openEditorForNode",value:function(t,i){var o=this,r=this.props.dispatch;pydio.Registry.loadEditorResources(i.resourcesManager,function(){var e;(e=FuncUtils.getFunctionByName(i.editorClass,window))?r(EditorActions.tabModify({id:t.getLabel(),title:t.getLabel(),url:t.getPath(),icon:PydioWorkspaces.FilePreview,Editor:e.Editor,Controls:e.Controls,metadata:t.getMetadata(),readonly:"true"===t.getMetadata().get("node_readonly"),pydio:pydio,node:t,editorData:i,registry:pydio.Registry})):o.setState({error:"Cannot find editor component ("+i.editorClass+")!"})})}},{key:"componentWillUnmount",value:function(){pydio.UI.unregisterEditorOpener(this)}},{key:"render",value:function(){return React.createElement(StandardLayout,_extends({},this.props,{uniqueNode:!0,skipDisplayToolbar:!0}),React.createElement("div",{className:"editor_container vertical_layout vertical_fit",style:{backgroundColor:"#424242"}},React.createElement(Editor,{displayToolbar:!1,style:{display:"flex",flex:1}}),React.createElement(Copyright,_extends({mode:"overlay"},this.props))))}}]),e}(),DropZoneMinisite=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return React.createElement(StandardLayout,this.props,React.createElement("div",{className:"vertical_fit vertical_layout",style:{backgroundColor:"white"}},React.createElement("div",{className:"vertical_fit vertical_layout",style:{margin:16,marginBottom:2,border:"2px dashed #CFD8DC",borderRadius:4}},React.createElement(MainFilesList,_extends({ref:"list",dataModel:this.props.pydio.getContextHolder()},this.props))),React.createElement(Copyright,_extends({mode:"insert",style:{backgroundColor:"white"}},this.props))),React.createElement(EditionPanel,this.props))}}]),e}(),FilmStripMinisite=function(){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,React.Component),_createClass(e,[{key:"componentDidMount",value:function(){pydio.UI.registerEditorOpener(this)}},{key:"componentWillUnmount",value:function(){pydio.UI.unregisterEditorOpener(this)}},{key:"componentWillReceiveProps",value:function(e){var t,i=this,o=e.pydio,r=e.node,a=e.dispatch;this.props.node&&a(EditorActions.tabDelete(this.props.node.getLabel())),r&&r.isLeaf()&&(e=_pydioUtilPath2.default.getAjxpMimeType(r),(e=o.Registry.findEditorsForMime(e,!1)).length&&e[0].openable&&(t=e[0],o.Registry.loadEditorResources(t.resourcesManager,function(){var e=null;(e=FuncUtils.getFunctionByName(t.editorClass,window))?(e=a(EditorActions.tabCreate({id:r.getLabel(),title:r.getLabel(),url:r.getPath(),icon:PydioWorkspaces.FilePreview,Editor:e.Editor,Controls:e.Controls,metadata:r.getMetadata(),readonly:"true"===r.getMetadata().get("node_readonly"),pydio:o,node:r,editorData:t,registry:o.Registry})).id,a(EditorActions.editorSetActiveTab(e))):i.setState({error:"Cannot find editor component ("+t.editorClass+")!"})})))}},{key:"openEditorForNode",value:function(t,i){var o=this,r=this.props.dispatch;t.isLeaf()&&pydio.Registry.loadEditorResources(i.resourcesManager,function(){var e;(e=FuncUtils.getFunctionByName(i.editorClass,window))?r(EditorActions.tabModify({id:t.getLabel(),title:t.getLabel(),url:t.getPath(),icon:PydioWorkspaces.FilePreview,Editor:e.Editor,Controls:e.Controls,metadata:t.getMetadata(),readonly:"true"===t.getMetadata().get("node_readonly"),pydio:pydio,node:t,editorData:i,registry:pydio.Registry})):o.setState({error:"Cannot find editor component ("+i.editorClass+")!"})})}},{key:"render",value:function(){var e=this.props&&this.props.node?this.props.node:null,t=void 0;return e&&e.isLeaf()&&(t=React.createElement(Editor,{displayToolbar:!1,style:{display:"flex",flex:1}})),React.createElement(StandardLayout,_extends({},this.props,{skipDisplayToolbar:!0}),React.createElement("div",{className:"vertical_layout",style:{flex:1,backgroundColor:"#424242",position:"relative"}},t),React.createElement("div",{style:{height:10,background:"#424242",zIndex:1}}),React.createElement("div",{className:"vertical_layout",style:{height:250,backgroundColor:"#424242",zIndex:1}},React.createElement(MainFilesList,_extends({ref:"list",dataModel:this.props.pydio.getContextHolder()},this.props,{horizontalRibbon:!0,displayMode:"grid-160"})),React.createElement(Copyright,_extends({mode:"insert"},this.props))))}}]),e}();window.ShareTemplates={FolderMinisite:(0,_redux.compose)((0,_materialUiStyles.muiThemeable)(),withRepositoriesListener())(FolderMinisite),FileMinisite:(0,_redux.compose)(withRepositoriesListener(),withUniqueNode(!1),(0,_materialUiStyles.muiThemeable)(),(0,_reactRedux.connect)())(FileMinisite),DLTemplate:(0,_redux.compose)((0,_materialUiStyles.muiThemeable)(),withUniqueNode(!1),withRepositoriesListener())(withProgressiveBg(DLTemplate)),DropZoneMinisite:(0,_redux.compose)((0,_materialUiStyles.muiThemeable)(),withRepositoriesListener())(DropZoneMinisite),FilmStripMinisite:(0,_redux.compose)(withRepositoriesListener(),withUniqueNode(!0),(0,_materialUiStyles.muiThemeable)(),(0,_reactRedux.connect)())(FilmStripMinisite)};