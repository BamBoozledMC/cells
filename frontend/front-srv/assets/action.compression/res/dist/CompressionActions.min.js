!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).CompressionActions=e()}(function(){return function o(n,r,a){function s(t,e){if(!r[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i}i=r[t]={exports:{}},n[t][0].call(i.exports,function(e){return s(n[t][1][e]||e)},i,i.exports,o,n,r,a)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e){return e&&e.__esModule?e:{default:e}}var a=r(e("pydio")),s=r(e("create-react-class")),l=r(e("pydio/http/api")),u=e("cells-sdk"),c=r(e("pydio/util/path")),d=e("material-ui"),a=a.default.requireLib("hoc"),p=a.ModernTextField,f=a.ModernSelectField,s=(0,s.default)({mixins:[PydioReactUI.ActionDialogMixin,PydioReactUI.CancelButtonProviderMixin,PydioReactUI.SubmitButtonProviderMixin],getDefaultProps:function(){var e=["zip","tar","tar.gz"];return pydio.Parameters.get("multipleFilesDownloadEnabled")||e.pop(),{dialogTitleId:313,legendId:314,dialogIsModal:!0,formats:e}},getInitialState:function(){var e=void 0,t=this.props.userSelection;t.isUnique()?(e=c.default.getBasename(t.getUniqueFileName()),t.hasDir()||(e=e.substr(0,e.lastIndexOf(".")))):""===(e=c.default.getBasename(t.getContextNode().getPath()))&&(e="Archive");t=this.props.formats[0];return{archiveBase:e,compression:t,fileName:this.buildUniqueFileName(e,t)}},buildUniqueFileName:function(e,t){for(var i=0,o=e,n=e;this.props.userSelection.fileNameExists(o+"."+t,!0);)0<i&&(o=n+"-"+i),i++;return o},textFieldChange:function(e,t){this.setState({archiveBase:t,fileName:this.buildUniqueFileName(t,this.state.compression)})},selectFieldChange:function(e,t,i){this.setState({compression:i,fileName:this.buildUniqueFileName(this.state.archiveBase,i)})},submit:function(){var t=this,e=this.props.userSelection.getFileNames(),i=this.props.pydio.user.getActiveRepositoryObject().getSlug(),o=(o=i+this.props.userSelection.getContextNode().getPath()+"/"+this.state.fileName+"."+this.state.compression).replace("//","/"),o=u.RestUserJobRequest.constructFromObject({JobName:"compress",JsonParameters:JSON.stringify({archiveName:o,format:this.state.compression,nodes:e.map(function(e){return i+e})})}),e=new u.JobsServiceApi(l.default.getRestClient());console.log("Sending background job",o),e.userCreateJob("compress",o).then(function(e){t.dismiss()})},render:function(){var e=this.props.formats.map(function(e){return React.createElement(d.MenuItem,{value:e,primaryText:"."+e})}),t=this.props.pydio.MessageHash,i=this.state,o=i.compression,n=i.fileName,i={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};return React.createElement("div",{style:{display:"flex"}},React.createElement(p,{style:{width:210,marginRight:10},onChange:this.textFieldChange,value:n,floatingLabelText:t["compression.4"],floatingLabelStyle:i}),React.createElement(f,{style:{width:160},onChange:this.selectFieldChange,value:o,floatingLabelText:t["compression.3"],floatingLabelStyle:i},e))}}),o=(o(m,null,[{key:"compressUI",value:function(e){var t=e.getPydio(),e=t.getUserSelection();t.Parameters.get("multipleFilesDownloadEnabled")&&t.UI.openComponentInModal("CompressionActions","CompressionDialog",{userSelection:e})}},{key:"extract",value:function(e){var t=e.getPydio(),i=t.getUserSelection();i.isEmpty()||(e=i.getUniqueFileName(),"gz"===(i=c.default.getFileExtension(e))&&(i="tar.gz"),t=t.user.getActiveRepositoryObject().getSlug(),i=u.RestUserJobRequest.constructFromObject({JobName:"extract",JsonParameters:JSON.stringify({node:t+e,format:i,target:""})}),new u.JobsServiceApi(l.default.getRestClient()).userCreateJob("extract",i))}}]),m);function m(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m)}i.CompressionDialog=s,i.Callbacks=o},{"cells-sdk":"cells-sdk","create-react-class":"create-react-class","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path"}]},{},[1])(1)});