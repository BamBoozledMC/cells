!function o(a,r,i){function l(n,e){if(!r[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[n]={exports:{}};a[n][0].call(t.exports,function(e){var t=a[n][1][e];return l(t||e)},t,t.exports,o,a,r,i)}return r[n].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)l(i[e]);return l}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n,o=!1;null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}a=Object.getPrototypeOf(a);if(null===a)return;e=a,t=r,n=i,o=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var w=i(e("react")),C=e("material-ui"),l=i(e("prop-types")),s=i(e("pydio/model/data-model")),E=i(e("./LogTable")),x=i(e("./LogTools")),u=i(e("../model/Log")),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,w["default"].Component),o(d,[{key:"handleLogToolsChange",value:function(e){this.setState(S({},e))}},{key:"componentWillReceiveProps",value:function(e){void 0!==e.query&&e.query!==this.state.query&&this.setState({query:e.query,page:0})}},{key:"handleReload",value:function(){this.setState({z:Math.random()})}},{key:"handleDecrPage",value:function(){this.setState({page:Math.max(this.state.page-1,0)})}},{key:"handleIncrPage",value:function(){this.setState({page:this.state.page+1})}},{key:"handleTimestampContext",value:function(e){var t;e?(t=u.default.buildTsQuery(e,5),this.setState({tmpQuery:t,focus:e})):this.setState({tmpQuery:null,focus:null})}},{key:"handleLoadingStatusChange",value:function(e,t){this.props.onLoadingStatusChange?this.props.onLoadingStatusChange(e):this.setState({loading:e}),this.setState({results:t})}},{key:"render",value:function(){var t=this,e=this.props,n=e.pydio,o=e.noHeader,a=e.service,r=e.disableExport,i=e.currentNode,l=this.state,s=l.page,u=l.size,d=l.query,c=l.tmpQuery,p=l.focus,f=l.contentType,h=l.z,m=l.results,g=n.MessageHash["ajxp_admin.logs.1"],y=w.default.createElement(x.default,{pydio:n,service:a,focus:p,onStateChange:this.handleLogToolsChange.bind(this),disableExport:r}),v=AdminComponents.AdminStyles().body,b=v.block.props,e=v.block.container,l=0===s,r=[50,100,500,1e3],v=void 0;l&&m<r[0]||p||(v={pageSizes:r,prevDisabled:l,nextDisabled:m<u,onPageNext:this.handleIncrPage.bind(this),onPagePrev:this.handleDecrPage.bind(this),onPageSizeChange:function(e){t.setState({size:e,page:0})}});v=w.default.createElement(C.Paper,S({},b,{style:e}),w.default.createElement(E.default,S({pydio:n,service:a||"syslog",page:s,size:u,query:c||d,focus:p,contentType:f,z:h,onLoadingStatusChange:this.handleLoadingStatusChange.bind(this),onTimestampContext:this.handleTimestampContext.bind(this)},v)));return o?v:w.default.createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},w.default.createElement("div",{className:"vertical-layout",style:{width:"100%"}},w.default.createElement(AdminComponents.Header,{title:g,icon:i.getMetadata().get("icon_class"),actions:y,reloadAction:this.handleReload.bind(this),loading:this.state.loading}),w.default.createElement("div",{className:"layout-fill"},v,(!a||"syslog"===a)&&w.default.createElement("div",{style:{padding:"0 26px",color:"#9e9e9e",fontWeight:500}},w.default.createElement("u",null,n.MessageHash["ajxp_admin.logs.sys.note"])," ",n.MessageHash["ajxp_admin.logs.sys.note.content"]))))}}]),d);function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),r(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,e),this.state={page:0,size:100,query:"",contentType:"JSON",loading:!1,results:0}}o.propTypes={dataModel:l.default.instanceOf(s.default).isRequired},n.default=o,t.exports=n.default},{"../model/Log":6,"./LogTable":3,"./LogTools":4,"material-ui":"material-ui","prop-types":"prop-types","pydio/model/data-model":"pydio/model/data-model",react:"react"}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n,o=!1;null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}a=Object.getPrototypeOf(a);if(null===a)return;e=a,t=r,n=i,o=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=i(e("react")),u=i(e("react-dom")),d=i(e("prop-types")),c=i(e("pydio")),h=e("cells-sdk"),m=e("material-ui"),g=i(e("clipboard")),y=c.default.requireLib("components").UserAvatar,v=(s(b,f["default"].Component),o(b,[{key:"render",value:function(){var e=this.props,t=e.iconClassName,n=e.legend,o=e.data,e=(e.selectable,{icon:{margin:"16px 20px 0"},legend:{fontSize:12,color:"#aaaaaa",fontWeight:500,textTransform:"lowercase"},data:{fontSize:15,paddingRight:6,overflow:"hidden",textOverflow:"ellipsis",userSelect:"text"}});return f.default.createElement("div",{style:{display:"flex",marginBottom:8,overflow:"hidden"}},f.default.createElement("div",{style:{width:64}},f.default.createElement(m.FontIcon,{color:"#aaaaaa",className:t,style:e.icon})),f.default.createElement("div",{style:{flex:1}},f.default.createElement("div",{style:e.legend},n),f.default.createElement("div",{style:e.data},o)))}}]),b);function b(){l(this,b),r(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}s(S,f["default"].Component),o(S,[{key:"componentDidMount",value:function(){this.attachClipboard()}},{key:"componentWillUnmount",value:function(){this.detachClipboard()}},{key:"attachClipboard",value:function(){var e=this.props,o=e.log;e.pydio;this.detachClipboard(),this.refs["copy-button"]&&(this._clip=new g.default(u.default.findDOMNode(this.refs["copy-button"]),{text:function(e){var n=[];return Object.keys(o).map(function(e){var t=o[e];t&&("RoleUuids"===e&&(t=t.join(",")),n.push(e+" : "+t))}),n.join("\n")}.bind(this)}),this._clip.on("success",function(){var e=this;this.setState({copySuccess:!0},function(){setTimeout(function(){e.setState({copySuccess:!1})},3e3)})}.bind(this)),this._clip.on("error",function(){}.bind(this)))}},{key:"detachClipboard",value:function(){this._clip&&this._clip.destroy()}},{key:"focusPeriod",value:function(){var e=this.props;(0,e.onSelectPeriod)(e.log.Ts)}},{key:"unfocusPeriod",value:function(){var e=this.props,t=e.onSelectPeriod;e.focus&&t(null)}},{key:"render",value:function(){var e=this,t=this.props,n=t.log,o=t.pydio,a=t.onRequestClose,r=t.onSelectPeriod,i=t.style,l=t.focus,s=t.userDisplay,u=void 0===s?"avatar":s,d=this.state.copySuccess,t={divider:{marginTop:5,marginBottom:5},userLegend:{marginTop:-16,paddingBottom:10,textAlign:"center",color:"#9E9E9E",fontWeight:500},buttons:{position:"absolute",top:6,right:6,display:"flex"},button:{height:36,width:36,padding:8},buttonIcon:{fontSize:20}},s=void 0;(n.Profile||n.RoleUuids||n.GroupPath)&&(c=[],n.Profile&&c.push("Profile: "+n.Profile),n.GroupPath&&c.push("Group: "+n.GroupPath),n.RoleUuids&&c.push("Roles: "+n.RoleUuids.join(",")),s=c.join(" - "));var c=n.Msg;return"error"===n.Level&&(c=f.default.createElement("span",{style:{color:"#e53935"}},n.Msg)),f.default.createElement("div",{style:p({fontSize:13,color:"rgba(0,0,0,.87)",paddingBottom:10},i)},f.default.createElement(m.Paper,{zDepth:1,style:{backgroundColor:"#f5f5f5",marginBottom:10,position:"relative"}},f.default.createElement("div",{style:t.buttons},f.default.createElement(m.IconButton,{style:t.button,iconStyle:t.buttonIcon,iconClassName:d?"mdi mdi-check":"mdi mdi-content-copy",tooltip:"Copy log to clipboard",tooltipPosition:"bottom-left",ref:"copy-button"}),r&&f.default.createElement(m.IconButton,{style:t.button,iconStyle:p({},t.buttonIcon,{color:l?"#ff5722":null}),iconClassName:"mdi mdi-clock",onClick:(l?this.unfocusPeriod:this.focusPeriod).bind(this),tooltip:"Show +/- 5 minutes",tooltipPosition:"bottom-left"}),f.default.createElement(m.IconButton,{style:t.button,iconStyle:t.buttonIcon,iconClassName:"mdi mdi-close",onClick:function(){e.unfocusPeriod(),a()},tooltip:"Close log detail",tooltipPosition:"bottom-left"})),"avatar"===u&&n.UserName&&f.default.createElement(y,{pydio:o,userId:n.UserName,richCard:!0,displayLabel:!0,displayAvatar:!0,noActionsPanel:!0}),"avatar"===u&&s&&f.default.createElement("div",{style:t.userLegend},s)),n.UserName&&"inline"===u&&f.default.createElement("div",null,f.default.createElement(v,{iconClassName:"mdi mdi-account",legend:"User",data:n.UserName}),s&&f.default.createElement(v,{iconClassName:"mdi mdi-account-multiple",legend:"User Attributes",data:s}),f.default.createElement(m.Divider,{style:t.divider})),f.default.createElement(v,{iconClassName:"mdi mdi-calendar",legend:"Event Date",data:new Date(1e3*n.Ts).toLocaleString()}),f.default.createElement(v,{iconClassName:"mdi mdi-comment-text",legend:"Event Message",data:c}),f.default.createElement(v,{iconClassName:"mdi mdi-server-network",legend:"Service",data:n.Logger}),(n.RemoteAddress||n.UserAgent||n.HttpProtocol)&&f.default.createElement(m.Divider,{style:t.divider}),n.RemoteAddress&&f.default.createElement(v,{iconClassName:"mdi mdi-cast-connected",legend:"Connection IP",data:n.RemoteAddress}),n.UserAgent&&f.default.createElement(v,{iconClassName:"mdi mdi-cellphone-link",legend:"User Agent",data:n.UserAgent}),n.HttpProtocol&&f.default.createElement(v,{iconClassName:"mdi mdi-open-in-app",legend:"Protocol",data:n.HttpProtocol}),n.NodePath&&f.default.createElement("div",null,f.default.createElement(m.Divider,{style:t.divider}),f.default.createElement(v,{iconClassName:"mdi mdi-file-tree",legend:"File/Folder",data:n.NodePath}),f.default.createElement(v,{iconClassName:"mdi mdi-folder-open",legend:"In Workspace",data:n.WsUuid})))}}]),o=S;function S(e){l(this,S),r(Object.getPrototypeOf(S.prototype),"constructor",this).call(this,e),this.state={copySuccess:!1}}o.PropTypes={pydio:d.default.instanceOf(c.default),log:d.default.instanceOf(h.LogLogMessage)},n.default=o,t.exports=n.default},{"cells-sdk":"cells-sdk",clipboard:"clipboard","material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio",react:"react","react-dom":"react-dom"}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n,o=!1;null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}a=Object.getPrototypeOf(a);if(null===a)return;e=a,t=r,n=i,o=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var C=i(e("react")),u=i(e("pydio")),E=e("material-ui"),d=i(e("../model/Log")),x=i(e("./LogDetail")),O=u.default.requireLib("components").MaterialTable,P=u.default.requireLib("boot").moment,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,C["default"].Component),o(l,[{key:"initRootSpans",value:function(e){if(!e||!e.length)return{logs:[],rootSpans:{}};for(var n={},t=e.map(function(e,t){return e.SpanUuid||(e.SpanUuid="span-"+t),e.SpanRootUuid||(n[e.SpanUuid]={open:!0,children:[]}),e}),o=[],a=0;a<t.length;a++){var r,i=t[a];i.SpanRootUuid&&n[i.SpanRootUuid]?(n[i.SpanRootUuid].children.push(i),i.HasRoot=!0):!i.SpanRootUuid||n[i.SpanRootUuid]?o.push(i):((r=w({},i)).SpanUuid=i.SpanRootUuid,i.HasRoot=!0,n[i.SpanRootUuid]={open:!0,children:[i]},o.push(r))}return{logs:o,rootSpans:n}}},{key:"openSpans",value:function(){for(var e=this.state,t=e.logs,n=e.rootSpans,o=[],a=0;a<t.length;a++){var r,i=t[a],l=n[i.SpanUuid];l.children.length&&(i.HasChildren=!0,i.IsOpen=l.open,i.RemoteAddress||(r=l.children.filter(function(e){return e.RemoteAddress})).length&&(i.RemoteAddress=r[0].RemoteAddress)),o.push(i),l.open&&(o=[].concat(s(o),s(l.children)))}return o}},{key:"load",value:function(e,t,n,o,a,r){var i=this,l=this.state.logs;r&&(this.setState({loading:!0}),r(!0,l.length)),u.default.startLoading(),d.default.loadLogs(e,t,n,o,a).then(function(e){u.default.endLoading();var t=i.initRootSpans(e.Logs),n=t.logs,t=t.rootSpans;i.setState({logs:n,rootSpans:t,loading:!1},function(){r&&r(!1,e.Logs?e.Logs.length:0)})}).catch(function(e){u.default.endLoading(),r&&(i.setState({loading:!1}),r(!1,l.length))})}},{key:"componentWillMount",value:function(){var e=this.props,t=e.service,n=e.page,o=e.size,e=e.onLoadingStatusChange;this.load(t,"",n,o,"JSON",e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.service,n=e.query,o=e.page,a=e.size,r=e.onLoadingStatusChange,e=e.z;n===this.props.query&&a===this.props.size&&o===this.props.page&&e===this.props.z||this.load(t,n,o,a,"JSON",r)}},{key:"render",value:function(){var t,n,o=this,e=this.state,a=e.loading,r=e.rootSpans,i=e.selectedRows,l=this.props,s=l.pydio,u=l.onTimestampContext,d=l.query,c=l.focus,p=this.props,f=p.onPageNext,h=p.onPagePrev,m=p.nextDisabled,g=p.prevDisabled,y=p.onPageSizeChange,v=p.page,b=p.size,S=p.pageSizes,e=this.openSpans();i.length&&(t={paddingBottom:20,paddingLeft:53,backgroundColor:"#fafafa",marginTop:-10,paddingTop:10},n=JSON.stringify(i[0]),e=e.map(function(e){return JSON.stringify(e)===n?w({},e,{expandedRow:C.default.createElement(x.default,{style:t,userDisplay:"inline",pydio:s,log:e,focus:c,onSelectPeriod:u,onRequestClose:function(){return o.setState({selectedRows:[]})}})}):e}));l=s.MessageHash,p=[{name:"Root",label:"",style:{width:20,paddingLeft:0,paddingRight:0,overflow:"visible"},headerStyle:{width:20,paddingLeft:0,paddingRight:0},renderCell:function(e){if(e.HasChildren)return C.default.createElement(E.IconButton,{iconClassName:e.IsOpen?"mdi mdi-menu-down":"mdi mdi-menu-right",onClick:function(){r[e.SpanUuid].open=!r[e.SpanUuid].open,o.setState({rootSpans:r})}});return null}},{name:"Ts",label:s.MessageHash["settings.17"],renderCell:function(e){var t=P(1e3*e.Ts),n=void 0,n=t.isSame(Date.now(),"day")?t.format("HH:mm:ss"):t.toLocaleString();return e.HasRoot?C.default.createElement("span",{style:{display:"flex",alignItems:"center"}},C.default.createElement(E.FontIcon,{className:"mdi mdi-play-circle-outline",style:{fontSize:12,marginRight:5}})," ",n):n},style:{width:130,padding:12},headerStyle:{width:130,padding:12}},{name:"Logger",label:l["ajxp_admin.logs.service"],hideSmall:!0,renderCell:function(e){return e.Logger?e.Logger.replace("pydio.",""):""},style:{width:130,padding:"12px 0"},headerStyle:{width:130,padding:"12px 0"}},{name:"Msg",label:l["ajxp_admin.logs.message"],renderCell:function(e){var t=e.Msg;return e.NodePath?t+=" ["+e.NodePath+"]":e.NodeUuid&&(t+=" ["+e.NodeUuid+"]"),t}}],i=AdminComponents.AdminStyles().body.tableMaster,g=f?{page:v+1,pageSize:b,pageSizes:S,onPageNext:function(e){return f(e-1)},onPagePrev:function(e){return h(e-1)},onPageSizeChange:y,nextDisabled:m,prevDisabled:g}:void 0;return C.default.createElement(O,{data:e,columns:p,onSelectRows:function(e){o.setState({selectedRows:e}),o.props.onTimestampContext&&o.props.onTimestampContext(null)},deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:a?l["settings.33"]:d?l["ajxp_admin.logs.noresults"]:l["ajxp_admin.logs.noentries"],computeRowStyle:function(e){var t={};return e.HasRoot&&(t.backgroundColor="#F5F5F5"),"error"===e.Level&&(t.color="#E53935"),t},masterStyles:i,pagination:g})}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),r(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,e),this.state={logs:[],loading:!1,rootSpans:{},selectedRows:[]}}n.default=o,t.exports=n.default},{"../model/Log":6,"./LogDetail":2,"material-ui":"material-ui",pydio:"pydio",react:"react"}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n,o=!1;null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}a=Object.getPrototypeOf(a);if(null===a)return;e=a,t=r,n=i,o=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=i(e("pydio")),C=i(e("react")),u=i(e("lodash.debounce")),c=i(e("../model/Log")),E=e("material-ui"),d=e("material-ui/styles"),e=s.default.requireLib("hoc"),x=e.ModernTextField,O=e.ModernSelectField,P=e.ModernStyles,k=s.default.requireLib("boot").moment,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,C["default"].Component),o(p,[{key:"publishStateChange",value:function(){var e=this.state,t=e.filter,n=e.serviceFilter,o=e.level,a=e.remoteAddress,r=e.userName,i=e.date,e=e.endDate,e=c.default.buildQuery(t,n,o,a,r,i,e);this.props.onStateChange({query:e})}},{key:"handleToggleShow",value:function(e){var t=e+"Show",n=this.state[t],t=l({},t,!n);n?("date"===e||"endDate"===e?(t.date=null,t.endDate=null,t.dateShow=!1,t.endDateShow=!1):t[e]=null,t.page=0):"date"===e&&this.state.endDateShow&&(t.endDate=null,t.endDateShow=!1),this.setState(t,this.publishStateChange.bind(this))}},{key:"handleFilterChange",value:function(e,t){var n;this.setState((l(n={},t,e),l(n,"page",0),n),this.publishStateChange.bind(this))}},{key:"handleDateChange",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t&&e.setHours(t.getHours(),t.getMinutes());var n=this.state,t=n.endDate;n.endDateShow&&!t&&void 0!==e&&((t=new Date).setHours(23,59,59),this.setState({endDate:t})),this.setState({date:e,page:0},this.publishStateChange.bind(this))}},{key:"handleEndDateChange",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t&&e.setHours(t.getHours(),t.getMinutes()),this.setState({endDate:e,page:0},this.publishStateChange.bind(this))}},{key:"handleExport",value:function(o){var a=this,e=this.state,t=e.filter,n=e.serviceFilter,r=e.level,i=e.remoteAddress,l=e.userName,s=e.date,u=e.endDate,e=this.props.service,d=s?s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate():"",u=c.default.buildQuery(t,n,r,i,l,s,u);c.default.downloadLogs(e||"sys",u,o).then(function(e){var t=window.URL.createObjectURL(e),n="cells-logs-";n+=d||"filtered",n+="."+o.toLowerCase(),-1<navigator.userAgent.toLowerCase().indexOf("firefox")?a.setState({exportUrl:t,exportFilename:n,exportOnClick:function(){setTimeout(function(){window.URL.revokeObjectURL(t)},100),a.setState({exportUrl:null,exportFilename:null})}}):((e=document.createElement("a")).href=t,e.download=n,e.click(),setTimeout(function(){window.URL.revokeObjectURL(t)},100))})}},{key:"render",value:function(){var o=this,e=this.props,t=e.pydio,n=e.disableExport,a=e.muiTheme,r=e.focus,i=AdminComponents.AdminStyles(a.palette),l=this.state,s=l.filter,u=l.date,d=l.dateShow,c=l.endDate,p=l.endDateShow,f=l.serviceFilter,h=l.serviceFilterShow,m=l.level,g=l.levelShow,y=l.userName,v=l.userNameShow,b=l.remoteAddress,S=l.remoteAddressShow,e=l.exportUrl,a=l.exportFilename,l=l.exportOnClick,t=t.MessageHash,y=s||f||u||c||m||y||b,b=C.default.createElement(E.FontIcon,{style:{top:0},className:"mdi mdi-check"});return C.default.createElement("div",{style:{display:"flex",alignItems:"center",width:"100%",marginTop:3}},r&&C.default.createElement("div",{style:{backgroundColor:"#FBE9E7",height:35,lineHeight:"35px",fontSize:15,padding:"0 10px",marginRight:5,color:"#FF5722",borderRadius:3}},"Focus on +/- 5 minutes at ",k(new Date(1e3*r)).format("hh:mm:ss")),C.default.createElement("div",{style:{marginRight:5,width:170}},C.default.createElement(x,{hintText:t["ajxp_admin.logs.3"],onChange:function(e,t){return o.handleFilterChange(t,"filter")},fullWidth:!0})),g&&C.default.createElement("div",{style:{marginRight:5,marginTop:-2,width:100}},C.default.createElement(O,{hintText:"Level",fullWidth:!0,value:m,onChange:function(e,t,n){return o.handleFilterChange(n,"level")}},C.default.createElement(E.MenuItem,{primaryText:""}),C.default.createElement(E.MenuItem,{primaryText:"ERROR",value:"ERROR"}),C.default.createElement(E.MenuItem,{primaryText:"INFO",value:"INFO"}),C.default.createElement(E.MenuItem,{primaryText:"DEBUG",value:"DEBUG"}))),h&&C.default.createElement("div",{style:{marginRight:5,width:80}},C.default.createElement(x,{hintText:"Service",fullWidth:!0,value:f,onChange:function(e,t){return o.handleFilterChange(t,"serviceFilter")}})),S&&C.default.createElement("div",{style:{marginRight:5,width:80}},C.default.createElement(x,{hintText:"IP",fullWidth:!0,onChange:function(e,t){return o.handleFilterChange(t,"remoteAddress")}})),v&&C.default.createElement("div",{style:{marginRight:5,width:80}},C.default.createElement(x,{hintText:"Login",fullWidth:!0,onChange:function(e,t){return o.handleFilterChange(t,"userName")}})),d&&!p&&C.default.createElement("div",{style:{display:"flex",alignItems:"center"}},C.default.createElement(E.DatePicker,w({hintText:t["ajxp_admin.logs.2"],onChange:function(e,t){return o.handleDateChange(t)},autoOk:!0,maxDate:new Date,value:u,showYearSelector:!0,style:{width:120},textFieldStyle:{width:120}},P.textField)),C.default.createElement(E.IconButton,w({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){o.handleDateChange(void 0)}},i.props.header.iconButton))),p&&C.default.createElement("div",{style:{display:"flex",alignItems:"center"}},C.default.createElement(E.DatePicker,w({hintText:"From",onChange:function(e,t){return o.handleDateChange(t)},autoOk:!0,maxDate:new Date,value:u,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},P.textField)),C.default.createElement(E.TimePicker,w({hintText:"at...",disabled:!u,onChange:function(e,t){return o.handleDateChange(u,t)},autoOk:!0,value:u,style:{width:100},textFieldStyle:{width:96}},P.textField)),C.default.createElement(E.DatePicker,w({hintText:"To",onChange:function(e,t){return o.handleEndDateChange(t)},autoOk:!0,minDate:this.state.date,maxDate:new Date,value:c,showYearSelector:!0,style:{width:100},textFieldStyle:{width:96}},P.textField)),C.default.createElement(E.TimePicker,w({hintText:"at...",disabled:!c,onChange:function(e,t){return o.handleEndDateChange(c,t)},autoOk:!0,value:c,style:{width:100},textFieldStyle:{width:96}},P.textField)),C.default.createElement(E.IconButton,w({iconClassName:"mdi mdi-close",tooltip:"Clear",onClick:function(){o.handleDateChange(void 0),o.handleEndDateChange(void 0)}},i.props.header.iconButton))),C.default.createElement(E.IconMenu,{iconButtonElement:C.default.createElement(E.IconButton,w({iconClassName:"mdi mdi-filter-variant",tooltip:t["ajxp_admin.logs.3"]},i.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},C.default.createElement(E.Subheader,null,t["ajxp_admin.logs.filter.legend"]),C.default.createElement(E.MenuItem,{primaryText:t["ajxp_admin.logs.2"],rightIcon:d&&!p?b:null,onClick:function(){o.handleToggleShow("date")}}),C.default.createElement(E.MenuItem,{primaryText:t["ajxp_admin.logs.filter.period"],rightIcon:p?b:null,onClick:function(){o.handleToggleShow("endDate")}}),C.default.createElement(E.MenuItem,{primaryText:"Level",rightIcon:g?b:null,onClick:function(){o.handleToggleShow("level")}}),C.default.createElement(E.MenuItem,{primaryText:"Service",rightIcon:h?b:null,onClick:function(){o.handleToggleShow("serviceFilter")}}),C.default.createElement(E.MenuItem,{primaryText:"User Login",rightIcon:v?b:null,onClick:function(){o.handleToggleShow("userName")}}),C.default.createElement(E.MenuItem,{primaryText:"IP",rightIcon:S?b:null,onClick:function(){o.handleToggleShow("remoteAddress")}})),!n&&C.default.createElement(E.IconMenu,{iconButtonElement:C.default.createElement(E.IconButton,w({iconClassName:"mdi mdi-download",tooltip:t["ajxp_admin.logs.11"]},i.props.header.iconButton)),anchorOrigin:{vertical:"top",horizontal:"right"},targetOrigin:{vertical:"top",horizontal:"right"},desktop:!0},!y&&C.default.createElement(E.Subheader,null,t["ajxp_admin.logs.export.disabled"]),y&&C.default.createElement(E.Subheader,null,t["ajxp_admin.logs.11"]),C.default.createElement(E.MenuItem,{primaryText:"CSV",rightIcon:C.default.createElement(E.FontIcon,{style:{top:0},className:"mdi mdi-file-delimited"}),onClick:function(){o.handleExport("CSV")},disabled:!y}),C.default.createElement(E.MenuItem,{primaryText:"XLSX",rightIcon:C.default.createElement(E.FontIcon,{style:{top:0},className:"mdi mdi-file-excel"}),onClick:function(){o.handleExport("XLSX")},disabled:!y}),e&&C.default.createElement(E.Subheader,null,C.default.createElement("a",{href:e,download:a},a))),C.default.createElement(E.Dialog,{open:!!e,modal:!0,title:t["ajxp_admin.logs.11"],actions:[C.default.createElement(E.FlatButton,{label:"Cancel",onClick:l})]},C.default.createElement("span",{style:{fontSize:13}},t["ajxp_admin.logs.export.clicklink"],": ",C.default.createElement("a",{style:{textDecoration:"underline"},href:e,download:a,onClick:l},a))))}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e),this.state={filter:"",filterMode:"fulltext",levelShow:!1,serviceFilterShow:!1},this.publishStateChange=(0,u.default)(this.publishStateChange.bind(this),250)}n.default=o=(0,d.muiThemeable)()(o),n.default=o,t.exports=n.default},{"../model/Log":6,"lodash.debounce":"lodash.debounce","material-ui":"material-ui","material-ui/styles":"material-ui/styles",pydio:"pydio",react:"react"}],5:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var a=o(e("./board/LogBoard")),e=o(e("./board/LogTools"));window.AdminLogs={Dashboard:a.default,LogTools:e.default}},{"./board/LogBoard":1,"./board/LogTools":4}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n,o=!1;null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}a=Object.getPrototypeOf(a);if(null===a)return;e=a,t=r,n=i,o=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var l=i(e("pydio/lang/observable")),s=i(e("pydio/http/api")),u=i(e("pydio/http/resources-manager")),d=e("cells-sdk"),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,l["default"]),o(c,null,[{key:"buildQuery",value:function(e,t,n,o,a,r){var i=arguments.length<=6||void 0===arguments[6]?void 0:arguments[6],l=[];return e&&l.push('+Msg:"*'+e+'*"'),t&&l.push("+Logger:*"+t+"*"),n&&l.push("+Level:"+n),o&&l.push("+RemoteAddress:*"+o+"*"),a&&l.push("+UserName:*"+a+"*"),r&&(a=r,r=new Date(a),i?r=i:r.setDate(a.getDate()+1),l.push("+Ts:>"+Math.floor(a/1e3)),l.push("+Ts:<"+Math.floor(r/1e3))),l.join(" ")}},{key:"buildTsQuery",value:function(e,t){var n=[];return n.push("+Ts:>"+(e-60*t)),n.push("+Ts:<"+(e+60*t)),n.join(" ")}},{key:"loadLogs",value:function(e,t,n,o,a){var r=new d.LogListLogRequest;return r.Query=t,r.Page=n,r.Size=o,r.Format=d.ListLogRequestLogFormat.constructFromObject(a),"syslog"!==e?"audit"===e?u.default.loadClass("EnterpriseSDK").then(function(e){return new e.EnterpriseLogServiceApi(s.default.getRestClient()).audit(r)}):Promise.reject("Unknown service name, must be 'syslog' or 'audit'"):new d.LogServiceApi(s.default.getRestClient()).syslog(r)}},{key:"downloadLogs",value:function(e,t,n){var o=new d.LogListLogRequest;return o.Query=t,o.Page=0,o.Size=1e5,o.Format=d.ListLogRequestLogFormat.constructFromObject(n),c.auditExportWithHttpInfo(o,e).then(function(e){return e.response.body})}},{key:"auditExportWithHttpInfo",value:function(e,t){var n=e;if(null==e)throw new Error("Missing the required parameter 'body' when calling auditExport");return s.default.getRestClient().callApi("/log/"+t+"/export","POST",{},{},{},{},n,[],["application/json"],["application/json"],"Blob")}}]),c);function c(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),r(Object.getPrototypeOf(c.prototype),"constructor",this).apply(this,arguments)}n.default=o,t.exports=n.default},{"cells-sdk":"cells-sdk","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager","pydio/lang/observable":"pydio/lang/observable"}]},{},[5]);