!function n(o,r,i){function l(a,e){if(!r[a]){if(!o[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(s)return s(a,!0);t=new Error("Cannot find module '"+a+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[a]={exports:{}};o[a][0].call(t.exports,function(e){var t=o[a][1][e];return l(t||e)},t,t.exports,n,o,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)l(i[e]);return l}({1:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});n(e("pydio"));var u=n(e("react")),o=n(e("create-react-class")),r=e("material-ui/styles"),c=n(e("./JobBoard")),d=n(e("./JobsList")),i=n(e("./Loader")),o=(0,o.default)({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],getInitialState:function(){return{jobs:[],Owner:null,Filter:null}},reload:function(){this.loader.load()},componentDidMount:function(){var t=this;this.loader=new i.default,this.loader.observe("loading",function(){t.setState({loading:!0})}),this.loader.observe("loaded",function(e){t.setState({loading:!1}),e.jobs?t.setState({jobs:e.jobs}):e.error&&t.setState({error:e.error})}),this.loader.start()},componentWillUnmount:function(){this.loader.stop()},selectRows:function(e){e.length&&(e=e[0].ID,this.loader.stop(),this.setState({selectJob:e}))},render:function(){var e,t=this,a=this.props,n=a.pydio,o=a.jobsEditable,r=a.muiTheme,i=AdminComponents.AdminStyles(r.palette),l=this.state,a=l.jobs,r=l.loading,s=l.selectJob;if(s&&a){l=a.filter(function(e){return e.ID===s});if(console.log(s,l),l.length)return u.default.createElement(c.default,{pydio:n,job:l[0],jobsEditable:o,onSave:function(){t.reload()},adminStyles:i,onRequestClose:function(){t.loader.start(),t.setState({selectJob:null})}})}return u.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"}},u.default.createElement(AdminComponents.Header,{title:(e="title",n.MessageHash["ajxp_admin.scheduler."+e]||e),icon:"mdi mdi-timetable",reloadAction:this.reload.bind(this),loading:r}),u.default.createElement(d.default,{pydio:n,selectRows:function(e){t.selectRows(e)},jobs:a,loading:r}))}});a.default=o=(0,r.muiThemeable)()(o),a.default=o,t.exports=a.default},{"./JobBoard":3,"./JobsList":5,"./Loader":6,"create-react-class":"create-react-class","material-ui/styles":"material-ui/styles",pydio:"pydio",react:"react"}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var u=l(e("react")),c=l(e("pydio")),d=e("material-ui"),e=(e("cells-sdk"),c.default.requireLib("components").Stepper),f=e.Dialog,p=e.PanelBigButtons,m={NODE_CHANGE:{title:"Files and folders (nodes) events : detect files modifications to move them or update their metadata automatically.",0:{title:"trigger.create.node",icon:"file-plus",description:"A new file was uploaded or a new folder was created"},1:{title:"trigger.read.node",icon:"eye",description:"A file was downloaded or a folder content was listed"},2:{title:"trigger.update.path",icon:"folder-move",description:"A file or folder was moved or renamed"},3:{title:"trigger.update.content",icon:"content-save",description:"A file content was updated by edition or upload overwriting"},5:{title:"trigger.delete.node",icon:"delete",description:"A file or a folder was definitively deleted"},4:{title:"trigger.update.metadata",icon:"tag",description:"Internal metadata were modified on file or folder"},6:{title:"trigger.update.user-metadata",icon:"tag-multiple",description:"User-defined metadata were modified (event contains updated metadata)"}},IDM_CHANGE:{USER:{title:"User events : triggered when adding/removing user and when users log in and log out. Can be used for triggering validation flows or assigning accesses.",0:{title:"trigger.create.user",icon:"account-plus",tint:"#009688",description:"A user or a group was created"},1:{title:"trigger.read.user",icon:"account",tint:"#009688",description:"A user or a group was accessed"},2:{title:"trigger.update.user",icon:"account-box",tint:"#009688",description:"A user or a group data was updated"},3:{title:"trigger.delete.user",icon:"account-minus",tint:"#009688",description:"A user or a group was deleted"},4:{title:"trigger.bind.user",icon:"login",tint:"#009688",description:"A user has logged in"},5:{title:"trigger.logout.user",icon:"logout",tint:"#009688",description:"A user has logged out"}},ROLE:{title:"Role events : can be used to automate accesses based on role names. Use IsTeam, IsGroup, IsUser flags to filter roles.",0:{title:"Create Role",icon:"account-card-details",tint:"#607d8b",description:"New role created."},2:{title:"Update Role",icon:"pencil",tint:"#607d8b",description:"A role has been updated"},3:{title:"Delete Role",icon:"delete-forever",tint:"#607d8b",description:"A role has been deleted"}},WORKSPACE:{title:"Workspace events : triggered on workspace creation / deletion. Use the Scope flag to filter Workspaces from Cells",0:{title:"Create Workspace",icon:"folder-plus",tint:"#ff9800",description:"A workspace has been created"},2:{title:"Update Workspace",icon:"pencil",tint:"#ff9800",description:"A workspace has been updated"},3:{title:"Delete Workspace",icon:"delete-forever",tint:"#ff9800",description:"New file uploaded or folder created"}},ACL:{title:"ACL events : access control lists link workspaces, nodes and roles together to provide accesses to data.",0:{title:"Create Acl",icon:"view-list",tint:"#795548",description:"An access control has been opened"},3:{title:"Delete Acl",icon:"delete-forever",tint:"#795548",description:"An access control has been closed"}}}},n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,u["default"].Component),n(h,[{key:"onChange",value:function(){this.props.onChange(Object.keys(this.state.objEvents))}},{key:"toObject",value:function(){var t={};return(arguments.length<=0||void 0===arguments[0]?[]:arguments[0]).forEach(function(e){t[e]=e}),t}},{key:"remove",value:function(e){var t=this.state.objEvents;delete t[e],this.setState({objEvents:t},this.onChange.bind(this))}},{key:"add",value:function(e){var t=this.state.objEvents;t[e]=e,this.setState({objEvents:t},this.onChange.bind(this))}},{key:"dismiss",value:function(){this.setState({open:!1,filter:""})}},{key:"render",value:function(){var t=this,e=this.state,a=e.objEvents,n=e.open,e=e.filter,o=[];Object.keys(a).forEach(function(e){o.push(u.default.createElement(d.ListItem,{key:e,disabled:!0,primaryText:h.eventData(e).title,rightIconButton:u.default.createElement(d.IconButton,{iconClassName:"mdi mdi-delete",iconStyle:{color:"#e0e0e0"},onClick:function(){t.remove(e)}})})),o.push(u.default.createElement(d.Divider,null))}),o.pop();e=h.eventsAsBBModel(e);return u.default.createElement("div",null,u.default.createElement(f,{title:"Trigger job on...",open:n,dialogProps:{},onDismiss:function(){t.dismiss()},onFilter:function(e){t.setState({filter:e.toLowerCase()})}},u.default.createElement(p,{model:e,onPick:function(e){t.add(e),t.dismiss()}})),u.default.createElement(d.FlatButton,{style:{width:"100%"},label:"Trigger job on...",primary:!0,onClick:function(){return t.setState({open:!0})},icon:u.default.createElement(d.FontIcon,{className:"mdi mdi-pulse"})}),u.default.createElement(d.List,null,o))}}],[{key:"eventData",value:function(e){var t=e.split(":"),a=void 0,a=2===t.length&&m[t[0]]?m[t[0]][t[1]]:3===t.length&&m[t[0]]&&m[t[0]][t[1]]&&m[t[0]][t[1]][t[2]]?m[t[0]][t[1]][t[2]]:{title:e,icon:"pulse",description:""};return{title:h.T(a.title),description:h.T(a.description),icon:"mdi mdi-"+a.icon,tint:a.tint}}},{key:"T",value:function(e){return c.default.getMessages()["ajxp_admin.scheduler."+e]||e}},{key:"flatStruct",value:function(a){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=[];return Object.keys(a).forEach(function(e){var t;"title"!==e&&(isNaN(e)&&"IDM_CHANGE"!==e&&o.push({header:a[e].title}),t=a[e],isNaN(e)?o.push.apply(o,s(h.flatStruct(t,[].concat(s(n),[e])))):o.push([].concat(s(n),[e]).join(":")))}),o}},{key:"eventsAsBBModel",value:function(a){var e=h.flatStruct(m),n={Sections:[]},o=void 0;return e.forEach(function(e){var t;e.header?(o&&o.Actions.length&&n.Sections.push(o),o={title:e.header,Actions:[]}):(t=h.eventData(e),a&&-1===t.title.toLowerCase().indexOf(a)&&-1===t.description.toLowerCase().indexOf(a)||o.Actions.push(r({},t,{value:e})))}),o&&n.Sections.push(o),n}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),i(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,e),this.state={objEvents:this.toObject(e.events||[])}}a.default=n,t.exports=a.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio",react:"react"}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var m=i(e("react")),l=i(e("pydio")),s=i(e("pydio/http/api")),u=e("cells-sdk"),h=(i(e("pydio/http/resources-manager")),e("material-ui")),y=i(e("./TasksList")),g=i(e("./JobSchedule")),b=i(e("./Loader")),v=l.default.requireLib("boot").JobsStore,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,m["default"].Component),n(c,[{key:"componentDidMount",value:function(){var t=this;this.loader.start(),new u.ConfigServiceApi(s.default.getRestClient()).schedulerActionsDiscovery().then(function(e){t.setState({descriptions:e.Actions})})}},{key:"componentWillUnmount",value:function(){this.loader.stop()}},{key:"canManualRun",value:function(e){if(e.Schedule||!e.EventNames)return!0;var t=!1;console.log(e);try{e.Actions.forEach(function(e){e.TriggerFilter&&e.TriggerFilter.Query.SubQueries.forEach(function(e){e.value.IsManual&&(t=!0)})})}catch(e){}return t}},{key:"render",value:function(){var t=this,e=this.props,a=e.pydio,n=e.jobsEditable,o=e.onRequestClose,r=e.adminStyles,i=this.state,l=i.loading,s=i.create,u=i.job,c=i.descriptions;if(!u)return null;function d(e){return a.MessageHash["ajxp_admin.scheduler."+e]||e}var f=[],e=p({},r.props.header.flatButton),i=r.props.header.flatButton.labelStyle.color;return s||(b.default.canManualRun(u)&&(u.Schedule&&n&&f.push(m.default.createElement(g.default,{job:u,edit:!0,onUpdate:function(){}})),n=p({},e),u.Inactive&&(n.backgroundColor="#e0e0e0"),f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-play",color:i}),label:d("task.action.run"),disabled:u.Inactive,primary:!0,onClick:function(){v.getInstance().controlJob(u,"RunOnce")}},n)))),u.Inactive?f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-checkbox-marked-circle-outline",color:i}),label:d("task.action.enable"),primary:!0,onClick:function(){v.getInstance().controlJob(u,"Active")}},e))):f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-checkbox-blank-circle-outline",color:i}),label:d("task.action.disable"),primary:!0,onClick:function(){v.getInstance().controlJob(u,"Inactive")}},e)))),m.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"}},m.default.createElement(AdminComponents.Header,{title:m.default.createElement("span",null,m.default.createElement("a",{style:{cursor:"pointer",borderBottom:"1px solid rgba(0,0,0,.87)"},onClick:function(){return o(!0)}},a.MessageHash["ajxp_admin.scheduler.title"])," / ",u.Label," ",u.Inactive?" [disabled]":""),backButtonAction:function(){return o(!0)},actions:f,loading:l}),m.default.createElement("div",{style:{flex:1,overflowY:"auto"}},m.default.createElement(y.default,{pydio:a,job:u,onLoading:function(e){t.setState({loading:e})},descriptions:c,adminStyles:r})))}}]),c);function c(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),r(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,e),this.state={mode:"log",selectedRows:[],loading:!1,taskLogs:null,job:e.job,create:e.create,descriptions:{}},this.loader=new b.default(e.job.ID),this.loader.observe("loaded",function(e){e.job?t.setState({job:e.job,error:null}):e.error&&t.setState({error:e.error})})}a.default=n,t.exports=a.default},{"./JobSchedule":4,"./Loader":6,"./TasksList":9,"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager",react:"react"}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var l=i(e("react")),s=i(e("pydio/http/resources-manager")),u=i(e("pydio/http/api")),c=e("cells-sdk"),d=e("material-ui"),f=i(e("./ScheduleForm")),n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l["default"].Component),n(p,[{key:"updateJob",value:function(){var n=this,o=this.props.onUpdate,e=this.state,r=e.job,e=e.formState;e?("manual"===e.frequency?(void 0!==r.Schedule&&delete r.Schedule,r.AutoStart=!0):(r.Schedule={Iso8601Schedule:f.default.makeIso8601FromState(e)},void 0!==r.AutoStart&&delete r.AutoStart),s.default.loadClass("EnterpriseSDK").then(function(e){var t=e.SchedulerServiceApi,e=e.JobsPutJobRequest,t=new t(u.default.getRestClient()),a=new e;a.Job=c.JobsJob.constructFromObject(JSON.parse(JSON.stringify(r))),void 0!==a.Job.Tasks&&delete a.Job.Tasks,t.putJob(a).then(function(){o(),n.setState({open:!1,job:a.Job,rand:Math.random()})}).catch(function(e){})})):this.setState({open:!1})}},{key:"render",value:function(){var t=this,e=this.state,a=e.job,e=e.rand;return l.default.createElement("div",null,l.default.createElement(d.FlatButton,{primary:!0,icon:l.default.createElement(d.FontIcon,{className:"mdi mdi-timer"}),key:e,label:l.default.createElement(f.default,{schedule:a.Schedule,rand:e}),onClick:function(){t.setState({open:!0})}}),l.default.createElement(d.Dialog,{title:"Job Schedule",actions:[l.default.createElement(d.FlatButton,{label:"Close",onClick:function(){t.setState({open:!1})}}),l.default.createElement(d.FlatButton,{label:"Save",onClick:function(){t.updateJob()}})],modal:!1,open:this.state.open,contentStyle:{width:320}},l.default.createElement(f.default,{schedule:a.Schedule,onChangeState:function(e){t.setState({formState:e})},edit:!0,includeManual:!0})))}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e);e=this.props.job;this.state={open:!1,job:e,rand:Math.random()}}a.default=n,t.exports=a.default},{"./ScheduleForm":7,"cells-sdk":"cells-sdk","material-ui":"material-ui","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager",react:"react"}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var c=i(e("react")),d=i(e("pydio")),f=i(e("./ScheduleForm")),p=i(e("./Events")),m=e("material-ui"),l=e("material-ui/styles"),h=i(e("./Loader")),y=d.default.requireLib("boot").moment,g=d.default.requireLib("components").MaterialTable,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,c["default"].Component),n(s,[{key:"extractRowsInfo",value:function(e,r){var i={color:"white",borderRadius:4,textAlign:"center",padding:4,overflow:"hidden",textOverflow:"ellipsis"},l=[],s=[];return void 0===e||e.map(function(e){var t,a=u({},e,{SortEndTime:0,SortStatus:"UNKOWN"});void 0!==e.Tasks?(e.Tasks.sort(function(e,t){return e.StartTime&&t.StartTime&&e.StartTime!==t.StartTime?e.StartTime>t.StartTime?-1:1:e.ID>t.ID?1:-1}),o=e.Tasks[0],a.TaskStartTime=y(new Date(1e3*parseInt(o.StartTime))).fromNow(),o.EndTime?a.TaskEndTime=y(new Date(1e3*parseInt(o.EndTime))).fromNow():a.TaskEndTime="-",a.SortEndTime=o.EndTime||0,a.SortStatus=o.Status,"Finished"===o.Status?a.TaskStatus=o.Status:"Running"===o.Status?(t=e.Tasks.filter(function(e){return"Running"===e.Status}).length,a.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#388e3c"}},t," tasks running")):"Error"===o.Status?a.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#E53935"}},o.StatusMessage):"Queued"===o.Status?a.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#fb8c00"}},o.StatusMessage):a.TaskStatus=c.default.createElement("span",null,o.Status," (",o.StatusMessage,")")):(a.TaskStatus="-",a.TaskEndTime="-",a.TaskStartTime="-");var n,o=void 0;e.Inactive&&(o={opacity:.43}),e.Schedule&&e.EventNames?(n=e.EventNames.map(function(e){return p.default.eventData(e).title}).join(", "),a.Trigger=c.default.createElement("div",{style:u({},i,o,{backgroundColor:"#03A9F4",backgroundImage:"-webkit-linear-gradient(-80deg, #03a9f4 50%, #43a047 50%)"})},c.default.createElement("span",{className:"mdi mdi-timer"})," ",c.default.createElement(f.default,{schedule:e.Schedule}),",",c.default.createElement("span",{title:n},c.default.createElement("span",{className:"mdi mdi-pulse",title:r("trigger.events")})," ",n)),a.SortValue="1-"+e.Label):e.EventNames&&h.default.canManualRun(e)?(n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(e.EventNames.map(function(e){return p.default.eventData(e).title})),[r("trigger.manual")]).join(", "),a.Trigger=c.default.createElement("div",{style:u({},i,o,{backgroundColor:"#03A9F4",backgroundImage:"-webkit-linear-gradient(-80deg, #03a9f4 50%, #607d8b 50%)"})},c.default.createElement("span",{title:n},c.default.createElement("span",{className:"mdi mdi-pulse",title:r("trigger.events")})," ",n)),a.SortValue="1-"+e.Label):e.Schedule?(a.Trigger=c.default.createElement("div",{style:u({},i,o,{backgroundColor:"#03A9F4"})},c.default.createElement("span",{className:"mdi mdi-timer"})," ",c.default.createElement(f.default,{schedule:e.Schedule})),a.SortValue="0-"+e.Label):e.EventNames?(n=e.EventNames.map(function(e){return p.default.eventData(e).title}).join(", "),a.SortValue="2-"+e.Label,a.Trigger=c.default.createElement("div",{style:u({},i,o,{backgroundColor:"#43a047"}),title:n},c.default.createElement("span",{className:"mdi mdi-pulse",title:r("trigger.events")})," ",n)):(a.Trigger=c.default.createElement("div",{style:u({},i,o,{backgroundColor:"#607d8b"})},c.default.createElement("span",{className:"mdi mdi-gesture-tap"})," ",r("trigger.manual")),a.SortValue="3-"+e.Label),e.Inactive&&(a.Label=c.default.createElement("span",{style:{color:"rgba(0,0,0,0.43)"}},"[",r("job.disabled"),"] ",a.Label),a.TaskStartTime=c.default.createElement("span",{style:{opacity:.43}},a.TaskStartTime),a.TaskEndTime=c.default.createElement("span",{style:{opacity:.43}},a.TaskEndTime),a.TaskStatus=c.default.createElement("span",{style:{opacity:.43}},a.TaskStatus),a.SortValue="3-"+e.Label),("pydio.system.user"===e.Owner?l:s).push(a)}),{system:l,other:s}}},{key:"render",value:function(){function e(e){return a.MessageHash["ajxp_admin.scheduler."+e]||e}var t=this.props,a=t.pydio,n=t.selectRows,o=t.muiTheme,r=t.jobs,i=void 0===r?[]:r,l=t.loading,s=AdminComponents.AdminStyles(o.palette),u=[{name:"Trigger",label:e("job.trigger"),style:{width:180,textAlign:"left",paddingRight:0},headerStyle:{width:180,paddingRight:0},hideSmall:!0,sorter:{type:"number",default:!0,value:function(e){return e.SortValue}}},{name:"Label",label:e("job.label"),style:{width:"40%",fontSize:15},headerStyle:{width:"40%"},sorter:{type:"string"}},{name:"TaskEndTime",label:e("job.endTime"),style:{width:"15%"},headerStyle:{width:"15%"},sorter:{type:"number",value:function(e){return e.SortEndTime}},hideSmall:!0},{name:"TaskStatus",label:e("job.status"),sorter:{type:"string",value:function(e){return e.SortStatus}}}],r=[].concat(u);r[0]={name:"Owner",label:e("job.owner"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0},r[1]={name:"Label",label:e("job.label"),style:{width:"45%",fontSize:15},headerStyle:{width:"45%"},sorter:{type:"string"}};t=this.extractRowsInfo(i,e),o=t.system,i=t.other,t=[{iconClassName:"mdi mdi-chevron-right",onClick:function(e){return n([e])}}];return c.default.createElement("div",{style:{flex:1,overflowY:"auto"}},c.default.createElement(AdminComponents.SubHeader,{title:e("system.title"),legend:e("system.legend")}),c.default.createElement(m.Paper,s.body.block.props,c.default.createElement(g,{data:o,columns:u,actions:t,onSelectRows:function(e){n(e)},showCheckboxes:!1,emptyStateString:l?d.default.getInstance().MessageHash[466]:e("system.empty"),masterStyles:s.body.tableMaster,storageKey:"console.scheduler.jobs.list"})),c.default.createElement(AdminComponents.SubHeader,{title:e("users.title"),legend:e("users.legend")}),c.default.createElement(m.Paper,s.body.block.props,c.default.createElement(g,{data:i,columns:r,onSelectRows:function(e){n(e)},showCheckboxes:!1,emptyStateString:e("users.empty"),masterStyles:s.body.tableMaster})))}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),r(Object.getPrototypeOf(s.prototype),"constructor",this).apply(this,arguments)}n=(0,l.muiThemeable)()(n),a.default=n,t.exports=a.default},{"./Events":2,"./Loader":6,"./ScheduleForm":7,"material-ui":"material-ui","material-ui/styles":"material-ui/styles",pydio:"pydio",react:"react"}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var l=i(e("pydio")),s=i(e("pydio/lang/observable")),u=i(e("lodash.debounce")),c=l.default.requireLib("boot").JobsStore,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,s["default"]),n(d,[{key:"start",value:function(){var e=this;this.load(!0),this._loadDebounced=(0,u.default)(function(){e.load(!0)},500),c.getInstance().observe("tasks_updated",this._loadDebounced),this._poll=setInterval(function(){l.default.getInstance().WebSocketClient.getStatus()&&e.load(!0)},5e3)}},{key:"stop",value:function(){this._poll&&(c.getInstance().stopObserving("tasks_updated",this._loadDebounced),clearInterval(this._poll))}},{key:"setFilter",value:function(e,t){this.owner=e,this.filter=t,this.load()}},{key:"load",value:function(){var t=this;!(arguments.length<=0||void 0===arguments[0])&&arguments[0]||this.notify("loading"),this.jobId?c.getInstance().getAdminJobs(this.owner,null,this.jobId).then(function(e){e.Jobs&&0!==e.Jobs.length&&(e=e.Jobs[0],t.notify("loaded",{job:e}))}).catch(function(e){t.notify("loaded",{error:e.message})}):c.getInstance().getAdminJobs(this.owner,null,"",1).then(function(e){e=e.Jobs||[];t.notify("loaded",{jobs:e})}).catch(function(e){t.notify("loaded",{error:e.message})})}}],[{key:"canManualRun",value:function(e){if(e.Schedule||!e.EventNames)return!0;var t=!1;console.log(e);try{e.Actions.forEach(function(e){e.TriggerFilter&&e.TriggerFilter.Query.SubQueries.forEach(function(e){e.value.IsManual&&(t=!0)})})}catch(e){}return t}}]),d);function d(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),r(Object.getPrototypeOf(d.prototype),"constructor",this).call(this),this.jobId=e}a.default=n,t.exports=a.default},{"lodash.debounce":"lodash.debounce",pydio:"pydio","pydio/lang/observable":"pydio/lang/observable"}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw r}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}var d=l(e("react")),s=l(e("pydio")),f=(e("cells-sdk"),e("material-ui")),p=s.default.requireLib("boot").moment,e=s.default.requireLib("hoc"),m=e.ModernSelectField,h=e.ModernTextField,y=e.ModernStyles,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(g,d["default"].Component),o(g,[{key:"onUpdate",value:function(){var e=this.props,t=e.schedule,a=e.onChange,e=e.onChangeState;e?e(this.state):(t.Iso8601Schedule=g.makeIso8601FromState(this.state),a(t))}},{key:"componentDidUpdate",value:function(e,t){t!==this.state&&this.onUpdate()}},{key:"T",value:function(e){return s.default.getMessages()["ajxp_admin.scheduler."+e]||e}},{key:"changeFrequency",value:function(e){var t=this.state,a=t.monthday,n=t.weekday,o=t.daytime,t=t.everyminutes;void 0===a&&(a=1),void 0===n&&(n=1),void 0===o&&((o=p()).year(2012),o.hours(9),o.minutes(0),o=o.toDate()),void 0===t&&(t=15),this.setState({frequency:e,monthday:a,weekday:n,daytime:o,everyminutes:t})}},{key:"render",value:function(){var n=this,e=this.props,t=e.edit,a=e.includeManual;if(!t)return d.default.createElement("span",null,g.readableString(this.state,this.T,!0));for(var o=this.state,r=o.frequency,i=o.monthday,l=o.weekday,e=o.daytime,t=o.everyminutes,s=[],o=p.weekdays(),u=1;u<30;u++)s.push(u);return d.default.createElement("div",null,d.default.createElement("div",{style:{padding:"10px 0",textAlign:"center"}},d.default.createElement("div",{style:{color:"#2196f3",fontSize:15,fontWeight:500}},g.readableString(this.state,this.T,!1)),"manual"!==r&&d.default.createElement("div",{style:{fontSize:11,paddingTop:5,color:"#e0e0e0"}},"ISO8601: ",g.makeIso8601FromState(this.state))),d.default.createElement(m,{floatingLabelText:this.T("schedule.type"),value:r,onChange:function(e,t,a){n.changeFrequency(a)},fullWidth:!0},a&&d.default.createElement(f.MenuItem,{value:"manual",primaryText:this.T("schedule.type.manual")}),d.default.createElement(f.MenuItem,{value:"monthly",primaryText:this.T("schedule.type.monthly")}),d.default.createElement(f.MenuItem,{value:"weekly",primaryText:this.T("schedule.type.weekly")}),d.default.createElement(f.MenuItem,{value:"daily",primaryText:this.T("schedule.type.daily")}),d.default.createElement(f.MenuItem,{value:"timely",primaryText:this.T("schedule.type.timely")})),"monthly"===r&&d.default.createElement("div",null,d.default.createElement(m,{floatingLabelText:this.T("schedule.detail.monthday"),value:i,onChange:function(e,t,a){n.setState({monthday:a})},fullWidth:!0},s.map(function(e){return d.default.createElement(f.MenuItem,{value:e,primaryText:e})}))),"weekly"===r&&d.default.createElement("div",null,d.default.createElement(m,{floatingLabelText:this.T("schedule.detail.weekday"),value:l,onChange:function(e,t,a){n.setState({weekday:a})},fullWidth:!0},o.map(function(e,t){return d.default.createElement(f.MenuItem,{value:t,primaryText:e})}))),("daily"===r||"monthly"===r||"weekly"===r)&&d.default.createElement("div",null,d.default.createElement(f.TimePicker,c({format:"ampm",minutesStep:5,hintText:this.T("schedule.detail.daytime"),value:e,onChange:function(e,t){n.setState({daytime:t})},fullWidth:!0},y.textField))),"timely"===r&&d.default.createElement("div",null,d.default.createElement(h,{floatingLabelText:this.T("schedule.detail.minutes"),value:t,type:"number",onChange:function(e,t){n.setState({everyminutes:parseInt(t)})},fullWidth:!0})))}}],[{key:"parseIso8601",value:function(e){if(""===e||-1===e.indexOf("/"))return{frequency:"manual"};var t=e.split("/"),a=n(t,3),t=(a[0],a[1]),a=a[2],t=new Date(t);if("P1M"===a)return{frequency:"monthly",monthday:t.getDate(),daytime:t};if("P7D"===a)return{frequency:"weekly",weekday:p(t).day(),daytime:t};if("PT24H"===a||"P1D"===a)return{frequency:"daily",daytime:t};a=p.duration(a);return a.isValid()?{frequency:"timely",everyminutes:a.minutes()+60*a.hours()}:{error:"Cannot parse value "+e}}},{key:"makeIso8601FromState",value:function(e){var t=e.frequency,a=e.monthday,n=e.weekday,o=e.daytime,r=e.everyminutes,i=new Date("2012-01-01T00:00:00.828696-07:00"),l=p.duration(0);switch(t){case"manual":return"";case"monthly":o&&i.setTime(o.getTime()),i.setDate(a||1),l=p.duration(1,"months");break;case"weekly":o&&i.setTime(o.getTime());var s=p(i);s.day(void 0===n?1:n),i=s.toDate(),l=p.duration(7,"days");break;case"daily":o&&i.setTime(o.getTime()),l=p.duration(24,"hours");break;case"timely":l=p.duration(r,"minutes")}return"R/"+p(i).toISOString()+"/"+l.toISOString()}},{key:"readableString",value:function(e,t){var a=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],n=e.frequency,o=e.monthday,r=e.weekday,i=e.daytime,l=e.everyminutes,s="0:00";switch(i&&(s=p(i).format("h:mm a")),n){case"manual":return t("trigger.manual");case"monthly":return a?t("schedule.monthly.short").replace("%1",o):t("schedule.monthly").replace("%1",o).replace("%2",s);case"weekly":return a?t("schedule.weekly.short").replace("%1",p.weekdays()[r]):t("schedule.weekly").replace("%1",p.weekdays()[r]).replace("%2",s);case"daily":return t(a?"schedule.daily.short":"schedule.daily").replace("%1",s);case"timely":var u=p.duration(l,"minutes");return t("schedule.timely").replace("%1",(u.hours()?u.hours()+"h":"")+(u.minutes()?u.minutes()+"mn":""));default:return"Error"}}}]),g);function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),i(Object.getPrototypeOf(g.prototype),"constructor",this).call(this,e);e=e.schedule;e?e.Iso8601Schedule?this.state=g.parseIso8601(e.Iso8601Schedule):this.state={frequency:"daily",daytime:new Date}:this.state=g.parseIso8601("")}a.default=o,t.exports=a.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio",react:"react"}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}var s=l(e("react")),u=l(e("pydio")),c=l(e("pydio/http/api")),d=e("material-ui"),f=e("cells-sdk"),p=l(e("lodash.debounce")),m=u.default.requireLib("components").MaterialTable,e=u.default.requireLib("boot"),h=e.JobsStore,y=e.moment,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(g,s["default"].Component),n(g,[{key:"componentDidMount",value:function(){var t=this;this.loadActivity(this.props),this._loadDebounced=(0,p.default)(function(e){e&&t.props.task&&t.props.task.JobID===e&&t.loadActivity(t.props,0,4)},500),h.getInstance().observe("tasks_updated",this._loadDebounced);var e=this.props.poll;e&&(this._interval=window.setInterval(function(){u.default.getInstance().WebSocketClient.getStatus()&&t.loadActivity(t.props,t.state&&t.state.page?t.state.page:0,4)},e))}},{key:"componentWillUnmount",value:function(){this._loadDebounced&&h.getInstance().stopObserving("tasks_updated",this._loadDebounced),this._interval&&window.clearInterval(this._interval)}},{key:"componentWillReceiveProps",value:function(e){this.props.task||this.loadActivity(e),e.task&&this.props.task&&e.task.ID!==this.props.task.ID&&this.loadActivity(e)}},{key:"loadActivity",value:function(t){var e,a,n=this,o=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],i=t.task,l=t.poll;i&&(e=i.JobID+"-"+i.ID.substr(0,8),a=new f.JobsServiceApi(c.default.getRestClient()),(i=new f.LogListLogRequest).Query='+OperationUuid:"'+e+'"',i.Page=o,i.Size=200,i.Format=f.ListLogRequestLogFormat.constructFromObject("JSON"),this.setState({loading:!0}),a.listTasksLogs(i).then(function(e){e=e.Logs||[];n.setState({activity:e,loading:!1,page:o}),!e.length&&r<3&&!l&&setTimeout(function(){return n.loadActivity(t,o,r+1)},2e3)}).catch(function(){n.setState({activity:[],loading:!1,page:o})}))}},{key:"computeTag",value:function(e){var t=this.props,a=t.job,n=t.descriptions,t={backgroundColor:"#1e96f3",fontSize:11,fontWeight:500,color:"white",padding:"0 8px",overflow:"hidden",textOverflow:"ellipsis",borderRadius:4,textAlign:"center"},o=e.SchedulerTaskActionPath;if(!o)return null;if("ROOT"===o)return s.default.createElement("div",{style:i({},t,{backgroundColor:"white",color:"rgba(0,0,0,.87)",border:"1px solid #e0e0e0"})},"Trigger");var r=void 0;try{r=this.findAction(o,a.Actions)}catch(e){}return r?r.Label?o=r.Label:n&&n[r.ID]&&(o=n[r.ID].Label):(e=o.split("/").pop().split("$").shift(),n&&n[e]&&(o=n[e].Label)),s.default.createElement("div",{style:t},o)}},{key:"findAction",value:function(e,t){var a=e.split("/"),n=(a.shift(),[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(a)).shift()),e=t[parseInt(n.split("$")[1])],t=void 0,t=-1===n.indexOf("$FAIL")?e.ChainedActions:e.FailedFilterActions;return 1<a.length?this.findAction(a.join("/"),t):e}},{key:"render",value:function(){var t=this,e=this.props,a=e.pydio,n=e.onRequestClose,o=this.state,r=o.activity,i=o.loading,l=o.page,e="#f5f5f5",o=[{name:"SchedulerTaskActionPath",label:"",hideSmall:!0,style:{width:110,height:32,backgroundColor:e,paddingLeft:12,paddingRight:0,userSelect:"text"},headerStyle:{width:110,paddingLeft:12,paddingRight:0},renderCell:function(e){return t.computeTag(e)}},{name:"Ts",label:a.MessageHash["settings.17"],style:{width:100,height:32,backgroundColor:e,paddingRight:10,userSelect:"text"},headerStyle:{width:100,paddingRight:10},renderCell:function(e){return y(1e3*e.Ts).format("HH:mm:ss")}},{name:"Msg",label:a.MessageHash["ajxp_admin.logs.message"],style:{height:32,backgroundColor:e,userSelect:"text"}}];return s.default.createElement("div",{style:{paddingTop:12,paddingBottom:10,backgroundColor:e}},s.default.createElement("div",{style:{padding:"0 24px 10px",fontWeight:500,backgroundColor:e,display:"flex",alignItems:"center"}},s.default.createElement("div",null,a.MessageHash["ajxp_admin.scheduler.tasks.activity.title"]),s.default.createElement("div",{style:{flex:1,textAlign:"center",fontSize:20,display:"flex",alignItems:"center",justifyContent:"center"}},0<l&&s.default.createElement(d.FontIcon,{className:"mdi mdi-chevron-left",color:"rgba(0,0,0,.7)",style:{cursor:"pointer"},onClick:function(){t.loadActivity(t.props,l-1)}}),(0<l||200<=r.length)&&s.default.createElement("span",{style:{fontSize:12}},a.MessageHash[331]," ",i?s.default.createElement(d.CircularProgress,{size:16,thickness:1.5}):s.default.createElement("span",null,l+1)),200<=r.length&&s.default.createElement(d.FontIcon,{className:"mdi mdi-chevron-right",color:"rgba(0,0,0,.7)",style:{cursor:"pointer"},onClick:function(){t.loadActivity(t.props,l+1)}})),s.default.createElement("div",{style:{paddingRight:15,cursor:"pointer"},onClick:n},s.default.createElement(d.FontIcon,{className:"mdi mdi-close",color:"rgba(0,0,0,.3)",style:{fontSize:16}}))),s.default.createElement(m,{hideHeaders:!0,columns:o,data:r,showCheckboxes:!1,emptyStateString:i?s.default.createElement("div",{style:{display:"flex",alignItems:"center"}}," ",s.default.createElement(d.CircularProgress,{size:16,thickness:1.5})," ",s.default.createElement("span",{style:{flex:1,marginLeft:5}},a.MessageHash["ajxp_admin.scheduler.tasks.activity.loading"])):a.MessageHash["ajxp_admin.scheduler.tasks.activity.empty"],emptyStateStyle:{backgroundColor:e},computeRowStyle:function(e){return{borderBottomColor:"#fff",height:32}}}))}}]),g);function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),r(Object.getPrototypeOf(g.prototype),"constructor",this).call(this,e),this.state={activity:[],loading:!1,page:0}}a.default=n,t.exports=a.default},{"cells-sdk":"cells-sdk","lodash.debounce":"lodash.debounce","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api",react:"react"}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(e,t,a){for(var n=!0;n;){var o=e,r=t,i=a,n=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,a=i,n=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var d=i(e("react")),s=i(e("pydio")),f=e("material-ui"),u=i(e("./TaskActivity")),e=s.default.requireLib("boot"),c=e.JobsStore,p=e.SingleJobProgress,m=e.moment,h=s.default.requireLib("components").MaterialTable,n=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,d["default"].Component),n(y,[{key:"renderActions",value:function(e){function t(e){return a.MessageHash["ajxp_admin.scheduler.task.action."+e]||e}var a=this.props.pydio,n=c.getInstance(),o=[],r={iconStyle:{color:"rgba(0,0,0,.3)"}};return"Running"===e.Status&&e.CanPause&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-pause",tooltip:t("pause"),onClick:function(){n.controlTask(e,"Pause")}},r))),"Paused"===e.Status&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-play",tooltip:t("resume"),onClick:function(){n.controlTask(e,"Resume")}},r))),"Running"===e.Status||"Paused"===e.Status?e.CanStop?o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-stop",tooltip:t("stop"),onClick:function(){n.controlTask(e,"Stop")}},r))):"Pending"===e.StatusMessage&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-delete",tooltip:t("delete"),onClick:function(){n.controlTask(e,"Delete")}},r))):o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-delete",tooltip:t("delete"),onClick:function(){n.controlTask(e,"Delete")}},r))),o}},{key:"onSelectTaskRows",value:function(e){"selection"===this.state.mode?this.setState({selectedRows:e}):1===e.length&&this.setState({taskLogs:e[0]})}},{key:"setLoading",value:function(e){var t=this.props.onLoading;this.setState({working:e}),t&&t(e)}},{key:"deleteSelection",value:function(){var e=this,t=this.state.selectedRows,a=this.props.job,n=c.getInstance();this.setLoading(!0),n.deleteTasks(a.ID,t).then(function(){e.setState({selectedRows:[],mode:"log"}),e.setLoading(!1)}).catch(function(){e.setLoading(!1)})}},{key:"deleteAll",value:function(){var e=this,t=this.props,a=t.pydio,n=t.job;a.UI.openConfirmDialog({message:a.MessageHash["ajxp_admin.scheduler.tasks.delete.confirm"],validCallback:function(){e.setLoading(!0),c.getInstance().deleteAllTasksForJob(n.ID).then(function(){e.setLoading(!1)}).catch(function(){e.setLoading(!1)})}})}},{key:"insertTaskLogRow",value:function(e){var a=this,t=this.props,n=t.pydio,o=t.job,t=t.descriptions,r=void 0===t?[]:t,t=this.state,i=t.taskLogs;return"selection"===t.mode?e:e.map(function(e){if(i&&e.ID===i.ID){var t=d.default.createElement(u.default,{pydio:n,task:i,job:o,descriptions:r,onRequestClose:function(){a.setState({taskLogs:null})},poll:"Running"===e.Status?1050:void 0});return l({},e,{expandedRow:t})}return e})}},{key:"render",value:function(){var t=this,e=this.props,a=e.pydio,n=e.adminStyles,o=e.job,r=this.state,i=r.selectedRows,l=r.working,s=r.mode;if(!o)return null;var e=function(e){return a.MessageHash["ajxp_admin.scheduler."+e]||e},r=d.default.createElement("div",{style:{lineHeight:"initial",marginLeft:5}},d.default.createElement(f.IconButton,{iconClassName:"mdi mdi-delete-sweep",iconStyle:{color:"rgba(0,0,0,.3)"},tooltip:e("tasks.bulk.clear"),primary:!0,onClick:this.deleteAll.bind(this),disabled:l})),r=[{name:"ID",label:d.default.createElement("div",{style:{display:"flex",alignItems:"center",marginLeft:-20}},d.default.createElement("div",{style:{lineHeight:"initial",marginLeft:5}},d.default.createElement(f.IconButton,{iconClassName:"mdi mdi-checkbox-multiple-"+("selection"===s?"marked":"blank")+"-outline",iconStyle:{color:"rgba(0,0,0,.3)"},tooltip:e("selection"===s?"tasks.bulk.disable":"tasks.bulk.enable"),primary:!0,onClick:function(){t.setState({mode:"selection"===s?"log":"selection",taskLogs:null})},disabled:l})),d.default.createElement("span",null,e("task.id"))),hideSmall:!0,style:{width:110,fontSize:15,paddingLeft:20},headerStyle:{width:110,paddingLeft:20},renderCell:function(e){return e.ID.substr(0,8)}},{name:"StartTime",style:{width:100,paddingRight:10},headerStyle:{width:100,paddingRight:10},label:e("task.start"),renderCell:function(e){e=m(1e3*e.StartTime);return e.isSame(Date.now(),"day")?e.format("HH:mm:ss"):e.fromNow()}},{name:"StatusMessage",label:e("task.message"),hideSmall:!0,renderCell:function(e){return"Error"===e.Status?d.default.createElement("span",{style:{fontWeight:500,color:"#E53935"}},e.StatusMessage):"Running"===e.Status?d.default.createElement(p,{pydio:a,jobID:e.JobID,taskID:e.ID}):e.StatusMessage}},{name:"EndTime",style:{width:100},headerStyle:{width:100},label:e("task.duration"),hideSmall:!0,renderCell:function(e){var t=m(Date.now()),a=(t=e.EndTime?m(1e3*e.EndTime):t).diff(m(1e3*e.StartTime)),t=m.utc(a),e=t.format("H"),a=t.format("m"),t=t.format("s");return"0"===e&&"0"===a&&"0"===t?"< 1s":("0"===e?"":e+"h:")+("0"===e&&"0"===a?"":a+"mn:")+t+"s"}},{name:"Actions",label:r,style:{textAlign:"right",width:120,paddingLeft:0},headerStyle:{width:120,paddingLeft:0,paddingRight:20,textAlign:"right"},renderCell:this.renderActions.bind(this)}],o=o.Tasks||[],u=["Running","Paused"];o.sort(function(e,t){return e.StartTime&&t.StartTime&&e.StartTime!==t.StartTime?e.StartTime>t.StartTime?-1:1:e.ID>t.ID?1:-1});var c=o.filter(function(e){return-1!==u.indexOf(e.Status)}),c=this.insertTaskLogRow(c),o=o.filter(function(e){return-1===u.indexOf(e.Status)}),o=this.insertTaskLogRow(o);return d.default.createElement("div",null,0<c.length&&d.default.createElement(AdminComponents.SubHeader,{title:e("tasks.running")}),0<c.length&&d.default.createElement(f.Paper,n.body.block.props,d.default.createElement(h,{data:c,columns:r,hideHeaders:!0,showCheckboxes:!1,emptyStateString:e("tasks.running.empty"),onSelectRows:function(e){1===e.length&&c.length&&t.setState({taskLogs:e[0]})},masterStyles:n.body.tableMaster})),d.default.createElement(AdminComponents.SubHeader,{title:d.default.createElement("div",{style:{display:"flex",width:"100%",alignItems:"baseline"}},d.default.createElement("div",{style:{flex:1}},e("tasks.history")),"selection"===s&&1<i.length&&d.default.createElement("div",{style:{lineHeight:"initial"}},d.default.createElement(f.RaisedButton,{label:e("tasks.bulk.delete"),secondary:!0,onClick:this.deleteSelection.bind(this),disabled:l})))}),d.default.createElement(f.Paper,n.body.block.props,d.default.createElement(h,{data:o,columns:r,showCheckboxes:"selection"===s,onSelectRows:this.onSelectTaskRows.bind(this),emptyStateString:e("tasks.history.empty"),selectedRows:i,deselectOnClickAway:!0,masterStyles:n.body.tableMaster,paginate:[10,25,50,100],defaultPageSize:10})))}}]),y);function y(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),r(Object.getPrototypeOf(y.prototype),"constructor",this).call(this,e),this.state={mode:"log",selectedRows:[],working:!1,taskLogs:null}}a.default=n,t.exports=a.default},{"./TaskActivity":8,"material-ui":"material-ui",pydio:"pydio",react:"react"}],10:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=n(e("./board/Dashboard")),r=n(e("./board/JobsList")),i=n(e("./board/TasksList")),l=n(e("./board/ScheduleForm")),s=n(e("./board/Events")),e=n(e("./board/Loader"));window.AdminScheduler={Dashboard:o.default,JobsList:r.default,TasksList:i.default,ScheduleForm:l.default,Events:s.default,Loader:e.default}},{"./board/Dashboard":1,"./board/Events":2,"./board/JobsList":5,"./board/Loader":6,"./board/ScheduleForm":7,"./board/TasksList":9}]},{},[10]);