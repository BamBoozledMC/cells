!function a(o,r,i){function l(n,e){if(!r[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[n]={exports:{}};o[n][0].call(t.exports,function(e){var t=o[n][1][e];return l(t||e)},t,t.exports,a,o,r,i)}return r[n].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)l(i[e]);return l}({1:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});a(e("pydio"));var u=a(e("react")),o=a(e("create-react-class")),r=e("material-ui/styles"),c=a(e("./JobBoard")),d=a(e("./JobsList")),i=a(e("./Loader")),o=(0,o.default)({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],getInitialState:function(){return{jobs:[],Owner:null,Filter:null}},reload:function(){this.loader.load()},componentDidMount:function(){var t=this;this.loader=new i.default,this.loader.observe("loading",function(){t.setState({loading:!0})}),this.loader.observe("loaded",function(e){t.setState({loading:!1}),e.jobs?t.setState({jobs:e.jobs}):e.error&&t.setState({error:e.error})}),this.loader.start()},componentWillUnmount:function(){this.loader.stop()},selectRows:function(e){e.length&&(e=e[0].ID,this.loader.stop(),this.setState({selectJob:e}))},render:function(){var e,t=this,n=this.props,a=n.pydio,o=n.jobsEditable,r=n.muiTheme,i=AdminComponents.AdminStyles(r.palette),l=this.state,n=l.jobs,r=l.loading,s=l.selectJob;if(s&&n){l=n.filter(function(e){return e.ID===s});if(console.log(s,l),l.length)return u.default.createElement(c.default,{pydio:a,job:l[0],jobsEditable:o,onSave:function(){t.reload()},adminStyles:i,onRequestClose:function(){t.loader.start(),t.setState({selectJob:null})}})}return u.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"}},u.default.createElement(AdminComponents.Header,{title:(e="title",a.MessageHash["ajxp_admin.scheduler."+e]||e),icon:"mdi mdi-timetable",reloadAction:this.reload.bind(this),loading:r}),u.default.createElement(d.default,{pydio:a,selectRows:function(e){t.selectRows(e)},jobs:n,loading:r}))}});n.default=o=(0,r.muiThemeable)()(o),n.default=o,t.exports=n.default},{"./JobBoard":3,"./JobsList":5,"./Loader":6,"create-react-class":"create-react-class","material-ui/styles":"material-ui/styles",pydio:"pydio",react:"react"}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var u=l(e("react")),c=l(e("pydio")),d=e("material-ui"),e=(e("cells-sdk"),c.default.requireLib("components").Stepper),f=e.Dialog,p=e.PanelBigButtons,m={NODE_CHANGE:{title:"Files and folders (nodes) events : detect files modifications to move them or update their metadata automatically.",0:{title:"trigger.create.node",icon:"file-plus",description:"A new file was uploaded or a new folder was created"},1:{title:"trigger.read.node",icon:"eye",description:"A file was downloaded or a folder content was listed"},2:{title:"trigger.update.path",icon:"folder-move",description:"A file or folder was moved or renamed"},3:{title:"trigger.update.content",icon:"content-save",description:"A file content was updated by edition or upload overwriting"},5:{title:"trigger.delete.node",icon:"delete",description:"A file or a folder was definitively deleted"},4:{title:"trigger.update.metadata",icon:"tag",description:"Internal metadata were modified on file or folder"},6:{title:"trigger.update.user-metadata",icon:"tag-multiple",description:"User-defined metadata were modified (event contains updated metadata)"}},IDM_CHANGE:{USER:{title:"User events : triggered when adding/removing user and when users log in and log out. Can be used for triggering validation flows or assigning accesses.",0:{title:"trigger.create.user",icon:"account-plus",tint:"#009688",description:"A user or a group was created"},1:{title:"trigger.read.user",icon:"account",tint:"#009688",description:"A user or a group was accessed"},2:{title:"trigger.update.user",icon:"account-box",tint:"#009688",description:"A user or a group data was updated"},3:{title:"trigger.delete.user",icon:"account-minus",tint:"#009688",description:"A user or a group was deleted"},4:{title:"trigger.bind.user",icon:"login",tint:"#009688",description:"A user has logged in"},5:{title:"trigger.logout.user",icon:"logout",tint:"#009688",description:"A user has logged out"}},ROLE:{title:"Role events : can be used to automate accesses based on role names. Use IsTeam, IsGroup, IsUser flags to filter roles.",0:{title:"Create Role",icon:"account-card-details",tint:"#607d8b",description:"New role created."},2:{title:"Update Role",icon:"pencil",tint:"#607d8b",description:"A role has been updated"},3:{title:"Delete Role",icon:"delete-forever",tint:"#607d8b",description:"A role has been deleted"}},WORKSPACE:{title:"Workspace events : triggered on workspace creation / deletion. Use the Scope flag to filter Workspaces from Cells",0:{title:"Create Workspace",icon:"folder-plus",tint:"#ff9800",description:"A workspace has been created"},2:{title:"Update Workspace",icon:"pencil",tint:"#ff9800",description:"A workspace has been updated"},3:{title:"Delete Workspace",icon:"delete-forever",tint:"#ff9800",description:"New file uploaded or folder created"}},ACL:{title:"ACL events : access control lists link workspaces, nodes and roles together to provide accesses to data.",0:{title:"Create Acl",icon:"view-list",tint:"#795548",description:"An access control has been opened"},3:{title:"Delete Acl",icon:"delete-forever",tint:"#795548",description:"An access control has been closed"}}}},a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,u["default"].Component),a(h,[{key:"onChange",value:function(){this.props.onChange(Object.keys(this.state.objEvents))}},{key:"toObject",value:function(){var t={};return(arguments.length<=0||void 0===arguments[0]?[]:arguments[0]).forEach(function(e){t[e]=e}),t}},{key:"remove",value:function(e){var t=this.state.objEvents;delete t[e],this.setState({objEvents:t},this.onChange.bind(this))}},{key:"add",value:function(e){var t=this.state.objEvents;t[e]=e,this.setState({objEvents:t},this.onChange.bind(this))}},{key:"dismiss",value:function(){this.setState({open:!1,filter:""})}},{key:"render",value:function(){var t=this,e=this.state,n=e.objEvents,a=e.open,e=e.filter,o=[];Object.keys(n).forEach(function(e){o.push(u.default.createElement(d.ListItem,{key:e,disabled:!0,primaryText:h.eventData(e).title,rightIconButton:u.default.createElement(d.IconButton,{iconClassName:"mdi mdi-delete",iconStyle:{color:"#e0e0e0"},onClick:function(){t.remove(e)}})})),o.push(u.default.createElement(d.Divider,null))}),o.pop();e=h.eventsAsBBModel(e);return u.default.createElement("div",null,u.default.createElement(f,{title:"Trigger job on...",open:a,dialogProps:{},onDismiss:function(){t.dismiss()},onFilter:function(e){t.setState({filter:e.toLowerCase()})}},u.default.createElement(p,{model:e,onPick:function(e){t.add(e),t.dismiss()}})),u.default.createElement(d.FlatButton,{style:{width:"100%"},label:"Trigger job on...",primary:!0,onClick:function(){return t.setState({open:!0})},icon:u.default.createElement(d.FontIcon,{className:"mdi mdi-pulse"})}),u.default.createElement(d.List,null,o))}}],[{key:"eventData",value:function(e){var t=e.split(":"),n=void 0,n=2===t.length&&m[t[0]]?m[t[0]][t[1]]:3===t.length&&m[t[0]]&&m[t[0]][t[1]]&&m[t[0]][t[1]][t[2]]?m[t[0]][t[1]][t[2]]:{title:e,icon:"pulse",description:""};return{title:h.T(n.title),description:h.T(n.description),icon:"mdi mdi-"+n.icon,tint:n.tint}}},{key:"T",value:function(e){return c.default.getMessages()["ajxp_admin.scheduler."+e]||e}},{key:"flatStruct",value:function(n){var a=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=[];return Object.keys(n).forEach(function(e){var t;"title"!==e&&(isNaN(e)&&"IDM_CHANGE"!==e&&o.push({header:n[e].title}),t=n[e],isNaN(e)?o.push.apply(o,s(h.flatStruct(t,[].concat(s(a),[e])))):o.push([].concat(s(a),[e]).join(":")))}),o}},{key:"eventsAsBBModel",value:function(n){var e=h.flatStruct(m),a={Sections:[]},o=void 0;return e.forEach(function(e){var t;e.header?(o&&o.Actions.length&&a.Sections.push(o),o={title:e.header,Actions:[]}):(t=h.eventData(e),n&&-1===t.title.toLowerCase().indexOf(n)&&-1===t.description.toLowerCase().indexOf(n)||o.Actions.push(r({},t,{value:e})))}),o&&a.Sections.push(o),a}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),i(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,e),this.state={objEvents:this.toObject(e.events||[])}}n.default=a,t.exports=n.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio",react:"react"}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var m=i(e("react")),l=i(e("pydio")),s=i(e("pydio/http/api")),u=e("cells-sdk"),h=(i(e("pydio/http/resources-manager")),e("material-ui")),y=i(e("./TasksList")),b=i(e("./JobSchedule")),c=i(e("./Loader")),g=l.default.requireLib("boot").JobsStore,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,m["default"].Component),a(d,[{key:"componentDidMount",value:function(){var t=this;this.loader.start(),new u.ConfigServiceApi(s.default.getRestClient()).schedulerActionsDiscovery().then(function(e){t.setState({descriptions:e.Actions})})}},{key:"componentWillUnmount",value:function(){this.loader.stop()}},{key:"render",value:function(){var t=this,e=this.props,n=e.pydio,a=e.jobsEditable,o=e.onRequestClose,r=e.adminStyles,i=this.state,l=i.loading,s=i.create,u=i.job,c=i.descriptions;if(!u)return null;function d(e){return n.MessageHash["ajxp_admin.scheduler."+e]||e}var f=[],e=p({},r.props.header.flatButton),i=r.props.header.flatButton.labelStyle.color;return s||(u.EventNames&&!u.Schedule||(a&&f.push(m.default.createElement(b.default,{job:u,edit:!0,onUpdate:function(){}})),a=p({},e),u.Inactive&&(a.backgroundColor="#e0e0e0"),f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-play",color:i}),label:d("task.action.run"),disabled:u.Inactive,primary:!0,onClick:function(){g.getInstance().controlJob(u,"RunOnce")}},a)))),u.Inactive?f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-checkbox-marked-circle-outline",color:i}),label:d("task.action.enable"),primary:!0,onClick:function(){g.getInstance().controlJob(u,"Active")}},e))):f.push(m.default.createElement(h.FlatButton,p({icon:m.default.createElement(h.FontIcon,{className:"mdi mdi-checkbox-blank-circle-outline",color:i}),label:d("task.action.disable"),primary:!0,onClick:function(){g.getInstance().controlJob(u,"Inactive")}},e)))),m.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"}},m.default.createElement(AdminComponents.Header,{title:m.default.createElement("span",null,m.default.createElement("a",{style:{cursor:"pointer",borderBottom:"1px solid rgba(0,0,0,.87)"},onClick:function(){return o(!0)}},n.MessageHash["ajxp_admin.scheduler.title"])," / ",u.Label," ",u.Inactive?" [disabled]":""),backButtonAction:function(){return o(!0)},actions:f,loading:l}),m.default.createElement("div",{style:{flex:1,overflowY:"auto"}},m.default.createElement(y.default,{pydio:n,job:u,onLoading:function(e){t.setState({loading:e})},descriptions:c,adminStyles:r})))}}]),d);function d(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),r(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,e),this.state={mode:"log",selectedRows:[],loading:!1,taskLogs:null,job:e.job,create:e.create,descriptions:{}},this.loader=new c.default(e.job.ID),this.loader.observe("loaded",function(e){e.job?t.setState({job:e.job,error:null}):e.error&&t.setState({error:e.error})})}n.default=a,t.exports=n.default},{"./JobSchedule":4,"./Loader":6,"./TasksList":9,"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager",react:"react"}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var l=i(e("react")),s=i(e("pydio/http/resources-manager")),u=i(e("pydio/http/api")),c=e("cells-sdk"),d=e("material-ui"),f=i(e("./ScheduleForm")),a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l["default"].Component),a(p,[{key:"updateJob",value:function(){var a=this,o=this.props.onUpdate,e=this.state,r=e.job,e=e.formState;e?("manual"===e.frequency?(void 0!==r.Schedule&&delete r.Schedule,r.AutoStart=!0):(r.Schedule={Iso8601Schedule:f.default.makeIso8601FromState(e)},void 0!==r.AutoStart&&delete r.AutoStart),s.default.loadClass("EnterpriseSDK").then(function(e){var t=e.SchedulerServiceApi,e=e.JobsPutJobRequest,t=new t(u.default.getRestClient()),n=new e;n.Job=c.JobsJob.constructFromObject(JSON.parse(JSON.stringify(r))),void 0!==n.Job.Tasks&&delete n.Job.Tasks,t.putJob(n).then(function(){o(),a.setState({open:!1,job:n.Job,rand:Math.random()})}).catch(function(e){})})):this.setState({open:!1})}},{key:"render",value:function(){var t=this,e=this.state,n=e.job,e=e.rand;return l.default.createElement("div",null,l.default.createElement(d.FlatButton,{primary:!0,icon:l.default.createElement(d.FontIcon,{className:"mdi mdi-timer"}),key:e,label:l.default.createElement(f.default,{schedule:n.Schedule,rand:e}),onClick:function(){t.setState({open:!0})}}),l.default.createElement(d.Dialog,{title:"Job Schedule",actions:[l.default.createElement(d.FlatButton,{label:"Close",onClick:function(){t.setState({open:!1})}}),l.default.createElement(d.FlatButton,{label:"Save",onClick:function(){t.updateJob()}})],modal:!1,open:this.state.open,contentStyle:{width:320}},l.default.createElement(f.default,{schedule:n.Schedule,onChangeState:function(e){t.setState({formState:e})},edit:!0,includeManual:!0})))}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e);e=this.props.job;this.state={open:!1,job:e,rand:Math.random()}}n.default=a,t.exports=n.default},{"./ScheduleForm":7,"cells-sdk":"cells-sdk","material-ui":"material-ui","pydio/http/api":"pydio/http/api","pydio/http/resources-manager":"pydio/http/resources-manager",react:"react"}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var c=i(e("react")),d=i(e("pydio")),u=i(e("./ScheduleForm")),f=i(e("./Events")),p=e("material-ui"),e=e("material-ui/styles"),m=d.default.requireLib("boot").moment,h=d.default.requireLib("components").MaterialTable,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,c["default"].Component),a(l,[{key:"extractRowsInfo",value:function(e,o){var r={color:"white",borderRadius:4,textAlign:"center",padding:4,overflow:"hidden",textOverflow:"ellipsis"},i=[],l=[];return void 0===e||e.map(function(e){var t,n=s({},e,{SortEndTime:0,SortStatus:"UNKOWN"});void 0!==e.Tasks?(e.Tasks.sort(function(e,t){return e.StartTime&&t.StartTime&&e.StartTime!==t.StartTime?e.StartTime>t.StartTime?-1:1:e.ID>t.ID?1:-1}),a=e.Tasks[0],n.TaskStartTime=m(new Date(1e3*parseInt(a.StartTime))).fromNow(),a.EndTime?n.TaskEndTime=m(new Date(1e3*parseInt(a.EndTime))).fromNow():n.TaskEndTime="-",n.SortEndTime=a.EndTime||0,n.SortStatus=a.Status,"Finished"===a.Status?n.TaskStatus=a.Status:"Running"===a.Status?(t=e.Tasks.filter(function(e){return"Running"===e.Status}).length,n.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#388e3c"}},t," tasks running")):"Error"===a.Status?n.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#E53935"}},a.StatusMessage):"Queued"===a.Status?n.TaskStatus=c.default.createElement("span",{style:{fontWeight:500,color:"#fb8c00"}},a.StatusMessage):n.TaskStatus=c.default.createElement("span",null,a.Status," (",a.StatusMessage,")")):(n.TaskStatus="-",n.TaskEndTime="-",n.TaskStartTime="-");var a=void 0;e.Inactive&&(a={opacity:.43}),e.Schedule?(n.Trigger=c.default.createElement("div",{style:s({},r,a,{backgroundColor:"#03A9F4"})},c.default.createElement("span",{className:"mdi mdi-timer"}),c.default.createElement(u.default,{schedule:e.Schedule})),n.SortValue="0-"+e.Label):e.EventNames?(n.SortValue="1-"+e.Label,n.Trigger=c.default.createElement("div",{style:s({},r,a,{backgroundColor:"#43a047"})},c.default.createElement("span",{className:"mdi mdi-pulse",title:o("trigger.events")})," ",e.EventNames.map(function(e){return f.default.eventData(e).title}).join(", "))):(n.Trigger=c.default.createElement("div",{style:s({},r,a,{backgroundColor:"#607d8b"})},c.default.createElement("span",{className:"mdi mdi-gesture-tap"})," ",o("trigger.manual")),n.SortValue="2-"+e.Label),e.Inactive&&(n.Label=c.default.createElement("span",{style:{color:"rgba(0,0,0,0.43)"}},"[",o("job.disabled"),"] ",n.Label),n.TaskStartTime=c.default.createElement("span",{style:{opacity:.43}},n.TaskStartTime),n.TaskEndTime=c.default.createElement("span",{style:{opacity:.43}},n.TaskEndTime),n.TaskStatus=c.default.createElement("span",{style:{opacity:.43}},n.TaskStatus),n.SortValue="3-"+e.Label),("pydio.system.user"===e.Owner?i:l).push(n)}),{system:i,other:l}}},{key:"render",value:function(){function e(e){return n.MessageHash["ajxp_admin.scheduler."+e]||e}var t=this.props,n=t.pydio,a=t.selectRows,o=t.muiTheme,r=t.jobs,i=void 0===r?[]:r,l=t.loading,s=AdminComponents.AdminStyles(o.palette),u=[{name:"Trigger",label:e("job.trigger"),style:{width:180,textAlign:"left",paddingRight:0},headerStyle:{width:180,paddingRight:0},hideSmall:!0,sorter:{type:"number",default:!0,value:function(e){return e.SortValue}}},{name:"Label",label:e("job.label"),style:{width:"40%",fontSize:15},headerStyle:{width:"40%"},sorter:{type:"string"}},{name:"TaskEndTime",label:e("job.endTime"),style:{width:"15%"},headerStyle:{width:"15%"},sorter:{type:"number",value:function(e){return e.SortEndTime}},hideSmall:!0},{name:"TaskStatus",label:e("job.status"),sorter:{type:"string",value:function(e){return e.SortStatus}}}],r=[].concat(u);r[0]={name:"Owner",label:e("job.owner"),style:{width:"10%"},headerStyle:{width:"10%"},hideSmall:!0},r[1]={name:"Label",label:e("job.label"),style:{width:"45%",fontSize:15},headerStyle:{width:"45%"},sorter:{type:"string"}};t=this.extractRowsInfo(i,e),o=t.system,i=t.other,t=[{iconClassName:"mdi mdi-chevron-right",onClick:function(e){return a([e])}}];return c.default.createElement("div",{style:{flex:1,overflowY:"auto"}},c.default.createElement(AdminComponents.SubHeader,{title:e("system.title"),legend:e("system.legend")}),c.default.createElement(p.Paper,s.body.block.props,c.default.createElement(h,{data:o,columns:u,actions:t,onSelectRows:function(e){a(e)},showCheckboxes:!1,emptyStateString:l?d.default.getInstance().MessageHash[466]:e("system.empty"),masterStyles:s.body.tableMaster,storageKey:"console.scheduler.jobs.list"})),c.default.createElement(AdminComponents.SubHeader,{title:e("users.title"),legend:e("users.legend")}),c.default.createElement(p.Paper,s.body.block.props,c.default.createElement(h,{data:i,columns:r,onSelectRows:function(e){a(e)},showCheckboxes:!1,emptyStateString:e("users.empty"),masterStyles:s.body.tableMaster})))}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),r(Object.getPrototypeOf(l.prototype),"constructor",this).apply(this,arguments)}a=(0,e.muiThemeable)()(a),n.default=a,t.exports=n.default},{"./Events":2,"./ScheduleForm":7,"material-ui":"material-ui","material-ui/styles":"material-ui/styles",pydio:"pydio",react:"react"}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var l=i(e("pydio")),s=i(e("pydio/lang/observable")),u=i(e("lodash.debounce")),c=l.default.requireLib("boot").JobsStore,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,s["default"]),a(d,[{key:"start",value:function(){var e=this;this.load(!0),this._loadDebounced=(0,u.default)(function(){e.load(!0)},500),c.getInstance().observe("tasks_updated",this._loadDebounced),this._poll=setInterval(function(){l.default.getInstance().WebSocketClient.getStatus()&&e.load(!0)},5e3)}},{key:"stop",value:function(){this._poll&&(c.getInstance().stopObserving("tasks_updated",this._loadDebounced),clearInterval(this._poll))}},{key:"setFilter",value:function(e,t){this.owner=e,this.filter=t,this.load()}},{key:"load",value:function(){var t=this;!(arguments.length<=0||void 0===arguments[0])&&arguments[0]||this.notify("loading"),this.jobId?c.getInstance().getAdminJobs(this.owner,null,this.jobId).then(function(e){e.Jobs&&0!==e.Jobs.length&&(e=e.Jobs[0],t.notify("loaded",{job:e}))}).catch(function(e){t.notify("loaded",{error:e.message})}):c.getInstance().getAdminJobs(this.owner,null,"",1).then(function(e){e=e.Jobs||[];t.notify("loaded",{jobs:e})}).catch(function(e){t.notify("loaded",{error:e.message})})}}]),d);function d(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),r(Object.getPrototypeOf(d.prototype),"constructor",this).call(this),this.jobId=e}n.default=a,t.exports=n.default},{"lodash.debounce":"lodash.debounce",pydio:"pydio","pydio/lang/observable":"pydio/lang/observable"}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}var d=l(e("react")),s=l(e("pydio")),f=(e("cells-sdk"),e("material-ui")),p=s.default.requireLib("boot").moment,e=s.default.requireLib("hoc"),m=e.ModernSelectField,h=e.ModernTextField,y=e.ModernStyles,o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(b,d["default"].Component),o(b,[{key:"onUpdate",value:function(){var e=this.props,t=e.schedule,n=e.onChange,e=e.onChangeState;e?e(this.state):(t.Iso8601Schedule=b.makeIso8601FromState(this.state),n(t))}},{key:"componentDidUpdate",value:function(e,t){t!==this.state&&this.onUpdate()}},{key:"T",value:function(e){return s.default.getMessages()["ajxp_admin.scheduler."+e]||e}},{key:"changeFrequency",value:function(e){var t=this.state,n=t.monthday,a=t.weekday,o=t.daytime,t=t.everyminutes;void 0===n&&(n=1),void 0===a&&(a=1),void 0===o&&((o=p()).year(2012),o.hours(9),o.minutes(0),o=o.toDate()),void 0===t&&(t=15),this.setState({frequency:e,monthday:n,weekday:a,daytime:o,everyminutes:t})}},{key:"render",value:function(){var a=this,e=this.props,t=e.edit,n=e.includeManual;if(!t)return d.default.createElement("span",null,b.readableString(this.state,this.T,!0));for(var o=this.state,r=o.frequency,i=o.monthday,l=o.weekday,e=o.daytime,t=o.everyminutes,s=[],o=p.weekdays(),u=1;u<30;u++)s.push(u);return d.default.createElement("div",null,d.default.createElement("div",{style:{padding:"10px 0",textAlign:"center"}},d.default.createElement("div",{style:{color:"#2196f3",fontSize:15,fontWeight:500}},b.readableString(this.state,this.T,!1)),"manual"!==r&&d.default.createElement("div",{style:{fontSize:11,paddingTop:5,color:"#e0e0e0"}},"ISO8601: ",b.makeIso8601FromState(this.state))),d.default.createElement(m,{floatingLabelText:this.T("schedule.type"),value:r,onChange:function(e,t,n){a.changeFrequency(n)},fullWidth:!0},n&&d.default.createElement(f.MenuItem,{value:"manual",primaryText:this.T("schedule.type.manual")}),d.default.createElement(f.MenuItem,{value:"monthly",primaryText:this.T("schedule.type.monthly")}),d.default.createElement(f.MenuItem,{value:"weekly",primaryText:this.T("schedule.type.weekly")}),d.default.createElement(f.MenuItem,{value:"daily",primaryText:this.T("schedule.type.daily")}),d.default.createElement(f.MenuItem,{value:"timely",primaryText:this.T("schedule.type.timely")})),"monthly"===r&&d.default.createElement("div",null,d.default.createElement(m,{floatingLabelText:this.T("schedule.detail.monthday"),value:i,onChange:function(e,t,n){a.setState({monthday:n})},fullWidth:!0},s.map(function(e){return d.default.createElement(f.MenuItem,{value:e,primaryText:e})}))),"weekly"===r&&d.default.createElement("div",null,d.default.createElement(m,{floatingLabelText:this.T("schedule.detail.weekday"),value:l,onChange:function(e,t,n){a.setState({weekday:n})},fullWidth:!0},o.map(function(e,t){return d.default.createElement(f.MenuItem,{value:t,primaryText:e})}))),("daily"===r||"monthly"===r||"weekly"===r)&&d.default.createElement("div",null,d.default.createElement(f.TimePicker,c({format:"ampm",minutesStep:5,hintText:this.T("schedule.detail.daytime"),value:e,onChange:function(e,t){a.setState({daytime:t})},fullWidth:!0},y.textField))),"timely"===r&&d.default.createElement("div",null,d.default.createElement(h,{floatingLabelText:this.T("schedule.detail.minutes"),value:t,type:"number",onChange:function(e,t){a.setState({everyminutes:parseInt(t)})},fullWidth:!0})))}}],[{key:"parseIso8601",value:function(e){if(""===e||-1===e.indexOf("/"))return{frequency:"manual"};var t=e.split("/"),n=a(t,3),t=(n[0],n[1]),n=n[2],t=new Date(t);if("P1M"===n)return{frequency:"monthly",monthday:t.getDate(),daytime:t};if("P7D"===n)return{frequency:"weekly",weekday:p(t).day(),daytime:t};if("PT24H"===n||"P1D"===n)return{frequency:"daily",daytime:t};n=p.duration(n);return n.isValid()?{frequency:"timely",everyminutes:n.minutes()+60*n.hours()}:{error:"Cannot parse value "+e}}},{key:"makeIso8601FromState",value:function(e){var t=e.frequency,n=e.monthday,a=e.weekday,o=e.daytime,r=e.everyminutes,i=new Date("2012-01-01T00:00:00.828696-07:00"),l=p.duration(0);switch(t){case"manual":return"";case"monthly":o&&i.setTime(o.getTime()),i.setDate(n||1),l=p.duration(1,"months");break;case"weekly":o&&i.setTime(o.getTime());var s=p(i);s.day(void 0===a?1:a),i=s.toDate(),l=p.duration(7,"days");break;case"daily":o&&i.setTime(o.getTime()),l=p.duration(24,"hours");break;case"timely":l=p.duration(r,"minutes")}return"R/"+p(i).toISOString()+"/"+l.toISOString()}},{key:"readableString",value:function(e,t){var n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],a=e.frequency,o=e.monthday,r=e.weekday,i=e.daytime,l=e.everyminutes,s="0:00";switch(i&&(s=p(i).format("h:mm a")),a){case"manual":return t("trigger.manual");case"monthly":return n?t("schedule.monthly.short").replace("%1",o):t("schedule.monthly").replace("%1",o).replace("%2",s);case"weekly":return n?t("schedule.weekly.short").replace("%1",p.weekdays()[r]):t("schedule.weekly").replace("%1",p.weekdays()[r]).replace("%2",s);case"daily":return t(n?"schedule.daily.short":"schedule.daily").replace("%1",s);case"timely":var u=p.duration(l,"minutes");return t("schedule.timely").replace("%1",(u.hours()?u.hours()+"h":"")+(u.minutes()?u.minutes()+"mn":""));default:return"Error"}}}]),b);function b(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),i(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,e);e=e.schedule;e?e.Iso8601Schedule?this.state=b.parseIso8601(e.Iso8601Schedule):this.state={frequency:"daily",daytime:new Date}:this.state=b.parseIso8601("")}n.default=o,t.exports=n.default},{"cells-sdk":"cells-sdk","material-ui":"material-ui",pydio:"pydio",react:"react"}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}var s=l(e("react")),u=l(e("pydio")),c=l(e("pydio/http/api")),d=e("material-ui"),f=e("cells-sdk"),p=l(e("lodash.debounce")),m=u.default.requireLib("components").MaterialTable,e=u.default.requireLib("boot"),h=e.JobsStore,y=e.moment,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(b,s["default"].Component),a(b,[{key:"componentDidMount",value:function(){var t=this;this.loadActivity(this.props),this._loadDebounced=(0,p.default)(function(e){e&&t.props.task&&t.props.task.JobID===e&&t.loadActivity(t.props)},500),h.getInstance().observe("tasks_updated",this._loadDebounced);var e=this.props.poll;e&&(this._interval=window.setInterval(function(){u.default.getInstance().WebSocketClient.getStatus()&&t.loadActivity(t.props)},e))}},{key:"componentWillUnmount",value:function(){this._loadDebounced&&h.getInstance().stopObserving("tasks_updated",this._loadDebounced),this._interval&&window.clearInterval(this._interval)}},{key:"componentWillReceiveProps",value:function(e){this.props.task||this.loadActivity(e),e.task&&this.props.task&&e.task.ID!==this.props.task.ID&&this.loadActivity(e)}},{key:"loadActivity",value:function(e){var t,n=this,a=arguments.length<=1||void 0===arguments[1]?0:arguments[1],o=e.task;o&&(t=o.JobID+"-"+o.ID.substr(0,8),e=new f.JobsServiceApi(c.default.getRestClient()),(o=new f.LogListLogRequest).Query='+OperationUuid:"'+t+'"',o.Page=a,o.Size=200,o.Format=f.ListLogRequestLogFormat.constructFromObject("JSON"),this.setState({loading:!0}),e.listTasksLogs(o).then(function(e){e=e.Logs||[];n.setState({activity:e,loading:!1,page:a})}).catch(function(){n.setState({activity:[],loading:!1,page:a})}))}},{key:"computeTag",value:function(e){var t=this.props,n=t.job,a=t.descriptions,t={backgroundColor:"#1e96f3",fontSize:11,fontWeight:500,color:"white",padding:"0 8px",overflow:"hidden",textOverflow:"ellipsis",borderRadius:4,textAlign:"center"},o=e.SchedulerTaskActionPath;if(!o)return null;if("ROOT"===o)return s.default.createElement("div",{style:i({},t,{backgroundColor:"white",color:"rgba(0,0,0,.87)",border:"1px solid #e0e0e0"})},"Trigger");var r=void 0;try{r=this.findAction(o,n.Actions)}catch(e){}return r?r.Label?o=r.Label:a&&a[r.ID]&&(o=a[r.ID].Label):(e=o.split("/").pop().split("$").shift(),a&&a[e]&&(o=a[e].Label)),s.default.createElement("div",{style:t},o)}},{key:"findAction",value:function(e,t){var n=e.split("/"),a=(n.shift(),[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n)).shift()),e=t[parseInt(a.split("$")[1])],t=void 0,t=-1===a.indexOf("$FAIL")?e.ChainedActions:e.FailedFilterActions;return 1<n.length?this.findAction(n.join("/"),t):e}},{key:"render",value:function(){var t=this,e=this.props,n=e.pydio,a=e.onRequestClose,o=this.state,r=o.activity,i=o.loading,l=o.page,e="#f5f5f5",o=[{name:"SchedulerTaskActionPath",label:"",hideSmall:!0,style:{width:110,height:32,backgroundColor:e,paddingLeft:12,paddingRight:0,userSelect:"text"},headerStyle:{width:110,paddingLeft:12,paddingRight:0},renderCell:function(e){return t.computeTag(e)}},{name:"Ts",label:n.MessageHash["settings.17"],style:{width:100,height:32,backgroundColor:e,paddingRight:10,userSelect:"text"},headerStyle:{width:100,paddingRight:10},renderCell:function(e){return y(1e3*e.Ts).format("HH:mm:ss")}},{name:"Msg",label:n.MessageHash["ajxp_admin.logs.message"],style:{height:32,backgroundColor:e,userSelect:"text"}}];return s.default.createElement("div",{style:{paddingTop:12,paddingBottom:10,backgroundColor:e}},s.default.createElement("div",{style:{padding:"0 24px 10px",fontWeight:500,backgroundColor:e,display:"flex",alignItems:"center"}},s.default.createElement("div",null,n.MessageHash["ajxp_admin.scheduler.tasks.activity.title"]),s.default.createElement("div",{style:{flex:1,textAlign:"center",fontSize:20,display:"flex",alignItems:"center",justifyContent:"center"}},0<l&&s.default.createElement(d.FontIcon,{className:"mdi mdi-chevron-left",color:"rgba(0,0,0,.7)",style:{cursor:"pointer"},onClick:function(){t.loadActivity(t.props,l-1)}}),(0<l||200<=r.length)&&s.default.createElement("span",{style:{fontSize:12}},n.MessageHash[331]," ",i?s.default.createElement(d.CircularProgress,{size:16,thickness:1.5}):s.default.createElement("span",null,l+1)),200<=r.length&&s.default.createElement(d.FontIcon,{className:"mdi mdi-chevron-right",color:"rgba(0,0,0,.7)",style:{cursor:"pointer"},onClick:function(){t.loadActivity(t.props,l+1)}})),s.default.createElement("div",{style:{paddingRight:15,cursor:"pointer"},onClick:a},s.default.createElement(d.FontIcon,{className:"mdi mdi-close",color:"rgba(0,0,0,.3)",style:{fontSize:16}}))),s.default.createElement(m,{hideHeaders:!0,columns:o,data:r,showCheckboxes:!1,emptyStateString:i?s.default.createElement("div",{style:{display:"flex",alignItems:"center"}}," ",s.default.createElement(d.CircularProgress,{size:16,thickness:1.5})," ",s.default.createElement("span",{style:{flex:1,marginLeft:5}},n.MessageHash["ajxp_admin.scheduler.tasks.activity.loading"])):n.MessageHash["ajxp_admin.scheduler.tasks.activity.empty"],emptyStateStyle:{backgroundColor:e},computeRowStyle:function(e){return{borderBottomColor:"#fff",height:32}}}))}}]),b);function b(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),r(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,e),this.state={activity:[],loading:!1,page:0}}n.default=a,t.exports=n.default},{"cells-sdk":"cells-sdk","lodash.debounce":"lodash.debounce","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api",react:"react"}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=function(e,t,n){for(var a=!0;a;){var o=e,r=t,i=n,a=!1;null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,r);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=r,n=i,a=!0,l=void 0}};function i(e){return e&&e.__esModule?e:{default:e}}var d=i(e("react")),s=i(e("pydio")),f=e("material-ui"),u=i(e("./TaskActivity")),e=s.default.requireLib("boot"),c=e.JobsStore,p=e.SingleJobProgress,m=e.moment,h=s.default.requireLib("components").MaterialTable,a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,d["default"].Component),a(y,[{key:"renderActions",value:function(e){function t(e){return n.MessageHash["ajxp_admin.scheduler.task.action."+e]||e}var n=this.props.pydio,a=c.getInstance(),o=[],r={iconStyle:{color:"rgba(0,0,0,.3)"}};return"Running"===e.Status&&e.CanPause&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-pause",tooltip:t("pause"),onClick:function(){a.controlTask(e,"Pause")}},r))),"Paused"===e.Status&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-play",tooltip:t("resume"),onClick:function(){a.controlTask(e,"Resume")}},r))),"Running"===e.Status||"Paused"===e.Status?e.CanStop?o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-stop",tooltip:t("stop"),onClick:function(){a.controlTask(e,"Stop")}},r))):"Pending"===e.StatusMessage&&o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-delete",tooltip:t("delete"),onClick:function(){a.controlTask(e,"Delete")}},r))):o.push(d.default.createElement(f.IconButton,l({iconClassName:"mdi mdi-delete",tooltip:t("delete"),onClick:function(){a.controlTask(e,"Delete")}},r))),o}},{key:"onSelectTaskRows",value:function(e){"selection"===this.state.mode?this.setState({selectedRows:e}):1===e.length&&this.setState({taskLogs:e[0]})}},{key:"setLoading",value:function(e){var t=this.props.onLoading;this.setState({working:e}),t&&t(e)}},{key:"deleteSelection",value:function(){var e=this,t=this.state.selectedRows,n=this.props.job,a=c.getInstance();this.setLoading(!0),a.deleteTasks(n.ID,t).then(function(){e.setState({selectedRows:[],mode:"log"}),e.setLoading(!1)}).catch(function(){e.setLoading(!1)})}},{key:"deleteAll",value:function(){var e=this,t=this.props,n=t.pydio,a=t.job;n.UI.openConfirmDialog({message:n.MessageHash["ajxp_admin.scheduler.tasks.delete.confirm"],validCallback:function(){e.setLoading(!0),c.getInstance().deleteAllTasksForJob(a.ID).then(function(){e.setLoading(!1)}).catch(function(){e.setLoading(!1)})}})}},{key:"insertTaskLogRow",value:function(e){var n=this,t=this.props,a=t.pydio,o=t.job,t=t.descriptions,r=void 0===t?[]:t,t=this.state,i=t.taskLogs;return"selection"===t.mode?e:e.map(function(e){if(i&&e.ID===i.ID){var t=d.default.createElement(u.default,{pydio:a,task:i,job:o,descriptions:r,onRequestClose:function(){n.setState({taskLogs:null})},poll:"Running"===e.Status?1050:void 0});return l({},e,{expandedRow:t})}return e})}},{key:"render",value:function(){var t=this,e=this.props,n=e.pydio,a=e.adminStyles,o=e.job,r=this.state,i=r.selectedRows,l=r.working,s=r.mode;if(!o)return null;var e=function(e){return n.MessageHash["ajxp_admin.scheduler."+e]||e},r=d.default.createElement("div",{style:{lineHeight:"initial",marginLeft:5}},d.default.createElement(f.IconButton,{iconClassName:"mdi mdi-delete-sweep",iconStyle:{color:"rgba(0,0,0,.3)"},tooltip:e("tasks.bulk.clear"),primary:!0,onClick:this.deleteAll.bind(this),disabled:l})),r=[{name:"ID",label:d.default.createElement("div",{style:{display:"flex",alignItems:"center",marginLeft:-20}},d.default.createElement("div",{style:{lineHeight:"initial",marginLeft:5}},d.default.createElement(f.IconButton,{iconClassName:"mdi mdi-checkbox-multiple-"+("selection"===s?"marked":"blank")+"-outline",iconStyle:{color:"rgba(0,0,0,.3)"},tooltip:e("selection"===s?"tasks.bulk.disable":"tasks.bulk.enable"),primary:!0,onClick:function(){t.setState({mode:"selection"===s?"log":"selection",taskLogs:null})},disabled:l})),d.default.createElement("span",null,e("task.id"))),hideSmall:!0,style:{width:110,fontSize:15,paddingLeft:20},headerStyle:{width:110,paddingLeft:20},renderCell:function(e){return e.ID.substr(0,8)}},{name:"StartTime",style:{width:100,paddingRight:10},headerStyle:{width:100,paddingRight:10},label:e("task.start"),renderCell:function(e){e=m(1e3*e.StartTime);return e.isSame(Date.now(),"day")?e.format("HH:mm:ss"):e.fromNow()}},{name:"StatusMessage",label:e("task.message"),hideSmall:!0,renderCell:function(e){return"Error"===e.Status?d.default.createElement("span",{style:{fontWeight:500,color:"#E53935"}},e.StatusMessage):"Running"===e.Status?d.default.createElement(p,{pydio:n,jobID:e.JobID,taskID:e.ID}):e.StatusMessage}},{name:"EndTime",style:{width:100},headerStyle:{width:100},label:e("task.duration"),hideSmall:!0,renderCell:function(e){var t=m(Date.now()),n=(t=e.EndTime?m(1e3*e.EndTime):t).diff(m(1e3*e.StartTime)),t=m.utc(n),e=t.format("H"),n=t.format("m"),t=t.format("s");return"0"===e&&"0"===n&&"0"===t?"< 1s":("0"===e?"":e+"h:")+("0"===e&&"0"===n?"":n+"mn:")+t+"s"}},{name:"Actions",label:r,style:{textAlign:"right",width:120,paddingLeft:0},headerStyle:{width:120,paddingLeft:0,paddingRight:20,textAlign:"right"},renderCell:this.renderActions.bind(this)}],o=o.Tasks||[],u=["Running","Paused"];o.sort(function(e,t){return e.StartTime&&t.StartTime&&e.StartTime!==t.StartTime?e.StartTime>t.StartTime?-1:1:e.ID>t.ID?1:-1});var c=o.filter(function(e){return-1!==u.indexOf(e.Status)}),c=this.insertTaskLogRow(c),o=o.filter(function(e){return-1===u.indexOf(e.Status)}),o=this.insertTaskLogRow(o);return d.default.createElement("div",null,0<c.length&&d.default.createElement(AdminComponents.SubHeader,{title:e("tasks.running")}),0<c.length&&d.default.createElement(f.Paper,a.body.block.props,d.default.createElement(h,{data:c,columns:r,hideHeaders:!0,showCheckboxes:!1,emptyStateString:e("tasks.running.empty"),onSelectRows:function(e){1===e.length&&c.length&&t.setState({taskLogs:e[0]})},masterStyles:a.body.tableMaster})),d.default.createElement(AdminComponents.SubHeader,{title:d.default.createElement("div",{style:{display:"flex",width:"100%",alignItems:"baseline"}},d.default.createElement("div",{style:{flex:1}},e("tasks.history")),"selection"===s&&1<i.length&&d.default.createElement("div",{style:{lineHeight:"initial"}},d.default.createElement(f.RaisedButton,{label:e("tasks.bulk.delete"),secondary:!0,onClick:this.deleteSelection.bind(this),disabled:l})))}),d.default.createElement(f.Paper,a.body.block.props,d.default.createElement(h,{data:o,columns:r,showCheckboxes:"selection"===s,onSelectRows:this.onSelectTaskRows.bind(this),emptyStateString:e("tasks.history.empty"),selectedRows:i,deselectOnClickAway:!0,masterStyles:a.body.tableMaster,paginate:[10,25,50,100],defaultPageSize:10})))}}]),y);function y(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),r(Object.getPrototypeOf(y.prototype),"constructor",this).call(this,e),this.state={mode:"log",selectedRows:[],working:!1,taskLogs:null}}n.default=a,t.exports=n.default},{"./TaskActivity":8,"material-ui":"material-ui",pydio:"pydio",react:"react"}],10:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var o=a(e("./board/Dashboard")),r=a(e("./board/JobsList")),i=a(e("./board/TasksList")),l=a(e("./board/ScheduleForm")),s=a(e("./board/Events")),e=a(e("./board/Loader"));window.AdminScheduler={Dashboard:o.default,JobsList:r.default,TasksList:i.default,ScheduleForm:l.default,Events:s.default,Loader:e.default}},{"./board/Dashboard":1,"./board/Events":2,"./board/JobsList":5,"./board/Loader":6,"./board/ScheduleForm":7,"./board/TasksList":9}]},{},[10]);