!function r(i,n,s){function l(a,e){if(!n[a]){if(!i[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(o)return o(a,!0);t=new Error("Cannot find module '"+a+"'");throw t.code="MODULE_NOT_FOUND",t}t=n[a]={exports:{}};i[a][0].call(t.exports,function(e){var t=i[a][1][e];return l(t||e)},t,t.exports,r,i,n,s)}return n[a].exports}for(var o="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("prop-types")),n=r(e("pydio")),l=r(e("pydio/model/data-model")),o=r(e("pydio/model/node")),d=r(e("react")),c=r(e("create-react-class")),u=r(e("./ServicesList")),p=e("material-ui"),e=n.default.requireLib("hoc"),f=e.ModernStyles,m=e.ModernSelectField;a.default=(0,c.default)({displayName:"Dashboard",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:i.default.instanceOf(l.default).isRequired,rootNode:i.default.instanceOf(o.default).isRequired,currentNode:i.default.instanceOf(o.default).isRequired,openEditor:i.default.func.isRequired,openRightPane:i.default.func.isRequired,closeRightPane:i.default.func.isRequired,pydio:i.default.instanceOf(n.default)},getInitialState:function(){var e=localStorage.getItem("console.services.details");return{details:e&&"true"===e,filter:"",peers:[],peerFilter:""}},onDetailsChange:function(e,t){this.setState({details:t}),localStorage.setItem("console.services.details",t?"true":"false")},onFilterChange:function(e,t,a){this.setState({filter:a})},onPeerFilterChange:function(e,t,a){this.setState({peerFilter:a})},reloadList:function(){this.refs.servicesList.reload()},onUpdatePeers:function(e){this.setState({peers:e})},render:function(){var t=this.props.pydio,e=this.state,a=e.peers,r=e.peerFilter,i=e.filter,n=e.details,e=function(e){return t.MessageHash["ajxp_admin.services."+e]||e},e=d.default.createElement("div",{style:{display:"flex",alignItems:"center",width:"100%"}},d.default.createElement("div",{style:{width:170,marginRight:8}},d.default.createElement(p.Toggle,{label:e("toggle.details"),toggled:n,onToggle:this.onDetailsChange,labelPosition:"right",style:s({width:170},f.toggleField.style)})),0<a.length&&d.default.createElement("div",{style:{width:150,height:14,marginRight:8}},d.default.createElement(m,{fullWidth:!0,className:"media-small-hide",style:{marginTop:-10},underlineStyle:{display:"none"},value:r,onChange:this.onPeerFilterChange},d.default.createElement(p.MenuItem,{value:"",primaryText:e("peerfilter.title")}),a.map(function(e){return d.default.createElement(p.MenuItem,{value:e,primaryText:e})}))),d.default.createElement("div",{style:{width:150,height:14}},d.default.createElement(m,{fullWidth:!0,className:"media-small-hide",style:{marginTop:-10},underlineStyle:{display:"none"},value:i,onChange:this.onFilterChange},d.default.createElement(p.MenuItem,{value:"",primaryText:e("filter.nofilter")}),d.default.createElement(p.MenuItem,{value:"STARTED",primaryText:e("filter.started")}),d.default.createElement(p.MenuItem,{value:"STOPPED",primaryText:e("filter.stopped")}))));return d.default.createElement("div",{className:"main-layout-nav-to-stack workspaces-board"},d.default.createElement("div",{className:"vertical-layout",style:{width:"100%"}},d.default.createElement(AdminComponents.Header,{title:this.context.getMessage("172","settings"),icon:"mdi mdi-access-point-network",legend:this.context.getMessage("173","settings"),actions:[e],reloadAction:this.reloadList.bind(this)}),d.default.createElement(u.default,{ref:"servicesList",pydio:t,className:"layout-fill",style:{paddingBottom:16},dataModel:this.props.dataModel,rootNode:this.props.rootNode,currentNode:this.props.rootNode,filter:i,peerFilter:r,details:n,onUpdatePeers:this.onUpdatePeers.bind(this)})))}}),t.exports=a.default},{"./ServicesList":3,"create-react-class":"create-react-class","material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio","pydio/model/data-model":"pydio/model/data-model","pydio/model/node":"pydio/model/node",react:"react"}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(e,t,a){for(var r=!0;r;){var i=e,n=t,s=a,r=!1;null===i&&(i=Function.prototype);var l=Object.getOwnPropertyDescriptor(i,n);if(void 0!==l){if("value"in l)return l.value;var o=l.get;return void 0===o?void 0:o.call(s)}i=Object.getPrototypeOf(i);if(null===i)return;e=i,t=n,a=s,r=!0,l=void 0}};var s,l=e("react"),c=(s=l)&&s.__esModule?s:{default:s},u=e("material-ui"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,c["default"].Component),r(o,[{key:"renderServiceLine",value:function(e,t,a,r){var i="STARTED"===e.Status?"#33691e":"#d32f2f";"STARTED"===e.Status||"consul"!==e.Name&&"pydio.rest.install"!==e.Name&&"nats"!==e.Name||(i="#9E9E9E");var n=e.Name.startsWith("pydio.grpc.")?"Grpc":"Rest";"gateway"===t?n=e.Name.split(".").pop():"datasource"===t&&(e.Name.startsWith("pydio.grpc.data.sync.")?n=r("datasource.sync"):e.Name.startsWith("pydio.grpc.data.objects.")?n=r("datasource.objects"):e.Name.startsWith("pydio.grpc.data.index.")&&(n=r("datasource.index")));var s=[];"STARTED"===e.Status&&e.RunningPeers?e.RunningPeers.map(function(e){e.Port?s.push(e.Address+":"+e.Port):s.push(e.Address)}):s.push("N/A");return c.default.createElement("div",{style:{display:"flex",alignItems:"center",margin:"6px 8px",backgroundColor:"#F5F5F5",padding:"8px 6px",borderRadius:2}},c.default.createElement(u.FontIcon,{style:{margin:"0 9px 0 4px",fontSize:20},className:"mdi-traffic-light",color:i}),c.default.createElement("span",{style:{flex:1}},s.join(", ")),a&&c.default.createElement("span",{style:{fontStyle:"italic",paddingRight:6,fontWeight:500,color:"#9e9e9e"}},n))}},{key:"render",value:function(){function t(e){return l.MessageHash["ajxp_admin.services.service."+e]||e}var a=this,e=this.props,r=e.title,i=e.services,n=e.tagId,s=e.showDescription,l=e.pydio,o=void 0;1<i.length&&i.map(function(e){e.Name.startsWith("pydio.grpc.")&&(o=e.Description)});var d=o||i[0].Description;d||"datasource"!==n||(d=i[0].Name.startsWith("pydio.grpc.data.objects.")?t("datasource.objects.legend"):t("datasource.legend"));e={container:{flex:1,minWidth:200,margin:4,display:"flex",flexDirection:"column"},title:{padding:8,fontSize:15,fontWeight:500,borderBottom:"1px solid #eee"},description:{padding:8,flex:1}};return c.default.createElement(u.Paper,{zDepth:1,style:e.container},c.default.createElement("div",{style:e.title},r),s&&c.default.createElement("div",{style:e.description},d),c.default.createElement("div",null,i.map(function(e){return a.renderServiceLine(e,n,s,t)})))}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}a.default=r,t.exports=a.default},{"material-ui":"material-ui",react:"react"}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};function r(e){return e&&e.__esModule?e:{default:e}}var i=r(e("prop-types")),n=r(e("pydio")),m=r(e("react")),s=r(e("create-react-class")),l=r(e("pydio/http/api")),o=e("cells-sdk"),h=e("material-ui"),y=r(e("./ServiceCard")),g=n.default.requireLib("components").MaterialTable,v=["gateway","datasource","data","idm","scheduler","broker","frontend","discovery"];a.default=(0,s.default)({displayName:"ServicesList",mixins:[AdminComponents.MessagesConsumerMixin],propTypes:{dataModel:i.default.instanceOf(PydioDataModel).isRequired,rootNode:i.default.instanceOf(AjxpNode).isRequired,currentNode:i.default.instanceOf(AjxpNode).isRequired,filter:i.default.string,peerFilter:i.default.string,details:i.default.bool,onUpdatePeers:i.default.func},getInitialState:function(){return{services:[]}},componentDidMount:function(){this.load()},reload:function(){this.load()},load:function(){var a=this,e=new o.ConfigServiceApi(l.default.getRestClient());n.default.startLoading(),this.setState({loading:!0}),e.listServices().then(function(e){var t;n.default.endLoading(),a.setState({loading:!1}),a.setState({services:e.Services}),a.props.onUpdatePeers&&(e=e.Services,t={},e.map(function(e){e.RunningPeers&&e.RunningPeers.map(function(e){t[e.Address]=e.Address})}),e=Object.keys(t),a.props.onUpdatePeers(e))}).catch(function(){n.default.endLoading(),a.setState({loading:!1})})},renderListItem:function(e){var t,a=[],r=this.props,i=r.details,r=r.pydio;return i&&(e.Description&&a.push(e.Description),(i=e.RunningPeers)&&i.length&&(t=[],i.map(function(e){t.push(e.Address)}),a.push(r.MessageHash["ajxp_admin.services.service.ip"].replace("%s",t.join(","))))),m.default.createElement(h.ListItem,{primaryText:e.Name,secondaryText:a.join(" - "),leftCheckbox:m.default.createElement(h.Checkbox,{defaultChecked:"STARTED"===e.Status,checked:"STARTED"===e.Status})})},filterNodes:function(e){var t=this;return-1===e.Name.indexOf(".(.+)")&&((!this.props.filter||e.Status===this.props.filter)&&(!this.props.peerFilter||!!e.RunningPeers&&0<e.RunningPeers.filter(function(e){return e.Address===t.props.peerFilter}).length))},render:function(){function n(e){return o.MessageHash["ajxp_admin.services.tag."+e]||e}function s(e){return o.MessageHash["ajxp_admin.services.column."+e]||e}var e,i,l=this,t=this.props,o=t.pydio,a=t.details,r=this.state,t=r.services,t=void 0===t?[]:t,d=r.loading,c={margin:16,display:"flex",flexWrap:"wrap"},u=(e=t.filter(function(e){return l.filterNodes(e)}),i={},e.sort(function(e,t){return e.Name>t.Name?1:e.Name===t.Name?0:-1}),v.forEach(function(r){i[r]={services:{}},e.map(function(e){var t,a;r===e.Tag&&((a=e.Name).startsWith("pydio.grpc.")?a=a.replace("pydio.grpc.",""):a.startsWith("pydio.rest.")&&(a=a.replace("pydio.rest.","")),"datasource"===r&&a.startsWith("data.")&&(a="index"===(a=a.replace("data.",""))||"sync"===a||"objects"===a?"main - "+a:(t=a.split(".").shift(),a=a.split(".").pop(),"objects"===t?"objects - "+a:"datasource - "+a)),i[r].services[a]||(i[r].services[a]=[]),i[r].services[a].push(e))})}),i);if(a){var p=Object.keys(u).map(function(t){var a=u[t].services,e=Object.keys(a).map(function(e){return m.default.createElement(y.default,{pydio:o,showDescription:!0,title:e,tagId:t,services:a[e]})}),r=[];return"datasource"===t?(r.push(m.default.createElement("div",{style:f({},c,{margin:"0 16px"})},Object.keys(a).map(function(e){return e.startsWith("main -")?m.default.createElement(y.default,{pydio:o,showDescription:!0,title:e.replace("main - ",""),tagId:t,services:a[e]}):null}))),r.push(m.default.createElement("div",{style:f({},c,{margin:"0 16px"})},Object.keys(a).map(function(e){return e.startsWith("datasource -")?m.default.createElement(y.default,{pydio:o,showDescription:!0,title:e.replace("datasource - ",""),tagId:t,services:a[e]}):null}))),r.push(m.default.createElement("div",{style:f({},c,{margin:"0 16px"})},Object.keys(a).map(function(e){return e.startsWith("objects -")?m.default.createElement(y.default,{pydio:o,showDescription:!0,title:e.replace("objects - ",""),tagId:t,services:a[e]}):null})))):r.push(m.default.createElement("div",{style:c},Object.keys(a).map(function(e){return m.default.createElement(y.default,{pydio:o,showDescription:!0,title:e,tagId:t,services:a[e]})}))),0===e.length?null:m.default.createElement("div",null,m.default.createElement(AdminComponents.SubHeader,{title:n(t+".title"),legend:n(t+".description")}),r)});return m.default.createElement("div",{className:this.props.className,style:this.props.style},p)}p=function(){var r=[],e=[{name:"Status",label:"",style:{width:56,paddingLeft:12,paddingRight:12,textOverflow:"inherit"},headerStyle:{width:56},renderCell:function(e){var t="STARTED"===e.Status?"#33691e":"#d32f2f",a="STARTED"===e.Status?"Running":"Stopped";return"STARTED"===e.Status||"consul"!==e.Name&&"pydio.rest.install"!==e.Name&&"nats"!==e.Name||(t="#9E9E9E"),{element:m.default.createElement(h.FontIcon,{style:{margin:"0 9px 0 4px",fontSize:20},className:"mdi-traffic-light",color:t}),text:a}}},{name:"Name",label:s("name"),style:{paddingLeft:0},headerStyle:{paddingLeft:0}},{name:"Description",label:s("description"),style:{width:"40%"},headerStyle:{width:"40%"},hideSmall:!0},{name:"Version",label:s("version"),style:{width:110},headerStyle:{width:110},hideSmall:!0},{name:"Type",label:s("tag"),style:{width:120},headerStyle:{width:120},hideSmall:!0,renderCell:function(e){function t(e){return o.MessageHash["ajxp_admin.services.service."+e]||e}var a=e.Name.startsWith("pydio.grpc.")?"Grpc":"Rest";return"gateway"===e.Tag?a=e.Name.split(".").pop():"datasource"===e.Tag&&(e.Name.startsWith("pydio.grpc.data.sync.")?a=t("datasource.sync"):e.Name.startsWith("pydio.grpc.data.objects.")?a=t("datasource.objects"):e.Name.startsWith("pydio.grpc.data.index.")&&(a=t("datasource.index"))),a}},{name:"RunningPeers",label:s("peers"),hideSmall:!0,renderCell:function(e){var t=[];return"STARTED"===e.Status&&e.RunningPeers?t=e.RunningPeers.map(function(e){return e.Metadata&&e.Metadata["non-addressable"]?e.Metadata["non-addressable"]:e.Port?e.Address+":"+e.Port:e.Address}):t.push("N/A"),t.join(",")}}];Object.keys(u).forEach(function(e){var t=[],a=u[e].services;Object.keys(a).forEach(function(e){a[e].forEach(function(e){t.push(e)})}),t.length&&(t.unshift({Subheader:m.default.createElement("span",null,m.default.createElement("span",{style:{textTransform:"uppercase"}},n(e+".title"))," - ",n(e+".description"))}),r.push.apply(r,t))});var t=AdminComponents.AdminStyles().body,a=t.tableMaster,i=t.block.props,t=t.block.container;return{v:m.default.createElement("div",{className:l.props.className,style:l.props.style},m.default.createElement(h.Paper,f({},i,{style:t}),m.default.createElement(g,{data:r,columns:e,deselectOnClickAway:!0,showCheckboxes:!1,emptyStateString:o.MessageHash["ajxp_admin.services.empty."+(d?"loading":"noservice")],masterStyles:a})))}}();if("object"==typeof p)return p.v}}),t.exports=a.default},{"./ServiceCard":2,"cells-sdk":"cells-sdk","create-react-class":"create-react-class","material-ui":"material-ui","prop-types":"prop-types",pydio:"pydio","pydio/http/api":"pydio/http/api",react:"react"}],4:[function(e,t,a){"use strict";var r,i=e("./board/Dashboard"),e=(r=i)&&r.__esModule?r:{default:r};window.AdminServices={Dashboard:e.default}},{"./board/Dashboard":1}]},{},[4]);