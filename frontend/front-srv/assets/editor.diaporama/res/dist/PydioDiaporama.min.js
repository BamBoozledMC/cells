!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PydioDiaporama=e()}(function(){return function n(o,i,a){function u(r,e){if(!i[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);t=new Error("Cannot find module '"+r+"'");throw t.code="MODULE_NOT_FOUND",t}t=i[r]={exports:{}};o[r][0].call(t.exports,function(e){var t=o[r][1][e];return u(t||e)},t,t.exports,n,o,i,a)}return i[r].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)u(a[e]);return u}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=e("pydio"),i=((n=o)&&n.__esModule?n:{default:n}).default.requireLib("hoc").EditorActions;r.onSelectionChange=function(e){var t=e.dispatch,r=e.tab;return function(e){return t(i.tabModify({id:r.id,title:e.getLabel(),node:e}))}};r.onToggleResolution=function(e){var t=e.dispatch;return function(e){return t(i.editorModify({resolution:e?"hi":"lo"}))}};r.onTogglePlaying=function(e){var t=e.dispatch,r=e.tab;return function(e){return t(i.tabModify({id:r.id,playing:e}))}};r.onSizeChange=function(e){var t=e.dispatch;return function(e){return t(i.editorModify(e))}}},{pydio:"pydio"}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n=function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e};function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(e,t,r){for(var n=!0;n;){var o=e,i=t,a=r,n=!1;null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var l=u.get;return void 0===l?void 0:l.call(a)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=i,r=a,n=!0,u=void 0}};function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var r,n={};for(r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=e("react"),p=a(f),d=a(e("prop-types")),y=(l(g,f.Component),n(g,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.style,e=s(e,["src","style"]),t=(t=t.replace(new RegExp("'","g"),"\\'")).replace(new RegExp("\\+","g"),encodeURIComponent("+"));return p.default.createElement("div",c({},e,{style:c({},r,{backgroundImage:"url('"+t+"')",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat",margin:"auto"})}))}}]),g);function g(){u(this,g),i(Object.getPrototypeOf(g.prototype),"constructor",this).apply(this,arguments)}r.Image=y;l(h,f.Component),n(h,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.style,n=e.width,o=e.height,i=e.imgStyle,a=e.imgClassName,u=e.scale,l=void 0===u?1:u,u=s(e,["src","style","width","height","imgStyle","imgClassName","scale"]),e=this.props.editorData;if(e&&e.extensions&&0<e.extensions.length){e=e.extensions[0],e=window[e];if(e&&e.getWrapper&&e.getWrapper("ImageContainer"))return p.default.createElement(e.getWrapper("ImageContainer"),c({},this.props,{style:c({},h.styles,r)}),p.default.createElement(y,{src:t,className:a,style:c({width:n&&n*l||"100%",height:o&&o*l||"100%"},i)}))}return p.default.createElement("div",c({style:c({},h.styles,r)},u),p.default.createElement(y,{src:t,className:a,style:c({width:n&&n*l||"100%",height:o&&o*l||"100%"},i)}))}}],[{key:"propTypes",get:function(){return{src:d.default.string.isRequired,imgClassName:d.default.string,imgStyle:d.default.object,width:d.default.number,height:d.default.number}}},{key:"defaultProps",get:function(){return{src:""}}},{key:"styles",get:function(){return{flex:1,display:"flex",flexDirection:"column",alignItems:"center",overflow:"auto",width:"100%",height:"100%"}}}]),n=h;function h(){u(this,h),i(Object.getPrototypeOf(h.prototype),"constructor",this).apply(this,arguments)}r.ImageContainer=n},{"prop-types":"prop-types",react:"react"}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){return e&&e.__esModule?e:{default:e}}function u(e){return-1<g.mimes.indexOf(e.getAjxpMime())}var l=e("react"),c=a(l),s=a(e("prop-types")),f=e("react-redux"),p=e("redux"),d=e("./components"),y=a(e("./sizes")),g=Pydio.getInstance().Registry.getActiveExtensionByType("editor").filter(function(e){return"editor.diaporama"===e.id})[0],h=pydio.getPluginConfigs("editor.diaporama"),v=h&&h.get("PREVIEWER_LOWRES_SIZES").split(",")||[300,700,1e3,1300],m=Pydio.requireLib("hoc"),b=m.withResolution,e=m.withSelection,h=m.withResize,O=m.EditorActions,w=h(d.ImageContainer),d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){for(var n=!0;n;){var o=e,i=t,a=r,n=!1;null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var l=u.get;return void 0===l?void 0:l.call(a)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=i,r=a,n=!0,u=void 0}}(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,l.PureComponent),n(e,[{key:"componentWillReceiveProps",value:function(e){this.props.selectionPlaying!==e.selectionPlaying&&(e.selectionPlaying?this.pe=new PeriodicalExecuter(e.onRequestSelectionPlay,3):this.pe&&this.pe.stop());var t=this.props.editorModify;e.isActive&&t({fixedToolbar:!1})}},{key:"render",value:function(){var e=this.props,t=e.node,r=e.src,n=e.editorData;if(!t||!r)return null;var o=void 0,i=["diaporama-image-main-block"],e={boxShadow:"rgba(0, 0, 0, 0.117647) 0px 1px 6px, rgba(0, 0, 0, 0.117647) 0px 1px 4px"};return(o=t.getMetadata().get("image_exif_orientation")?t.getMetadata().get("image_exif_orientation"):o)&&(i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(i),["ort-rotate-"+o]),e.imageOrientation="none"),c.default.createElement(w,{editorData:n,node:t,src:r,renderOnChange:!0,passOnProps:!0,imgClassName:i.join(" "),imgStyle:e})}}],[{key:"propTypes",get:function(){return{node:s.default.instanceOf(AjxpNode).isRequired}}}]);var t=e;return e=(0,f.connect)(null,O)(e)||e}();r.default=(0,p.compose)(e(function(n){return new Promise(function(e,t){var r=[];n.getParent().getChildren().forEach(function(e){return r.push(e)}),e({selection:r=r.filter(u).sort(function(e,t){return e.getLabel().localeCompare(t.getLabel(),void 0,{numeric:!0})}),currentIndex:r.reduce(function(e,t,r){return t===n&&r||e},0)})})},u),b(v,function(e){return(0,y.default)(e,"hq")},function(e,t){return(0,y.default)(e,"editor")}),(0,f.connect)(function(e,t){var r=t.node,n=t.editorData;if(!r)return t;e=e.tabs.filter(function(e){var t=e.editorData,e=e.node;return(!t||t.id===n.id)&&e.getPath()===r.getPath()})[0]||{};return e?o({orientation:"hi"===e.resolution?e.node.getMetadata().get("image_exif_orientation"):null},t):t}))(d),t.exports=r.default},{"./components":2,"./sizes":6,"prop-types":"prop-types",react:"react","react-redux":"react-redux",redux:"redux"}],4:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e.default:e}Object.defineProperty(r,"__esModule",{value:!0});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./actions"));r.Actions=o;o=e("./preview");r.Badge=n(o),r.Panel=n(o);e=e("./editor");r.Editor=n(e)},{"./actions":1,"./editor":3,"./preview":5}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(e,t,r){for(var n=!0;n;){var o=e,i=t,a=r,n=!1;null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var l=u.get;return void 0===l?void 0:l.call(a)}o=Object.getPrototypeOf(o);if(null===o)return;e=o,t=i,r=a,n=!0,u=void 0}};function u(e){return e&&e.__esModule?e:{default:e}}var l=e("react"),c=u(l),s=e("./components"),f=u(e("./sizes")),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,l.Component),o(p,[{key:"componentDidMount",value:function(){var t=this,e=this.props.node;(0,f.default)(e,"preview").then(function(e){e&&t.setState({src:e})})}},{key:"render",value:function(){var e=this.props,t=e.node,r=function(e,t){var r,n={};for(r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["node"]);t&&t.getMetadata().get("image_exif_orientation")&&(e=t.getMetadata().get("image_exif_orientation"),r.className?r.className+=" ort-rotate-"+e:r.className="ort-rotate-"+e,5<=parseInt(e)&&r.style&&200===r.style.height&&(r.style.height=250));e=this.state.src;return e?c.default.createElement(s.ImageContainer,n({},r,{src:e,imgStyle:{width:"100%",height:"100%",flex:1}})):null}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),a(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,e),this.state={src:""}}r.default=o,t.exports=r.default},{"./components":2,"./sizes":6,react:"react"}],6:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("pydio/http/api")),l=n(e("pydio/util/path"));function c(e,t){return u.default.getClient().buildPresignedGetUrl(e,null,"image/jpeg",{Bucket:"io",Key:"pydio-thumbstore/"+e.getMetadata().get("uuid")+"-"+t+".jpg"})}function s(e){return u.default.getClient().buildPresignedGetUrl(e,null,"image/"+e.getAjxpMime())}r.default=function(e,t){if(!e)return Promise.resolve("");if(!e.getMetadata().get("thumbnails")&&e.getMetadata().get("ImagePreview"))return o=(r=e).getMetadata().get("ImagePreview"),n=l.default.getFileExtension(o),u.default.getClient().buildPresignedGetUrl(r,null,"image/"+n,{Bucket:"io",Key:"pydio-thumbstore/"+o});var r,n,o=e.getMetadata().get("thumbnails")||[],i={};o.map(function(e){(i[e.size]=e).id&&(i[e.id]=e)});var o=Object.keys(i),a=void 0;switch(o.length&&(a=i[o[0]].size),t){case"preview":return i.sm?c(e,i.sm.size):i[256]?c(e,256):a?c(e,a):s(e);case"editor":return i.md?c(e,i.md.size):i[512]?c(e,512):a?c(e,a):s(e);case"hq":default:return s(e)}},t.exports=r.default},{"pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path"}]},{},[4])(4)});